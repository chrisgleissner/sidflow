# Performance Metrics

SIDFlow's `sidflow-classify` command tracks detailed performance metrics for both WAV cache building and auto-tagging operations. These metrics help you understand the efficiency of classification runs and identify opportunities for optimization.

## Metrics Types

### WAV Cache Build Metrics

The `buildWavCache` function returns metrics that include:

- **`startTime`**: Unix timestamp (milliseconds) when the operation started
- **`endTime`**: Unix timestamp (milliseconds) when the operation completed
- **`durationMs`**: Total duration of the operation in milliseconds
- **`totalFiles`**: Total number of SID files processed
- **`rendered`**: Number of WAV files newly rendered
- **`skipped`**: Number of WAV files skipped (already cached and fresh)
- **`cacheHitRate`**: Percentage of files served from cache (0.0 to 1.0)

A high cache hit rate (close to 1.0) indicates that most SID files haven't changed since the last WAV cache build, which significantly speeds up subsequent classification runs.

### Auto-Tagging Metrics

The `generateAutoTags` function returns metrics that include:

- **`startTime`**: Unix timestamp (milliseconds) when the operation started
- **`endTime`**: Unix timestamp (milliseconds) when the operation completed
- **`durationMs`**: Total duration of the operation in milliseconds
- **`totalFiles`**: Total number of SID files processed
- **`autoTaggedCount`**: Number of files tagged entirely by automation
- **`manualOnlyCount`**: Number of files with complete manual tags (no predictions needed)
- **`mixedCount`**: Number of files with both manual and auto-generated tags
- **`predictionsGenerated`**: Number of predictions generated by the ML model

The `predictionsGenerated` metric is particularly useful for understanding the computational load of a classification run. Files with complete manual tags don't require predictions, which saves time.

## CLI Output Format

When running `sidflow classify`, the CLI displays metrics in a human-readable format:

```
Classification complete.
WAV Cache Build:
  Files processed: 150
  Rendered: 10
  Skipped (cached): 140
  Cache hit rate: 93.3%
  Duration: 45.23s

Auto-tagging:
  Files processed: 150
  Auto-tagged: 75
  Manual-only: 50
  Mixed: 25
  Predictions generated: 100
  Metadata files: 150
  Tag files: 15
  Duration: 2m 15s
```

### Duration Format

Durations are formatted as:
- `{n}ms` for times under 1 second
- `{n}s` for times under 60 seconds (e.g., "45.23s")
- `{m}m {s}s` for times 60 seconds or longer (e.g., "2m 15s")

## Performance Optimization Tips

### Improving WAV Cache Performance

1. **Avoid `--force-rebuild`**: Only use this flag when necessary, as it invalidates the entire cache
2. **Incremental Updates**: Run `sidflow fetch` before `sidflow classify` to minimize the number of new/changed SID files
3. **Parallel Processing**: Future versions may support parallel WAV rendering using the `threads` configuration option

### Improving Auto-Tagging Performance

1. **Manual Tagging**: Files with complete manual tags skip the prediction step entirely
2. **Mixed Tagging**: Provide manual ratings for dimensions you're confident about; the system will only predict missing dimensions
3. **Batch Processing**: Process large HVSC subtrees in a single run rather than multiple small runs to amortize startup costs

## Programmatic Access

When using the TypeScript API directly, metrics are available in the return values:

```typescript
import { buildWavCache, generateAutoTags } from '@sidflow/classify';

const plan = await planClassification({ configPath: '.sidflow.json' });

// Build WAV cache
const wavResult = await buildWavCache(plan);
console.log(`Cache hit rate: ${(wavResult.metrics.cacheHitRate * 100).toFixed(1)}%`);
console.log(`Duration: ${wavResult.metrics.durationMs}ms`);

// Generate auto-tags
const tagsResult = await generateAutoTags(plan);
console.log(`Predictions generated: ${tagsResult.metrics.predictionsGenerated}`);
console.log(`Duration: ${tagsResult.metrics.durationMs}ms`);
```

## Future Enhancements

Future versions of SIDFlow may track additional metrics:

- Per-file processing times to identify slow files
- Network bandwidth usage during HVSC synchronization
- Model inference latency for ML-based predictions
- Detailed breakdown of time spent in each pipeline stage

These metrics will be documented in this file as they become available.
