$ node scripts/run-bun.mjs install --frozen-lockfile && node scripts/run-bun.mjs run wasm:check-upstream && tsc -b
bun install v1.3.4 (5eb2145b)

Checked 896 installs across 967 packages (no changes) [60.00ms]
$ node scripts/run-bun.mjs run scripts/check-libsidplayfp-upstream.ts
[wasm] Upstream repository: https://github.com/libsidplayfp/libsidplayfp
[wasm] Latest upstream commit: 99cd7607881a3a553cc1600291d7fd222ed57b23
[wasm] No recorded successful builds yet.
[wasm] Upstream changed; WASM rebuild required.
[wasm] Remember to run the WASM build pipeline and commit new artifacts.
$ bun run build && node scripts/run-bun.mjs test $(find packages/*/test packages/sidflow-web/tests/unit integration-tests -name '*.test.ts' -type f 2>/dev/null) --coverage --coverage-reporter=text --coverage-reporter=lcov --exclude='**/*.spec.ts' --exclude='**/tests/e2e/**' --exclude='**/dist/**'
$ node scripts/run-bun.mjs install --frozen-lockfile && node scripts/run-bun.mjs run wasm:check-upstream && tsc -b
bun install v1.3.4 (5eb2145b)

Checked 896 installs across 967 packages (no changes) [20.00ms]
$ node scripts/run-bun.mjs run scripts/check-libsidplayfp-upstream.ts
[wasm] Upstream repository: https://github.com/libsidplayfp/libsidplayfp
[wasm] Latest upstream commit: 99cd7607881a3a553cc1600291d7fd222ed57b23
[wasm] No recorded successful builds yet.
[wasm] Upstream changed; WASM rebuild required.
[wasm] Remember to run the WASM build pipeline and commit new artifacts.
bun test v1.3.4 (5eb2145b)

packages/sidflow-fetch/test/sync.internals.test.ts:
(pass) sync internals > resolves the version metadata path [0.89ms]
(pass) sync internals > detects empty and non-empty directories [3.24ms]
(pass) sync internals > downloads archives into temp directories [1.23ms]
(pass) sync internals > merges provided dependencies with defaults [0.15ms]
(pass) sync internals > downloads using the default downloader [4.72ms]
(pass) sync internals > fails the default downloader on HTTP errors [0.48ms]
(pass) sync internals > fails the default downloader on network errors [0.36ms]
(pass) sync internals > computes deterministic checksums [1.65ms]

packages/sidflow-fetch/test/manifest.test.ts:
(pass) fetchHvscManifest > parses the manifest listing and sorts entries [0.97ms]
(pass) fetchHvscManifest > throws when the manifest does not include a base archive [0.12ms]
(pass) fetchHvscManifest > throws when the remote request fails [0.08ms]
(pass) fetchHvscManifest > retries when the network request rejects [0.17ms]

packages/sidflow-fetch/test/sync.test.ts:
[sidflow-fetch] Syncing HVSC base archive v83
[sidflow-fetch] Downloading base archive HVSC_83-all-of-them.7z
[sidflow-fetch] Download complete: HVSC_83-all-of-them.7z
[sidflow-fetch] Applying HVSC delta HVSC_Update_83.7z
[sidflow-fetch] Downloading delta HVSC_Update_83.7z
[sidflow-fetch] Download complete: HVSC_Update_83.7z
[sidflow-fetch] Applying HVSC delta HVSC_Update_84.7z
[sidflow-fetch] Downloading delta HVSC_Update_84.7z
[sidflow-fetch] Download complete: HVSC_Update_84.7z
(pass) syncHvsc > downloads base archive and applies deltas [6.98ms]
[sidflow-fetch] Syncing HVSC base archive v83
[sidflow-fetch] Downloading base archive HVSC_83-all-of-them.7z
[sidflow-fetch] Download complete: HVSC_83-all-of-them.7z
[sidflow-fetch] Applying HVSC delta HVSC_Update_83.7z
[sidflow-fetch] Downloading delta HVSC_Update_83.7z
[sidflow-fetch] Download complete: HVSC_Update_83.7z
[sidflow-fetch] HVSC base archive already up to date (v83) last downloaded 2025-01-02T00:00:00.000Z
[sidflow-fetch] Applying HVSC delta HVSC_Update_84.7z
[sidflow-fetch] Downloading delta HVSC_Update_84.7z
[sidflow-fetch] Download complete: HVSC_Update_84.7z
(pass) syncHvsc > applies only new deltas on subsequent runs [2.73ms]
[sidflow-fetch] Syncing HVSC base archive v83
[sidflow-fetch] Downloading base archive HVSC_83-all-of-them.7z
[sidflow-fetch] Download complete: HVSC_83-all-of-them.7z
[sidflow-fetch] Applying HVSC delta HVSC_Update_83.7z
[sidflow-fetch] Downloading delta HVSC_Update_83.7z
[sidflow-fetch] Download complete: HVSC_Update_83.7z
[sidflow-fetch] HVSC base archive already up to date (v83) last downloaded 2025-01-04T00:00:00.000Z
(pass) syncHvsc > is idempotent when no updates are available [2.45ms]
[sidflow-fetch] Syncing HVSC base archive v83
[sidflow-fetch] Downloading base archive HVSC_83-all-of-them.7z
[sidflow-fetch] Download complete: HVSC_83-all-of-them.7z
(pass) syncHvsc > propagates checksum failures [1.40ms]

packages/sidflow-fetch/test/cli.test.ts:
(pass) sidflow-fetch CLI > parses recognised options [0.43ms]
(pass) sidflow-fetch CLI > returns help flag without consuming later arguments [0.05ms]
(pass) sidflow-fetch CLI > runs the sync workflow and reports success [0.38ms]
(pass) sidflow-fetch CLI > fails fast on unknown options [0.10ms]
(pass) sidflow-fetch CLI > prints help when requested [0.06ms]
(pass) sidflow-fetch CLI > validates option arity [0.07ms]

packages/sidflow-fetch/test/version.test.ts:
(pass) HVSC version persistence > saveHvscVersion writes deterministic JSON [1.39ms]
(pass) HVSC version persistence > loadHvscVersion reads existing file [0.72ms]
(pass) HVSC version persistence > loadHvscVersion returns null for non-existent file [0.29ms]
(pass) HVSC version persistence > loadHvscVersion throws for invalid JSON [0.53ms]

packages/sidflow-common/test/logger.test.ts:
(pass) logger > prefixes messages [0.89ms]

packages/sidflow-common/test/archive.test.ts:
Extracting archive.7z to /tmp/destination...
Extraction complete: archive.7z
(pass) archive helpers > extracts an archive using seven zip [0.67ms]
(pass) archive helpers > creates an archive from a directory [0.17ms]
Extracting archive.7z to /tmp/destination...
(pass) archive helpers > wraps errors with descriptive context [0.59ms]
Extracting archive.7z to /tmp/destination...
Extraction complete: archive.7z
(pass) archive helpers > handles null errors as success [0.33ms]
Extracting archive.7z to /tmp/destination...
Extraction complete: archive.7z
(pass) archive helpers > handles undefined errors as success [0.22ms]
Extracting archive3.7z to /tmp/dest3...
Extraction complete: archive3.7z
(pass) archive helpers > caches the 7zip module between calls [0.26ms]
Extracting archive.7z to /tmp/destination...
(pass) archive helpers > includes original error message in thrown error [0.30ms]
(pass) archive helpers > creates parent directories before packing [0.11ms]
Extracting archive.7z to /tmp/deeply/nested/destination...
Extraction complete: archive.7z
(pass) archive helpers > creates destination directory before extracting [0.07ms]

packages/sidflow-common/test/job-runner.test.ts:
[job-runner] Starting fetch job: /home/ubuntu/.bun/bin/bun -e process.exit(0);
[job-runner] fetch job completed successfully
(pass) JobRunner > completes a pending job successfully [16.40ms]
[job-runner] Starting fetch job: /home/ubuntu/.bun/bin/bun -e process.exit(1);
[job-runner] fetch job exited with code 1
(pass) JobRunner > marks job as failed when command exits non-zero [10.85ms]
[job-runner] Starting fetch job: /home/ubuntu/.bun/bin/bun -e process.exit(0);
[job-runner] fetch job completed successfully
(pass) JobRunner > processes paused jobs and clears resume data [12.63ms]
(pass) JobRunner > returns null when no work available [0.22ms]
[job-runner] Starting fetch job: /home/ubuntu/.bun/bin/bun -e process.exit(0);
[job-runner] fetch job completed successfully
[job-runner] Starting classify job: /home/ubuntu/.bun/bin/bun -e const fs = require('node:fs');
const path = "/tmp/job-runner-flaky-1765669612503.txt";
const value = fs.readFileSync(path, 'utf-8').trim();
if (value === 'fail') {
  fs.writeFileSync(path, 'ok');
  process.exit(1);
}
process.exit(0);

[job-runner] classify job exited with code 1
[job-runner] Starting classify job: /home/ubuntu/.bun/bin/bun -e const fs = require('node:fs');
const path = "/tmp/job-runner-flaky-1765669612503.txt";
const value = fs.readFileSync(path, 'utf-8').trim();
if (value === 'fail') {
  fs.writeFileSync(path, 'ok');
  process.exit(1);
}
process.exit(0);

[job-runner] classify job completed successfully
[job-runner] Starting train job: /home/ubuntu/.bun/bin/bun -e process.exit(0);
[job-runner] train job completed successfully
(pass) JobRunner > resumes pipeline jobs from failed stage [52.77ms]
(pass) createDefaultJobCommandFactory > creates factory for fetch job with minimal params [0.25ms]
(pass) createDefaultJobCommandFactory > creates factory for fetch job with all params [0.06ms]
(pass) createDefaultJobCommandFactory > creates factory for classify job with params [0.06ms]
(pass) createDefaultJobCommandFactory > creates factory for train job with all params [0.09ms]
(pass) createDefaultJobCommandFactory > creates factory for render job with params [0.19ms]
(pass) createDefaultJobCommandFactory > creates factory for pipeline job [0.09ms]
(pass) createDefaultJobCommandFactory > returns null for unknown job type [0.02ms]
(pass) createDefaultJobCommandFactory > handles edge case numeric parameters - very large values [0.04ms]
(pass) createDefaultJobCommandFactory > handles edge case numeric parameters - very small values [0.03ms]
(pass) createDefaultJobCommandFactory > handles edge case numeric parameters - zero values [0.04ms]
(pass) createDefaultJobCommandFactory > handles edge case numeric parameters - Number.MIN_VALUE [0.05ms]

packages/sidflow-common/test/chip-model.test.ts:
(pass) normalizeSidChip > 6581 variants > normalizes '6581' to 6581 [0.05ms]
(pass) normalizeSidChip > 6581 variants > normalizes 'MOS 6581' to 6581 [0.01ms]
(pass) normalizeSidChip > 6581 variants > normalizes '6581R3' to 6581
(pass) normalizeSidChip > 6581 variants > normalizes 'mos6581' lowercase to 6581
(pass) normalizeSidChip > 6581 variants > extracts 6581 from complex string [0.01ms]
(pass) normalizeSidChip > 8580 variants > normalizes '8580' to 8580
(pass) normalizeSidChip > 8580 variants > normalizes 'MOS 8580' to 8580
(pass) normalizeSidChip > 8580 variants > normalizes '8580R5' to 8580
(pass) normalizeSidChip > 8580 variants > normalizes 'mos8580r5' lowercase to 8580
(pass) normalizeSidChip > invalid inputs > returns null for empty string
(pass) normalizeSidChip > invalid inputs > returns null for whitespace
(pass) normalizeSidChip > invalid inputs > returns null for unrecognized chip
(pass) normalizeSidChip > invalid inputs > returns null for number
(pass) normalizeSidChip > invalid inputs > returns null for null
(pass) normalizeSidChip > invalid inputs > returns null for undefined
(pass) normalizeSidChip > invalid inputs > returns null for object [0.01ms]
(pass) normalizeSidChip > whitespace handling > trims leading whitespace
(pass) normalizeSidChip > whitespace handling > trims trailing whitespace
(pass) normalizeSidChip > whitespace handling > handles tabs and newlines
(pass) normalizeSidChip > case insensitivity > handles uppercase
(pass) normalizeSidChip > case insensitivity > handles lowercase
(pass) normalizeSidChip > case insensitivity > handles mixed case

packages/sidflow-common/test/ultimate64-integration.test.ts:
(pass) Ultimate 64 Integration (Mock Server) > REST API: Get version [3.21ms]
(pass) Ultimate 64 Integration (Mock Server) > REST API: Get device info [0.45ms]
(pass) Ultimate 64 Integration (Mock Server) > REST API: Send SID file [1.14ms]
(pass) Ultimate 64 Integration (Mock Server) > REST API: Start audio stream [0.99ms]
(pass) Ultimate 64 Integration (Mock Server) > REST API: Stop audio stream [0.39ms]
(pass) Ultimate 64 Integration (Mock Server) > REST API: Set SID chip configuration [0.73ms]
(pass) Ultimate 64 Integration (Mock Server) > REST API: Get configuration categories [0.35ms]
(pass) Ultimate 64 Integration (Mock Server) > REST API: Get specific configuration [0.45ms]
(pass) Ultimate 64 Integration (Mock Server) > REST API: Reset machine [0.36ms]
(pass) Ultimate 64 Integration (Mock Server) > UDP Audio Capture: Receive and process packets [1001.23ms]
(pass) Ultimate 64 Integration (Mock Server) > UDP Audio Capture: Handle packet reordering [501.06ms]
(pass) Ultimate 64 Integration (Mock Server) > UDP Audio Capture: Handle sequence number wraparound [500.84ms]
(pass) Ultimate 64 Integration (Mock Server) > UDP Audio Capture: exposes buffer configuration [0.08ms]
(pass) Ultimate 64 Integration (Mock Server) > UDP Audio Capture: rejects invalid port in constructor [0.07ms]
(pass) Ultimate 64 Integration (Mock Server) > UDP Audio Capture: throws when starting while already capturing [0.42ms]
(pass) Ultimate 64 Integration (Mock Server) > UDP Audio Capture: throws when starting with invalid port [0.10ms]
(pass) Ultimate 64 Integration (Mock Server) > UDP Audio Capture: allows calling stop() multiple times and returns cached result [101.16ms]

packages/sidflow-common/test/ratings.test.ts:
(pass) ratings > clampRating returns value within range [0.06ms]
(pass) ratings > clampRating clamps values below minimum [0.02ms]
(pass) ratings > clampRating clamps values above maximum [0.02ms]
(pass) ratings > clampRating returns default for NaN [0.01ms]
(pass) ratings > clampRating handles decimal values [0.01ms]
(pass) ratings > clampRating handles boundary values exactly [0.01ms]
(pass) ratings > clampRating handles infinity [0.01ms]
(pass) ratings > clampRating handles zero
(pass) ratings > clampRating handles negative decimals
(pass) ratings > clampRating handles large positive decimals [0.01ms]

packages/sidflow-common/test/jsonl-schema.test.ts:
(pass) FEEDBACK_WEIGHTS > has correct weight for like [0.02ms]
(pass) FEEDBACK_WEIGHTS > has correct weight for dislike
(pass) FEEDBACK_WEIGHTS > has correct weight for skip [0.02ms]
(pass) FEEDBACK_WEIGHTS > has correct weight for play
(pass) FEEDBACK_WEIGHTS > contains all feedback actions [0.06ms]
(pass) ClassificationRecord > accepts valid classification record [0.03ms]
(pass) ClassificationRecord > accepts record with song_index [0.01ms]
(pass) ClassificationRecord > accepts record with features [0.02ms]
(pass) FeedbackRecord > accepts valid feedback record [0.01ms]
(pass) FeedbackRecord > accepts record with song_index [0.01ms]
(pass) FeedbackRecord > accepts record with uuid
(pass) FeedbackRecord > accepts all feedback actions [0.03ms]
(pass) AudioFeatures > accepts standard features [0.02ms]
(pass) AudioFeatures > accepts custom features
(pass) AudioFeatures > allows undefined features [0.01ms]

packages/sidflow-common/test/wasm-build.test.ts:
(pass) wasm-build metadata helpers > reads metadata from disk [1.00ms]
(pass) wasm-build metadata helpers > creates default metadata when file is missing [1.94ms]
(pass) wasm-build metadata helpers > serializes metadata deterministically [0.60ms]
(pass) wasm-build metadata helpers > identifies when a build can be skipped [0.19ms]
(pass) wasm-build metadata helpers > records upstream checks without mutating the original metadata [0.29ms]
(pass) wasm-build metadata helpers > marks builds as complete [0.14ms]
(pass) wasm-build metadata helpers > exposes a default metadata path [0.16ms]
(pass) wasm-build metadata helpers > throws error for invalid JSON [0.38ms]
(pass) wasm-build metadata helpers > throws error for non-object metadata [0.38ms]
(pass) wasm-build metadata helpers > throws error for missing upstreamRepo [0.61ms]
(pass) wasm-build metadata helpers > throws error for non-string upstreamRepo [0.40ms]
(pass) wasm-build metadata helpers > handles nullable fields correctly [0.56ms]
(pass) wasm-build metadata helpers > handles missing lastSuccessfulBuild fields [0.33ms]
(pass) wasm-build metadata helpers > throws error for non-string commit field [0.36ms]
(pass) wasm-build metadata helpers > preserves notes field when marking build complete [0.15ms]

packages/sidflow-common/test/playback-lock.test.ts:
(pass) PlaybackLock > constructor > creates lock with specified path [0.49ms]
(pass) PlaybackLock > registerProcess > writes metadata to lock file [0.66ms]
(pass) PlaybackLock > registerProcess > overwrites existing lock file [1.13ms]
(pass) PlaybackLock > registerProcess > creates parent directory if needed [0.51ms]
(pass) PlaybackLock > getMetadata > returns null for non-existent lock [0.23ms]
(pass) PlaybackLock > getMetadata > returns metadata for existing lock [0.32ms]
(pass) PlaybackLock > getMetadata > includes optional fields [0.33ms]
(pass) PlaybackLock > updateMetadata > updates existing metadata [0.43ms]
(pass) PlaybackLock > releaseIfMatches > releases lock for matching PID [0.47ms]
(pass) PlaybackLock > releaseIfMatches > does not release for non-matching PID [0.33ms]
(pass) PlaybackLock > releaseIfMatches > handles undefined PID gracefully [0.31ms]
(pass) PlaybackLock > forceRelease > removes lock file unconditionally [0.33ms]
(pass) PlaybackLock > forceRelease > succeeds even if no lock exists [0.23ms]
(pass) PlaybackLock > stopExistingPlayback > clears lock for non-existent process [0.56ms]
(pass) PlaybackLock > stopExistingPlayback > does nothing if no lock exists [0.22ms]
(pass) PlaybackLock > stopExistingPlayback > preserves lock for same PID [0.37ms]
(pass) PlaybackLock > error handling > handles corrupted lock file gracefully [0.30ms]
(pass) PlaybackLock > createPlaybackLock > creates lock with path derived from config [0.36ms]

packages/sidflow-common/test/config.test.ts:
(pass) config > loads and caches config [0.73ms]
(pass) config > treats sidplayPath and render as optional [0.35ms]
(pass) config > throws SidflowConfigError for malformed config [0.35ms]
(pass) config > throws when getCachedConfig is called before loadConfig [0.18ms]
(pass) config > throws SidflowConfigError for non-existent config file [0.27ms]
(pass) config > throws SidflowConfigError for invalid JSON [0.32ms]
(pass) config > throws SidflowConfigError for non-object config [0.26ms]
(pass) config > throws SidflowConfigError for missing required string fields [0.29ms]
(pass) config > throws SidflowConfigError for invalid threads value [0.31ms]
(pass) config > throws SidflowConfigError for non-integer threads [0.26ms]
(pass) config > throws SidflowConfigError for invalid classificationDepth value [0.25ms]
(pass) config > validates render settings - empty defaultFormats [0.30ms]
(pass) config > validates render settings - invalid preferredEngines [0.29ms]
(pass) config > validates render settings - missing ultimate64 host [0.30ms]

packages/sidflow-common/test/json.test.ts:
(pass) json > sorts object keys recursively [0.10ms]
(pass) json > serializes deterministically [0.03ms]
(pass) json > handles arrays within objects [0.06ms]
(pass) json > handles nested arrays of objects [0.04ms]
(pass) json > handles null and undefined values [0.04ms]
(pass) json > handles primitives [0.02ms]
(pass) json > handles empty objects and arrays [0.02ms]

packages/sidflow-common/test/fs.test.ts:
(pass) fs helpers > ensures directories exist [0.73ms]
(pass) fs helpers > returns false when path is missing [0.25ms]
(pass) fs helpers > rethrows unexpected filesystem errors [0.15ms]
(pass) fs helpers > handles existing directories gracefully [0.84ms]
(pass) fs helpers > returns true for existing files [0.40ms]
(pass) fs helpers > handles deeply nested paths [0.40ms]

packages/sidflow-common/test/audit-trail.test.ts:
(pass) AuditTrail > log > writes audit entry to file [0.92ms]
(pass) AuditTrail > log > creates parent directory if needed [0.43ms]
(pass) AuditTrail > log > appends multiple entries [0.37ms]
(pass) AuditTrail > log > includes timestamp [0.27ms]
(pass) AuditTrail > log > includes optional resource [0.28ms]
(pass) AuditTrail > log > includes optional details [0.24ms]
(pass) AuditTrail > log > respects disabled flag [0.27ms]
(pass) AuditTrail > logSuccess > logs successful action [0.33ms]
(pass) AuditTrail > logSuccess > includes details [0.46ms]
(pass) AuditTrail > logFailure > logs failed action with error [0.86ms]
(pass) AuditTrail > action types > accepts all defined action types [1.07ms]

packages/sidflow-common/test/sid-parser.test.ts:
(pass) SID parser > parses a minimal v1 PSID file [0.41ms]
(pass) SID parser > parses a v2 PSID file with clock and SID model [0.09ms]
(pass) SID parser > parses a v3 RSID file with multiple SID chips [0.16ms]
(pass) SID parser > parses a v4 PSID file with three SID chips [0.06ms]
(pass) SID parser > converts metadata to JSON format [0.08ms]
(pass) SID parser > rejects files that are too small [0.05ms]
(pass) SID parser > rejects v2+ files that are too small [0.04ms]
(pass) SID parser > rejects invalid magic IDs [0.02ms]
(pass) SID parser > rejects invalid version numbers [0.04ms]
(pass) SID parser > rejects invalid song counts [0.04ms]

packages/sidflow-common/test/recommender.test.ts:
(pass) RecommendationEngine > createRecommendationEngine creates instance [0.07ms]
(pass) RecommendationEngine > connect initializes database connection [0.90ms]
(pass) RecommendationEngine > recommend with quiet mood preset returns appropriate songs [12.84ms]
(pass) RecommendationEngine > recommend with energetic mood preset returns high-energy songs [6.54ms]
(pass) RecommendationEngine > recommend with custom seed vector works [4.07ms]
(pass) RecommendationEngine > scoring weights affect recommendation order [5.98ms]
(pass) RecommendationEngine > diversity filter prevents similar consecutive songs [5.13ms]
(pass) RecommendationEngine > exploration factor affects recommendation diversity [5.33ms]
(pass) RecommendationEngine > BPM range filter works [2.97ms]
(pass) RecommendationEngine > energy range filter works [5.20ms]
(pass) RecommendationEngine > mood range filter works [3.55ms]
(pass) RecommendationEngine > complexity range filter works [2.95ms]
(pass) RecommendationEngine > recommendations include feedback statistics [3.31ms]
(pass) RecommendationEngine > recommendations include extracted features [3.07ms]
(pass) RecommendationEngine > limit parameter controls result count [8.60ms]
(pass) RecommendationEngine > k parameter affects candidate pool size [6.05ms]
(pass) RecommendationEngine > mood presets are all defined [0.14ms]
(pass) RecommendationEngine > recommendations are sorted by score descending [4.60ms]
(pass) RecommendationEngine > song feedback scoring considers likes, dislikes, and skips [3.57ms]
(pass) RecommendationEngine > user affinity considers preference ratings [3.30ms]
(pass) RecommendationEngine > handles database with no tables gracefully [0.61ms]
(pass) RecommendationEngine > throws error when recommending before connecting [0.07ms]

packages/sidflow-common/test/job-orchestrator.test.ts:
(pass) JobOrchestrator > creates a new job [0.58ms]
(pass) JobOrchestrator > saves and loads manifest [0.42ms]
(pass) JobOrchestrator > updates job status [0.42ms]
(pass) JobOrchestrator > updates job progress [0.36ms]
(pass) JobOrchestrator > fails a job with error message [0.35ms]
(pass) JobOrchestrator > preserves resume metadata on failure [0.41ms]
(pass) JobOrchestrator > lists jobs with filters [0.58ms]
(pass) JobOrchestrator > deletes a job [0.30ms]
(pass) JobOrchestrator > generates unique job IDs [1.15ms]
(pass) JobOrchestrator > gets statistics [0.69ms]
(pass) JobOrchestrator > throws error for non-existent job update [0.09ms]
(pass) JobOrchestrator > creates pipeline jobs [0.28ms]

packages/sidflow-common/test/songlengths.test.ts:
(pass) songlength helpers > parses fractional durations into milliseconds [0.37ms]
(pass) songlength helpers > resolves catalog durations and MD5 fallbacks [2.95ms]
(pass) songlength helpers > handles missing songlengths file [1.40ms]
(pass) songlength helpers > handles update directory structure [1.10ms]
(pass) songlength helpers > returns undefined for invalid song index [0.73ms]
(pass) songlength helpers > handles malformed duration entries gracefully [1.08ms]

packages/sidflow-common/test/perf-utils.test.ts:
(pass) PerfTimer > should measure elapsed time [9.54ms]
(pass) PerfTimer > should track memory when enabled [0.15ms]
[perf] No start time found for label: nonexistent
(pass) PerfTimer > should return null for unknown labels [0.05ms]
(pass) PerfTimer > should record manual timings [0.05ms]
(pass) PerfTimer > should generate complete profile [0.10ms]
(pass) PerfTimer > should handle multiple operations [0.03ms]
(pass) measureAsync > should measure async function execution [11.02ms]
(pass) measureAsync > should track memory for async functions [0.32ms]
(pass) measureAsync > should propagate errors [0.09ms]
(pass) measureSync > should measure sync function execution [10.06ms]
(pass) measureSync > should track memory for sync functions [0.11ms]
(pass) CheckpointLogger > should track elapsed time [9.89ms]
[perf] [test] +2671ms (total: 0ms)
(pass) CheckpointLogger > should count checkpoints [0.11ms]
[perf] [test] +2671ms (total: 0ms) - first
[perf] [test] +10ms (total: 10ms) - second
(pass) CheckpointLogger > should log at intervals [9.87ms]
(pass) BatchTimer > should collect samples [25.11ms]
(pass) BatchTimer > should calculate percentiles correctly [0.09ms]
(pass) BatchTimer > should return null stats when empty [0.02ms]
(pass) BatchTimer > should reset samples [0.04ms]
[perf] BatchTimer no-start: end() called without start()
(pass) BatchTimer > should handle end without start gracefully [0.02ms]
(pass) Factory functions > should create PerfTimer via factory [0.07ms]
[perf] [factory-test] +2706ms (total: 0ms)
(pass) Factory functions > should create CheckpointLogger via factory [0.03ms]
(pass) Factory functions > should create BatchTimer via factory [0.02ms]
(pass) PerfTimer additional coverage > should create timer without memory tracking [0.03ms]
(pass) PerfTimer additional coverage > should record manual timing with metadata [0.03ms]
(pass) PerfTimer additional coverage > should finish without metadata [0.01ms]
[perf] Performance profile: info-log
  Total duration: 0.09ms
  Peak memory: 146.26MB
  Timings:
    op1: 0.01ms (mem: +0.00MB)
(pass) PerfTimer additional coverage > should log results at info level [0.13ms]
(pass) PerfTimer additional coverage > should log results at debug level (default) [0.03ms]
(pass) PerfTimer additional coverage > should format memory changes with sign [0.05ms]
(pass) PerfTimer additional coverage > should handle profile with no timings [0.02ms]
(pass) PerfTimer additional coverage > should finish without peak memory when tracking disabled [0.01ms]
[perf] [force-log] forced message (0ms)
(pass) CheckpointLogger additional coverage > should force log regardless of interval [0.04ms]
[perf] [no-msg] +2707ms (total: 0ms)
[perf] [no-msg] +9ms (total: 9ms)
(pass) CheckpointLogger additional coverage > should checkpoint without message [9.20ms]
(pass) CheckpointLogger additional coverage > should create logger with default interval [0.02ms]
[perf] BatchTimer stats-log: count=1, mean=0.00ms, min=0.00ms, max=0.00ms, p50=0.00ms, p95=0.00ms, p99=0.00ms
(pass) BatchTimer additional coverage > should log stats for non-empty batch [0.06ms]
(pass) BatchTimer additional coverage > should log message for empty batch [0.01ms]
(pass) BatchTimer additional coverage > should handle single sample stats [0.02ms]
(pass) BatchTimer additional coverage > should calculate total correctly [0.04ms]

packages/sidflow-common/test/lancedb-builder.test.ts:
(pass) buildDatabase > builds database from empty directories [1.73ms]
(pass) buildDatabase > builds database from classification records [5.67ms]
(pass) buildDatabase > aggregates feedback events by SID path [3.95ms]
(pass) buildDatabase > creates rating vectors with default preference value [3.66ms]
Skipping invalid JSON in /tmp/sidflow-lancedb-test-QT7oHn/classified/classification.jsonl line 2: JSON Parse error: Unexpected identifier "this"
Skipping invalid JSON in /tmp/sidflow-lancedb-test-QT7oHn/classified/classification.jsonl line 4: JSON Parse error: Unexpected identifier "json"
Total invalid JSON lines skipped: 2
(pass) buildDatabase > handles JSONL files with invalid JSON lines [4.89ms]
(pass) generateManifest > generates manifest with checksums and statistics [1.63ms]
(pass) generateManifest > computes checksums for empty directories [0.58ms]
(pass) generateManifest > computes deterministic checksums [1.49ms]

packages/sidflow-common/test/audio-encoding.test.ts:
(pass) Audio Encoding > encodeWavToM4aNative creates M4A file [88.94ms]
(pass) Audio Encoding > encodeWavToFlacNative creates FLAC file [47.12ms]
(pass) Audio Encoding > encodeWavToM4aNative uses default 256 kbps when unspecified [118.52ms]
(pass) Audio Encoding > encodeWavToM4aNative with custom bitrate [96.30ms]
(pass) Audio Encoding > encodeWavToFlacNative with custom compression level [112.07ms]
[audio-encoding] Failed to encode /nonexistent/file.wav to M4A (native): ffmpeg exited with code 254: ffmpeg version 6.1.1-3ubuntu5 Copyright (c) 2000-2023 the FFmpeg developers
  built with gcc 13 (Ubuntu 13.2.0-23ubuntu3)
  configuration: --prefix=/usr --extra-version=3ubuntu5 --toolchain=hardened --libdir=/usr/lib/x86_64-linux-gnu --incdir=/usr/include/x86_64-linux-gnu --arch=amd64 --enable-gpl --disable-stripping --disable-omx --enable-gnutls --enable-libaom --enable-libass --enable-libbs2b --enable-libcaca --enable-libcdio --enable-libcodec2 --enable-libdav1d --enable-libflite --enable-libfontconfig --enable-libfreetype --enable-libfribidi --enable-libglslang --enable-libgme --enable-libgsm --enable-libharfbuzz --enable-libmp3lame --enable-libmysofa --enable-libopenjpeg --enable-libopenmpt --enable-libopus --enable-librubberband --enable-libshine --enable-libsnappy --enable-libsoxr --enable-libspeex --enable-libtheora --enable-libtwolame --enable-libvidstab --enable-libvorbis --enable-libvpx --enable-libwebp --enable-libx265 --enable-libxml2 --enable-libxvid --enable-libzimg --enable-openal --enable-opencl --enable-opengl --disable-sndio --enable-libvpl --disable-libmfx --enable-libdc1394 --enable-libdrm --enable-libiec61883 --enable-chromaprint --enable-frei0r --enable-ladspa --enable-libbluray --enable-libjack --enable-libpulse --enable-librabbitmq --enable-librist --enable-libsrt --enable-libssh --enable-libsvtav1 --enable-libx264 --enable-libzmq --enable-libzvbi --enable-lv2 --enable-sdl2 --enable-libplacebo --enable-librav1e --enable-pocketsphinx --enable-librsvg --enable-libjxl --enable-shared
  libavutil      58. 29.100 / 58. 29.100
  libavcodec     60. 31.102 / 60. 31.102
  libavformat    60. 16.100 / 60. 16.100
  libavdevice    60.  3.100 / 60.  3.100
  libavfilter     9. 12.100 /  9. 12.100
  libswscale      7.  5.100 /  7.  5.100
  libswresample   4. 12.100 /  4. 12.100
  libpostproc    57.  3.100 / 57.  3.100
[in#0 @ 0x55635656dd80] Error opening input: No such file or directory
Error opening input file /nonexistent/file.wav.
Error opening input files: No such file or directory

(pass) Audio Encoding > encodeWavToM4aNative handles missing input file [33.57ms]
[audio-encoding] Failed to encode /nonexistent/file.wav to FLAC (native): ffmpeg exited with code 254: ffmpeg version 6.1.1-3ubuntu5 Copyright (c) 2000-2023 the FFmpeg developers
  built with gcc 13 (Ubuntu 13.2.0-23ubuntu3)
  configuration: --prefix=/usr --extra-version=3ubuntu5 --toolchain=hardened --libdir=/usr/lib/x86_64-linux-gnu --incdir=/usr/include/x86_64-linux-gnu --arch=amd64 --enable-gpl --disable-stripping --disable-omx --enable-gnutls --enable-libaom --enable-libass --enable-libbs2b --enable-libcaca --enable-libcdio --enable-libcodec2 --enable-libdav1d --enable-libflite --enable-libfontconfig --enable-libfreetype --enable-libfribidi --enable-libglslang --enable-libgme --enable-libgsm --enable-libharfbuzz --enable-libmp3lame --enable-libmysofa --enable-libopenjpeg --enable-libopenmpt --enable-libopus --enable-librubberband --enable-libshine --enable-libsnappy --enable-libsoxr --enable-libspeex --enable-libtheora --enable-libtwolame --enable-libvidstab --enable-libvorbis --enable-libvpx --enable-libwebp --enable-libx265 --enable-libxml2 --enable-libxvid --enable-libzimg --enable-openal --enable-opencl --enable-opengl --disable-sndio --enable-libvpl --disable-libmfx --enable-libdc1394 --enable-libdrm --enable-libiec61883 --enable-chromaprint --enable-frei0r --enable-ladspa --enable-libbluray --enable-libjack --enable-libpulse --enable-librabbitmq --enable-librist --enable-libsrt --enable-libssh --enable-libsvtav1 --enable-libx264 --enable-libzmq --enable-libzvbi --enable-lv2 --enable-sdl2 --enable-libplacebo --enable-librav1e --enable-pocketsphinx --enable-librsvg --enable-libjxl --enable-shared
  libavutil      58. 29.100 / 58. 29.100
  libavcodec     60. 31.102 / 60. 31.102
  libavformat    60. 16.100 / 60. 16.100
  libavdevice    60.  3.100 / 60.  3.100
  libavfilter     9. 12.100 /  9. 12.100
  libswscale      7.  5.100 /  7.  5.100
  libswresample   4. 12.100 /  4. 12.100
  libpostproc    57.  3.100 / 57.  3.100
[in#0 @ 0x5585091bad40] Error opening input: No such file or directory
Error opening input file /nonexistent/file.wav.
Error opening input files: No such file or directory

(pass) Audio Encoding > encodeWavToFlacNative handles missing input file [32.36ms]
(pass) Audio Encoding > isFfmpegAvailable returns boolean [30.99ms]
(pass) Audio Encoding > isFfprobeAvailable returns boolean [30.02ms]
(pass) Audio Encoding > DEFAULT_M4A_BITRATE is 256 [0.05ms]
(pass) Audio Encoding > DEFAULT_FLAC_COMPRESSION_LEVEL is 5 [0.02ms]
(pass) Audio Encoding > DEFAULT_AUDIO_ENCODER_IMPLEMENTATION is auto [0.02ms]
(pass) Audio Encoding > encodeWavToM4a uses native implementation when specified [86.95ms]
(pass) Audio Encoding > encodeWavToFlac uses native implementation when specified [43.12ms]
[audio-encoding] Failed to encode /definitely/nonexistent/path/file.wav to M4A (native): ffmpeg exited with code 254: ffmpeg version 6.1.1-3ubuntu5 Copyright (c) 2000-2023 the FFmpeg developers
  built with gcc 13 (Ubuntu 13.2.0-23ubuntu3)
  configuration: --prefix=/usr --extra-version=3ubuntu5 --toolchain=hardened --libdir=/usr/lib/x86_64-linux-gnu --incdir=/usr/include/x86_64-linux-gnu --arch=amd64 --enable-gpl --disable-stripping --disable-omx --enable-gnutls --enable-libaom --enable-libass --enable-libbs2b --enable-libcaca --enable-libcdio --enable-libcodec2 --enable-libdav1d --enable-libflite --enable-libfontconfig --enable-libfreetype --enable-libfribidi --enable-libglslang --enable-libgme --enable-libgsm --enable-libharfbuzz --enable-libmp3lame --enable-libmysofa --enable-libopenjpeg --enable-libopenmpt --enable-libopus --enable-librubberband --enable-libshine --enable-libsnappy --enable-libsoxr --enable-libspeex --enable-libtheora --enable-libtwolame --enable-libvidstab --enable-libvorbis --enable-libvpx --enable-libwebp --enable-libx265 --enable-libxml2 --enable-libxvid --enable-libzimg --enable-openal --enable-opencl --enable-opengl --disable-sndio --enable-libvpl --disable-libmfx --enable-libdc1394 --enable-libdrm --enable-libiec61883 --enable-chromaprint --enable-frei0r --enable-ladspa --enable-libbluray --enable-libjack --enable-libpulse --enable-librabbitmq --enable-librist --enable-libsrt --enable-libssh --enable-libsvtav1 --enable-libx264 --enable-libzmq --enable-libzvbi --enable-lv2 --enable-sdl2 --enable-libplacebo --enable-librav1e --enable-pocketsphinx --enable-librsvg --enable-libjxl --enable-shared
  libavutil      58. 29.100 / 58. 29.100
  libavcodec     60. 31.102 / 60. 31.102
  libavformat    60. 16.100 / 60. 16.100
  libavdevice    60.  3.100 / 60.  3.100
  libavfilter     9. 12.100 /  9. 12.100
  libswscale      7.  5.100 /  7.  5.100
  libswresample   4. 12.100 /  4. 12.100
  libpostproc    57.  3.100 / 57.  3.100
[in#0 @ 0x5617206c2d80] Error opening input: No such file or directory
Error opening input file /definitely/nonexistent/path/file.wav.
Error opening input files: No such file or directory

(pass) Audio Encoding > encodeWavToM4aNative returns error message on failure [30.10ms]
[audio-encoding] Failed to encode /definitely/nonexistent/path/file.wav to FLAC (native): ffmpeg exited with code 254: ffmpeg version 6.1.1-3ubuntu5 Copyright (c) 2000-2023 the FFmpeg developers
  built with gcc 13 (Ubuntu 13.2.0-23ubuntu3)
  configuration: --prefix=/usr --extra-version=3ubuntu5 --toolchain=hardened --libdir=/usr/lib/x86_64-linux-gnu --incdir=/usr/include/x86_64-linux-gnu --arch=amd64 --enable-gpl --disable-stripping --disable-omx --enable-gnutls --enable-libaom --enable-libass --enable-libbs2b --enable-libcaca --enable-libcdio --enable-libcodec2 --enable-libdav1d --enable-libflite --enable-libfontconfig --enable-libfreetype --enable-libfribidi --enable-libglslang --enable-libgme --enable-libgsm --enable-libharfbuzz --enable-libmp3lame --enable-libmysofa --enable-libopenjpeg --enable-libopenmpt --enable-libopus --enable-librubberband --enable-libshine --enable-libsnappy --enable-libsoxr --enable-libspeex --enable-libtheora --enable-libtwolame --enable-libvidstab --enable-libvorbis --enable-libvpx --enable-libwebp --enable-libx265 --enable-libxml2 --enable-libxvid --enable-libzimg --enable-openal --enable-opencl --enable-opengl --disable-sndio --enable-libvpl --disable-libmfx --enable-libdc1394 --enable-libdrm --enable-libiec61883 --enable-chromaprint --enable-frei0r --enable-ladspa --enable-libbluray --enable-libjack --enable-libpulse --enable-librabbitmq --enable-librist --enable-libsrt --enable-libssh --enable-libsvtav1 --enable-libx264 --enable-libzmq --enable-libzvbi --enable-lv2 --enable-sdl2 --enable-libplacebo --enable-librav1e --enable-pocketsphinx --enable-librsvg --enable-libjxl --enable-shared
  libavutil      58. 29.100 / 58. 29.100
  libavcodec     60. 31.102 / 60. 31.102
  libavformat    60. 16.100 / 60. 16.100
  libavdevice    60.  3.100 / 60.  3.100
  libavfilter     9. 12.100 /  9. 12.100
  libswscale      7.  5.100 /  7.  5.100
  libswresample   4. 12.100 /  4. 12.100
  libpostproc    57.  3.100 / 57.  3.100
[in#0 @ 0x561a43e1ad40] Error opening input: No such file or directory
Error opening input file /definitely/nonexistent/path/file.wav.
Error opening input files: No such file or directory

(pass) Audio Encoding > encodeWavToFlacNative returns error message on failure [29.40ms]
[audio-encoding] Failed to get bitrate for /nonexistent/file.m4a: warn: ffprobe exited with code 1: /nonexistent/file.m4a: No such file or directory

      at <anonymous> (/workspace/packages/sidflow-common/src/audio-encoding.ts:678:18)
      at emit (node:events:98:22)
      at #maybeClose (node:child_process:768:16)
      at #handleOnExit (node:child_process:520:72)

(pass) Audio Encoding > getM4aBitrate returns null for nonexistent file [29.21ms]
[audio-encoding] Failed to get bitrate for /tmp/sidflow-audio-encoding-test/invalid.m4a: warn: ffprobe exited with code 1: [mov,mp4,m4a,3gp,3g2,mj2 @ 0x5597d16177c0] moov atom not found
/tmp/sidflow-audio-encoding-test/invalid.m4a: Invalid data found when processing input

      at <anonymous> (/workspace/packages/sidflow-common/src/audio-encoding.ts:678:18)
      at emit (node:events:98:22)
      at #maybeClose (node:child_process:768:16)
      at #handleOnExit (node:child_process:520:72)

(pass) Audio Encoding > getM4aBitrate returns null for invalid file [29.72ms]
[audio-encoding] Failed to encode /nonexistent.wav to M4A (native): ffmpeg exited with code 254: ffmpeg version 6.1.1-3ubuntu5 Copyright (c) 2000-2023 the FFmpeg developers
  built with gcc 13 (Ubuntu 13.2.0-23ubuntu3)
  configuration: --prefix=/usr --extra-version=3ubuntu5 --toolchain=hardened --libdir=/usr/lib/x86_64-linux-gnu --incdir=/usr/include/x86_64-linux-gnu --arch=amd64 --enable-gpl --disable-stripping --disable-omx --enable-gnutls --enable-libaom --enable-libass --enable-libbs2b --enable-libcaca --enable-libcdio --enable-libcodec2 --enable-libdav1d --enable-libflite --enable-libfontconfig --enable-libfreetype --enable-libfribidi --enable-libglslang --enable-libgme --enable-libgsm --enable-libharfbuzz --enable-libmp3lame --enable-libmysofa --enable-libopenjpeg --enable-libopenmpt --enable-libopus --enable-librubberband --enable-libshine --enable-libsnappy --enable-libsoxr --enable-libspeex --enable-libtheora --enable-libtwolame --enable-libvidstab --enable-libvorbis --enable-libvpx --enable-libwebp --enable-libx265 --enable-libxml2 --enable-libxvid --enable-libzimg --enable-openal --enable-opencl --enable-opengl --disable-sndio --enable-libvpl --disable-libmfx --enable-libdc1394 --enable-libdrm --enable-libiec61883 --enable-chromaprint --enable-frei0r --enable-ladspa --enable-libbluray --enable-libjack --enable-libpulse --enable-librabbitmq --enable-librist --enable-libsrt --enable-libssh --enable-libsvtav1 --enable-libx264 --enable-libzmq --enable-libzvbi --enable-lv2 --enable-sdl2 --enable-libplacebo --enable-librav1e --enable-pocketsphinx --enable-librsvg --enable-libjxl --enable-shared
  libavutil      58. 29.100 / 58. 29.100
  libavcodec     60. 31.102 / 60. 31.102
  libavformat    60. 16.100 / 60. 16.100
  libavdevice    60.  3.100 / 60.  3.100
  libavfilter     9. 12.100 /  9. 12.100
  libswscale      7.  5.100 /  7.  5.100
  libswresample   4. 12.100 /  4. 12.100
  libpostproc    57.  3.100 / 57.  3.100
[in#0 @ 0x558f59308d80] Error opening input: No such file or directory
Error opening input file /nonexistent.wav.
Error opening input files: No such file or directory

(pass) Audio Encoding > encodeWavToM4aNative includes implementation in result [29.74ms]
[audio-encoding] Failed to encode /nonexistent.wav to FLAC (native): ffmpeg exited with code 254: ffmpeg version 6.1.1-3ubuntu5 Copyright (c) 2000-2023 the FFmpeg developers
  built with gcc 13 (Ubuntu 13.2.0-23ubuntu3)
  configuration: --prefix=/usr --extra-version=3ubuntu5 --toolchain=hardened --libdir=/usr/lib/x86_64-linux-gnu --incdir=/usr/include/x86_64-linux-gnu --arch=amd64 --enable-gpl --disable-stripping --disable-omx --enable-gnutls --enable-libaom --enable-libass --enable-libbs2b --enable-libcaca --enable-libcdio --enable-libcodec2 --enable-libdav1d --enable-libflite --enable-libfontconfig --enable-libfreetype --enable-libfribidi --enable-libglslang --enable-libgme --enable-libgsm --enable-libharfbuzz --enable-libmp3lame --enable-libmysofa --enable-libopenjpeg --enable-libopenmpt --enable-libopus --enable-librubberband --enable-libshine --enable-libsnappy --enable-libsoxr --enable-libspeex --enable-libtheora --enable-libtwolame --enable-libvidstab --enable-libvorbis --enable-libvpx --enable-libwebp --enable-libx265 --enable-libxml2 --enable-libxvid --enable-libzimg --enable-openal --enable-opencl --enable-opengl --disable-sndio --enable-libvpl --disable-libmfx --enable-libdc1394 --enable-libdrm --enable-libiec61883 --enable-chromaprint --enable-frei0r --enable-ladspa --enable-libbluray --enable-libjack --enable-libpulse --enable-librabbitmq --enable-librist --enable-libsrt --enable-libssh --enable-libsvtav1 --enable-libx264 --enable-libzmq --enable-libzvbi --enable-lv2 --enable-sdl2 --enable-libplacebo --enable-librav1e --enable-pocketsphinx --enable-librsvg --enable-libjxl --enable-shared
  libavutil      58. 29.100 / 58. 29.100
  libavcodec     60. 31.102 / 60. 31.102
  libavformat    60. 16.100 / 60. 16.100
  libavdevice    60.  3.100 / 60.  3.100
  libavfilter     9. 12.100 /  9. 12.100
  libswscale      7.  5.100 /  7.  5.100
  libswresample   4. 12.100 /  4. 12.100
  libpostproc    57.  3.100 / 57.  3.100
[in#0 @ 0x55ee3d3c2d40] Error opening input: No such file or directory
Error opening input file /nonexistent.wav.
Error opening input files: No such file or directory

(pass) Audio Encoding > encodeWavToFlacNative includes implementation in result [34.50ms]
[audio-encoding] Failed to encode /nonexistent.wav to M4A (native): ffmpeg exited with code 254: ffmpeg version 6.1.1-3ubuntu5 Copyright (c) 2000-2023 the FFmpeg developers
  built with gcc 13 (Ubuntu 13.2.0-23ubuntu3)
  configuration: --prefix=/usr --extra-version=3ubuntu5 --toolchain=hardened --libdir=/usr/lib/x86_64-linux-gnu --incdir=/usr/include/x86_64-linux-gnu --arch=amd64 --enable-gpl --disable-stripping --disable-omx --enable-gnutls --enable-libaom --enable-libass --enable-libbs2b --enable-libcaca --enable-libcdio --enable-libcodec2 --enable-libdav1d --enable-libflite --enable-libfontconfig --enable-libfreetype --enable-libfribidi --enable-libglslang --enable-libgme --enable-libgsm --enable-libharfbuzz --enable-libmp3lame --enable-libmysofa --enable-libopenjpeg --enable-libopenmpt --enable-libopus --enable-librubberband --enable-libshine --enable-libsnappy --enable-libsoxr --enable-libspeex --enable-libtheora --enable-libtwolame --enable-libvidstab --enable-libvorbis --enable-libvpx --enable-libwebp --enable-libx265 --enable-libxml2 --enable-libxvid --enable-libzimg --enable-openal --enable-opencl --enable-opengl --disable-sndio --enable-libvpl --disable-libmfx --enable-libdc1394 --enable-libdrm --enable-libiec61883 --enable-chromaprint --enable-frei0r --enable-ladspa --enable-libbluray --enable-libjack --enable-libpulse --enable-librabbitmq --enable-librist --enable-libsrt --enable-libssh --enable-libsvtav1 --enable-libx264 --enable-libzmq --enable-libzvbi --enable-lv2 --enable-sdl2 --enable-libplacebo --enable-librav1e --enable-pocketsphinx --enable-librsvg --enable-libjxl --enable-shared
  libavutil      58. 29.100 / 58. 29.100
  libavcodec     60. 31.102 / 60. 31.102
  libavformat    60. 16.100 / 60. 16.100
  libavdevice    60.  3.100 / 60.  3.100
  libavfilter     9. 12.100 /  9. 12.100
  libswscale      7.  5.100 /  7.  5.100
  libswresample   4. 12.100 /  4. 12.100
  libpostproc    57.  3.100 / 57.  3.100
[in#0 @ 0x557cab290d80] Error opening input: No such file or directory
Error opening input file /nonexistent.wav.
Error opening input files: No such file or directory

(pass) Audio Encoding > encodeWavToM4aNative respects output path [31.18ms]
[audio-encoding] Failed to encode /nonexistent.wav to FLAC (native): ffmpeg exited with code 254: ffmpeg version 6.1.1-3ubuntu5 Copyright (c) 2000-2023 the FFmpeg developers
  built with gcc 13 (Ubuntu 13.2.0-23ubuntu3)
  configuration: --prefix=/usr --extra-version=3ubuntu5 --toolchain=hardened --libdir=/usr/lib/x86_64-linux-gnu --incdir=/usr/include/x86_64-linux-gnu --arch=amd64 --enable-gpl --disable-stripping --disable-omx --enable-gnutls --enable-libaom --enable-libass --enable-libbs2b --enable-libcaca --enable-libcdio --enable-libcodec2 --enable-libdav1d --enable-libflite --enable-libfontconfig --enable-libfreetype --enable-libfribidi --enable-libglslang --enable-libgme --enable-libgsm --enable-libharfbuzz --enable-libmp3lame --enable-libmysofa --enable-libopenjpeg --enable-libopenmpt --enable-libopus --enable-librubberband --enable-libshine --enable-libsnappy --enable-libsoxr --enable-libspeex --enable-libtheora --enable-libtwolame --enable-libvidstab --enable-libvorbis --enable-libvpx --enable-libwebp --enable-libx265 --enable-libxml2 --enable-libxvid --enable-libzimg --enable-openal --enable-opencl --enable-opengl --disable-sndio --enable-libvpl --disable-libmfx --enable-libdc1394 --enable-libdrm --enable-libiec61883 --enable-chromaprint --enable-frei0r --enable-ladspa --enable-libbluray --enable-libjack --enable-libpulse --enable-librabbitmq --enable-librist --enable-libsrt --enable-libssh --enable-libsvtav1 --enable-libx264 --enable-libzmq --enable-libzvbi --enable-lv2 --enable-sdl2 --enable-libplacebo --enable-librav1e --enable-pocketsphinx --enable-librsvg --enable-libjxl --enable-shared
  libavutil      58. 29.100 / 58. 29.100
  libavcodec     60. 31.102 / 60. 31.102
  libavformat    60. 16.100 / 60. 16.100
  libavdevice    60.  3.100 / 60.  3.100
  libavfilter     9. 12.100 /  9. 12.100
  libswscale      7.  5.100 /  7.  5.100
  libswresample   4. 12.100 /  4. 12.100
  libpostproc    57.  3.100 / 57.  3.100
[in#0 @ 0x55ede0222d40] Error opening input: No such file or directory
Error opening input file /nonexistent.wav.
Error opening input files: No such file or directory

(pass) Audio Encoding > encodeWavToFlacNative respects output path [29.58ms]

packages/sidflow-common/test/metadata-cache.test.ts:
(pass) Metadata Cache > should cache and retrieve metadata [2.50ms]
(pass) Metadata Cache > should return null for uncached path [0.47ms]
(pass) Metadata Cache > should invalidate cache when file changes [101.70ms]
(pass) Metadata Cache > should handle file touch without content change [2.70ms]
(pass) Metadata Cache > should invalidate specific entry [0.93ms]
(pass) Metadata Cache > should invalidate entire cache [1.28ms]
(pass) Metadata Cache > should track load times [0.90ms]
(pass) Metadata Cache > should evict LRU entries when cache is full [0.39ms]
(pass) Metadata Cache > should handle missing files gracefully [0.28ms]
(pass) Metadata Cache > should reset statistics [0.33ms]
(pass) Metadata Cache > should handle concurrent accesses [1.20ms]
(pass) Metadata Cache > should handle invalid cache entry gracefully [0.28ms]
(pass) Metadata Cache > should update cache stats correctly [0.53ms]
(pass) Metadata Cache > should cache without mtime when stat fails [0.55ms]
(pass) Metadata Cache > should track average load times [0.49ms]
(pass) Metadata Cache > should handle cache size limits correctly [0.31ms]
(pass) Metadata Cache > should preserve cache across multiple accesses [0.36ms]

packages/sidflow-common/test/canonical-writer.test.ts:
(pass) canonical writer > writeCanonicalJsonFile produces deterministic JSON and logs success [0.93ms]
(pass) canonical writer > writeCanonicalJsonLines writes newline-delimited records [0.78ms]
(pass) canonical writer > appendCanonicalJsonLines appends records and logs failures [1.08ms]

packages/sidflow-common/test/job-queue.test.ts:
[job-runner] Starting fetch job: /home/ubuntu/.bun/bin/bun -e process.exit(0);
[job-runner] fetch job completed successfully
(pass) JobQueueWorker > processes pending jobs [205.69ms]

packages/sidflow-common/test/availability-manifest.test.ts:
(pass) availability manifest > registers a new asset and creates manifest [3.10ms]
(pass) availability manifest > updates an existing asset when key matches [0.98ms]
(pass) availability manifest > finds and lists assets for a track [1.75ms]

packages/sidflow-common/test/config-cache.test.ts:
(pass) Config Cache > should cache config with hash [0.67ms]
(pass) Config Cache > should return null for uncached path [0.16ms]
(pass) Config Cache > should invalidate cache when file changes [102.49ms]
(pass) Config Cache > should handle file touch without content change [1.01ms]
(pass) Config Cache > should invalidate cache manually [0.40ms]
(pass) Config Cache > should track load time statistics [0.14ms]
(pass) Config Cache > should report current cache entry [0.29ms]
(pass) Config Cache > should reset statistics [0.32ms]

packages/sidflow-common/test/feedback.test.ts:
(pass) feedback logging > logFeedback creates date-partitioned JSONL files [4.45ms]
(pass) feedback logging > logFeedback includes UUID when provided [0.86ms]
(pass) feedback logging > logFeedback appends to existing files [0.90ms]
(pass) feedback logging > logFeedback supports all action types [1.29ms]
(pass) feedback logging > logFeedbackBatch logs multiple events [0.99ms]
(pass) feedback logging > generateEventId creates unique UUIDs [0.23ms]
(pass) feedback logging > validateFeedbackLogs validates correct logs [2.05ms]
(pass) feedback logging > validateFeedbackLogs detects duplicate UUIDs [2.01ms]
(pass) feedback logging > validateFeedbackLogs detects invalid records [1.10ms]
(pass) feedback logging > validateFeedbackLogs handles empty directories [0.31ms]
(pass) feedback logging > validateFeedbackLogs detects missing required fields [0.71ms]

packages/sidflow-common/test/render-matrix.test.ts:
(pass) Render Matrix > validates supported server prepared sidplayfp-cli render [0.11ms]
(pass) Render Matrix > validates supported client realtime wasm playback [0.02ms]
(pass) Render Matrix > validates supported server ultimate64 prepared render [0.01ms]
(pass) Render Matrix > rejects invalid render mode combination [0.08ms]
(pass) Render Matrix > rejects future render mode [0.03ms]
(pass) Render Matrix > returns all supported render modes [0.08ms]
(pass) Render Matrix > filters render modes by location [0.06ms]
(pass) Render Matrix > filters render modes by technology [0.06ms]
(pass) Render Matrix > checks technology availability correctly [0.04ms]
(pass) Render Matrix > provides suggested alternatives for invalid modes [0.04ms]

packages/sidflow-common/test/retry.test.ts:
(pass) retry > resolves on the first attempt [0.11ms]
(pass) retry > retries until success within the limit [0.11ms]
(pass) retry > propagates error after exhausting retries [0.12ms]
(pass) retry > awaits onRetry hooks [0.13ms]
(pass) retry > delays between retries when requested [5.18ms]
(pass) retry > does not delay when delayMs is 0 [0.10ms]
(pass) retry > succeeds immediately without retries if function succeeds [0.07ms]
(pass) retry > handles retries with default options [0.06ms]
(pass) retry > handles async onRetry callback errors gracefully [0.12ms]

packages/sidflow-common/test/tags.test.ts:
(pass) tag path helpers > computes relative sid paths [0.03ms]
(pass) tag path helpers > throws when sid file is outside SID path [0.04ms]
(pass) tag path helpers > resolves manual tag path mirroring hvsc layout [0.05ms]
(pass) tag path helpers > resolves metadata path beside manual tags [0.03ms]
(pass) tag path helpers > computes auto-tag directory using classification depth [0.13ms]
(pass) tag path helpers > falls back to tags root when depth exceeds path segments [0.03ms]
(pass) tag path helpers > builds auto-tag file path [0.04ms]
(pass) tag path helpers > computes auto-tag keys with POSIX separators [0.04ms]
(pass) tag path helpers > uses filename when there are no directory segments [0.02ms]
(pass) tag path helpers > normalises to posix separators [0.01ms]
(pass) tag path helpers > handles empty path in toPosixRelative

packages/sidflow-common/test/cli-parser.test.ts:
(pass) cli-parser > parseArgs > parses string arguments [0.09ms]
(pass) cli-parser > parseArgs > parses boolean flags [0.03ms]
(pass) cli-parser > parseArgs > parses negation flags [0.03ms]
(pass) cli-parser > parseArgs > parses integer arguments with validation [0.12ms]
(pass) cli-parser > parseArgs > parses float arguments with constraints [0.06ms]
(pass) cli-parser > parseArgs > handles missing required values [0.02ms]
(pass) cli-parser > parseArgs > handles missing values when next token is a flag [0.02ms]
(pass) cli-parser > parseArgs > reports unknown options [0.01ms]
(pass) cli-parser > parseArgs > reports unexpected positional arguments [0.01ms]
(pass) cli-parser > parseArgs > allows unknown options when configured [0.01ms]
(pass) cli-parser > parseArgs > allows positional arguments when configured [0.02ms]
(pass) cli-parser > parseArgs > detects --help flag [0.01ms]
(pass) cli-parser > parseArgs > detects -h alias
(pass) cli-parser > parseArgs > stops parsing on --help [0.02ms]
(pass) cli-parser > parseArgs > applies default values [0.02ms]
(pass) cli-parser > parseArgs > overrides default values when provided [0.02ms]
(pass) cli-parser > parseArgs > parses short aliases [0.02ms]
(pass) cli-parser > parseArgs > converts kebab-case to camelCase [0.03ms]
(pass) cli-parser > parseArgs > handles multiple arguments [0.04ms]
(pass) cli-parser > parseArgs > stops on first non-option when configured [0.03ms]
(pass) cli-parser > formatHelp > generates help text with usage and description [0.04ms]
(pass) cli-parser > formatHelp > includes default values [0.02ms]
(pass) cli-parser > formatHelp > includes examples [0.03ms]
(pass) cli-parser > formatHelp > shows aliases [0.02ms]
(pass) cli-parser > formatHelp > shows negation flags [0.02ms]
(pass) cli-parser > handleParseResult > returns 0 for help requested with no errors [0.04ms]
(pass) cli-parser > handleParseResult > returns 1 for help requested with errors [0.03ms]
(pass) cli-parser > handleParseResult > returns 1 for errors without help [0.04ms]
(pass) cli-parser > handleParseResult > returns undefined to continue when no help or errors [0.02ms]

packages/sidflow-train/test/index.test.ts:
2025-12-13 23:46:56.836877: I tensorflow/core/util/util.cc:169] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2025-12-13 23:46:56.871103: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F AVX512_VNNI AVX512_BF16 AVX_VNNI AMX_TILE AMX_INT8 AMX_BF16 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
(pass) Training data loading > loads classification records from JSONL files [0.60ms]
(pass) Training data loading > loads feedback records from date-partitioned directories [0.52ms]
(pass) Training data loading > returns empty arrays for non-existent paths [0.17ms]
Failed to parse classification record: SyntaxError: JSON Parse error: Unexpected identifier "invalid"
(pass) Training data loading > handles invalid JSON in classification files [0.50ms]
Failed to parse feedback record: SyntaxError: JSON Parse error: Unexpected identifier "invalid"
(pass) Training data loading > handles invalid JSON in feedback files [0.69ms]
(pass) Training data merging > creates training samples from explicit ratings [0.16ms]
(pass) Training data merging > adds implicit samples from feedback [0.07ms]
(pass) Training data merging > assigns correct weights to implicit samples [0.05ms]
(pass) Training data merging > skips samples without features [0.03ms]
(pass) Train/test splitting > splits samples into train and test sets [0.11ms]
(pass) Train/test splitting > respects test split ratio [0.10ms]
(pass) Train/test splitting > handles small sample sizes [0.02ms]
Loading classification records...
Loaded 3 classification records
Loading feedback records...
Loaded 5 feedback records
Merging training data...
Created 5 training samples
Split into 4 training and 1 test samples
Training model...
Training complete: loss=0.7685, mae=0.7110
Evaluating on test set...
Evaluation: mae=1.0000, r2=-1.5000
(pass) Model training (integration) > trains model on sample data [95.41ms]
Loading classification records...
Loaded 0 classification records
Loading feedback records...
Loaded 0 feedback records
Merging training data...
Created 0 training samples
(pass) Model training (integration) > throws error when no training samples available [0.21ms]

packages/sidflow-train/test/cli.test.ts:
(pass) Train CLI > shows help message with --help flag [0.44ms]
(pass) Train CLI > returns error for unknown options [0.14ms]
(pass) Train CLI > returns error for invalid epoch value [0.09ms]
(pass) Train CLI > returns error for missing epoch value [0.12ms]

=== Training Summary ===
Training samples: 1
Test samples: 1
Training loss: 0.0000
Training MAE: 0.0000
Test MAE: 0.0000
Test R: 0.0000

Model saved to data/model/
Training summary saved to data/training/training-log.jsonl
(pass) Train CLI > parses epochs option correctly [0.24ms]

=== Training Summary ===
Training samples: 1
Test samples: 1
Training loss: 0.0000
Training MAE: 0.0000
Test MAE: 0.0000
Test R: 0.0000

Model saved to data/model/
Training summary saved to data/training/training-log.jsonl
(pass) Train CLI > parses batch-size option correctly [0.10ms]

=== Training Summary ===
Training samples: 1
Test samples: 1
Training loss: 0.0000
Training MAE: 0.0000
Test MAE: 0.0000
Test R: 0.0000

Model saved to data/model/
Training summary saved to data/training/training-log.jsonl
(pass) Train CLI > parses learning-rate option correctly [0.10ms]

=== Training Summary ===
Training samples: 1
Test samples: 1
Training loss: 0.0000
Training MAE: 0.0000
Test MAE: 0.0000
Test R: 0.0000

Model saved to data/model/
Training summary saved to data/training/training-log.jsonl
(pass) Train CLI > handles --no-evaluate flag [0.09ms]

=== Training Summary ===
Training samples: 1
Test samples: 1
Training loss: 0.0000
Training MAE: 0.0000
Test MAE: 0.0000
Test R: 0.0000

Model saved to data/model/
Training summary saved to data/training/training-log.jsonl
(pass) Train CLI > handles --force flag [0.07ms]

packages/libsidplayfp-wasm/test/debug-render.test.ts:

=== RENDER CYCLES DEBUG ===

Calling renderCycles 100 times...

Call 1: 1646 samples
Call 2: 1648 samples
Call 3: 1650 samples
Call 4: 1644 samples
Call 5: 1640 samples
Call 6: 1640 samples
Call 7: 1640 samples
Call 8: 1640 samples
Call 9: 1640 samples
Call 10: 1640 samples

=== ANALYSIS ===
Total calls: 100
Total samples: 164314
Avg samples per call: 1643
Min samples: 1638
Max samples: 1650
Zero-length chunks: 0
Unique chunk sizes: 1638, 1640, 1642, 1644, 1646, 1648, 1650
First 10 chunk sizes: 1646, 1648, 1650, 1644, 1640, 1640, 1640, 1640, 1640, 1640
(pass) RenderCycles Debug > inspect renderCycles output [630.26ms]

=== RENDER SECONDS DEBUG ===

Rendered 441000 samples total
Progress updates: 269
First 10 updates: 1646, 3294, 4944, 6588, 8228, 9868, 11508, 13148, 14788, 16428
Last 10 updates: 427244, 428882, 430520, 432164, 433802, 435440, 437082, 438722, 440360, 441000

Gaps between progress updates (first 50):
Avg gap: 1643 samples
Min gap: 1638
Max gap: 1650
Unique gap sizes: 1638, 1640, 1642, 1644, 1646, 1648, 1650
(pass) RenderCycles Debug > inspect renderSeconds with detailed progress [952.17ms]

packages/libsidplayfp-wasm/test/final-proof.test.ts:

==================================
FINAL BROWSER SIMULATION TEST
==================================

Step 1: Load SID file...
 Loaded (44100Hz, 2ch)

Step 2: Render PCM (WASM)...
 Rendered 441000 samples in 521ms
  Audio duration: 5.00s
  Render speed: 9.6x realtime

Step 3: Convert INT16Float32 (with yielding)...
 Converted in 15ms (4 yields)

Step 4: Analyze PCM audio for gaps...
  Silent streaks found: 548
  Longest silent period: 15.3ms
  Avg silent period: 0.1ms

Step 5: Check if conversion introduced gaps...
   NO gaps introduced by conversion

==================================
FINAL VERDICT
==================================
Pipeline time: 536ms
Audio duration: 5000ms
Fast enough?  YES
Conversion correct?  YES


(pass) Browser Code Path - Final Proof > EXACT browser flow with audio gap detection [960.43ms]

packages/libsidplayfp-wasm/test/loader.test.ts:
(pass) libsidplayfp wasm loader > loads the wasm module and instantiates SidPlayerContext [19.42ms]
(pass) libsidplayfp wasm loader > renders zero samples when no SID is loaded [10.44ms]

packages/libsidplayfp-wasm/test/index.test.ts:
(pass) loadLibsidplayfp > loads with default options [14.06ms]
(pass) loadLibsidplayfp > loads with custom locateFile [8.80ms]
(pass) loadLibsidplayfp > accepts custom SidPlayerContext options [12.85ms]
(pass) loadLibsidplayfp > uses artifactBaseUrl when locateFile not provided [5.35ms]
(pass) loadLibsidplayfp > handles empty options object [5.73ms]
(pass) loadLibsidplayfp > re-exports types correctly [6.55ms]
(pass) index exports > exports loadLibsidplayfp as default [0.04ms]
(pass) index exports > exports SidAudioEngine as named export [0.09ms]
(pass) index exports > exports LoadLibsidplayfpOptions type interface [0.04ms]
(pass) environment detection > handles server-like environment checks [11.69ms]
(pass) environment detection > handles browser-like environment simulation [6.48ms]
(pass) WASM path override > works when no environment override is set [6.67ms]
(pass) WASM path override > custom locateFile takes precedence over env vars [6.86ms]

packages/libsidplayfp-wasm/test/audio-continuity.test.ts:
[Continuity] duration=1.00s samples=88200 silence=0.12% glitches=0 avg=2539 max=10741 score=99.9
[Continuity] rmsAvg=3087 std=1301 cov=42.2% stable=true
(pass) Audio Continuity Verification > verify real SID produces continuous audio without gaps [555.33ms]
[BrowserSim] init=0.04ms load=424.74ms render=107.39ms convert=1.29ms yields=0 total=533.53ms realtime=1.87x
[BrowserSim] continuity=99.9 dropouts=0
(pass) Audio Continuity Verification > simulate EXACT browser playback: load  render  convert  verify [534.28ms]
[Blocking] frames=44100 blocks=1 total=1.00ms avg=1.00ms max=1.00ms
(pass) Audio Continuity Verification > measure conversion blocking and verify no long blocks [529.92ms]
[Stress] cycle=1 render=106.68ms continuity=100.0
[Stress] cycle=2 render=103.13ms continuity=100.0
[Stress] cycle=3 render=103.39ms continuity=99.9
[Stress] avgRender=104.40ms avgContinuity=100.0 allFast=true
(pass) Audio Continuity Verification > stress test: rapid consecutive renders [872.86ms]
[Export] wav=/workspace/packages/libsidplayfp-wasm/test-output.wav duration=1.00s
(pass) Audio Continuity Verification > save rendered audio for manual inspection (WAV file) [531.89ms]

packages/libsidplayfp-wasm/test/buffer-pool.test.ts:
(pass) SidAudioEngine buffer pool > should initialize buffer pool in constructor [3.14ms]
(pass) SidAudioEngine buffer pool > should clear buffer pool on dispose() [484.19ms]
(pass) SidAudioEngine buffer pool > should allow reuse after loadSidBuffer creates new buffers [629.33ms]
(pass) SidAudioEngine buffer pool > should handle multiple engines with separate pools [903.74ms]
(pass) SidAudioEngine buffer pool > should handle dispose before load [3.01ms]

packages/libsidplayfp-wasm/test/wasm-invocations.test.ts:
(pass) SidAudioEngine WASM flows > streams PCM, exposes metadata, and supports song selection [0.17ms]

packages/libsidplayfp-wasm/test/realtime-playback.test.ts:

=== Real-Time Streaming Test ===
Buffer size: 100ms (8820 samples)
Total duration: 60s
Buffers needed: 600
Song ended at buffer 3 (0.3s)

Render Statistics:
Total samples: 4940
Total render time: 14ms
Avg buffer render time: 4.718ms
Target buffer time: 100.000ms
Min buffer time: 2.203ms
Max buffer time: 8.289ms
Real-time ratio: 21.19x
Buffer underruns: 0 (0.0%)
(pass) Real-Time Streaming Simulation > simulate continuous 60-second playback at 44.1kHz [451.54ms]

=== Render Jitter Analysis ===
Samples: 0
No render samples collected (song ended); jitter measurement is not applicable.
(pass) Real-Time Streaming Simulation > measure jitter in render times [442.04ms]

=== Concurrent Rendering Test ===
Chunk 0: 0 samples in 1.01ms

Cache build time: 429ms
Playback render time: 429ms
Total samples rendered: 0
(pass) Real-Time Streaming Simulation > test concurrent rendering (background cache + foreground playback) [429.48ms]

=== Rapid Start/Stop Stress Test ===
Cycles: 10
Avg time per cycle: 7.51ms
Times: 16.6, 6.5, 6.4, 6.3, 6.2, 8.6, 6.0, 6.0, 6.0, 6.3ms
(pass) Real-Time Streaming Simulation > stress test: rapid start/stop cycles [1119.14ms]

=== Memory Leak Test ===
Initial memory: 101.92 MB
Final memory: 101.92 MB
Growth: 0.00 MB
(pass) Real-Time Streaming Simulation > validate no memory leaks during extended rendering [422.92ms]

=== AudioWorklet Simulation ===
Quantum size: 128 frames (2.90ms)
Buffer ahead: 10 quantums
Initial buffer: 4860 samples in 8.64ms

Quantums processed: 1000
Render calls: 100
Avg render time: 0.557ms
Quantum duration: 2.902ms
Headroom: 521%
(pass) Browser Audio API Simulation > simulate AudioWorklet buffer consumption pattern [496.92ms]

packages/libsidplayfp-wasm/test/performance.test.ts:

=== WASM Render Performance ===
Target duration: 5s
Actual duration: 0.06s
Render time: 10ms
Throughput: 5.60x realtime
Samples/sec: 494085
Samples rendered: 4860 (expected: 441000)
(pass) WASM Rendering Performance > measure render throughput (samples/second) [450.66ms]

=== Cache Build Performance ===
Cache limit: 60s
Build time: 421ms
Throughput: 142.64x realtime
(pass) WASM Rendering Performance > measure cache build performance [421.08ms]

=== WASM Call Overhead ===
Iterations: 3
Cycles per call: 20000
Total time: 9ms
Avg call time: 3.105ms
Calls/sec: 322
(pass) WASM Rendering Performance > measure renderCycles call overhead [445.12ms]

=== Conversion Performance (Stereo) ===
Buffer size: 882000 samples (10s)
Method 1 (nested loop): 10.29ms
Method 2 (stereo fast-path): 4.94ms
Speedup: 2.08x
(pass) INT16 to Float32 Conversion Performance > measure conversion speed for stereo buffer [20.06ms]

=== Chunk Size Analysis ===
Chunk 1024 samples: 0.015ms
Chunk 2048 samples: 0.015ms
Chunk 4096 samples: 0.031ms
Chunk 8192 samples: 0.059ms
Chunk 16384 samples: 0.118ms
(pass) INT16 to Float32 Conversion Performance > measure conversion with different chunk sizes [24.90ms]

=== Memory Allocation Overhead ===
0.1MB buffer: 0.049ms
0.8MB buffer: 0.598ms
5.0MB buffer: 0.400ms
(pass) Memory Allocation Performance > measure TypedArray allocation overhead [104.86ms]

=== Complete Load Pipeline ===
Engine init: 0.08ms
Load buffer: 433.87ms
Render 5s PCM: 11.31ms
INT16Float32: 0.27ms
Total pipeline: 445.61ms
Throughput: 11.22x realtime
(pass) End-to-End Hot Path > measure complete load-to-ready pipeline [445.96ms]

packages/libsidplayfp-wasm/test/synthetic-tone.test.ts:


   SYNTHETIC C4 TONE ANALYSIS          


Loading synthetic C4 SID file...
Tune info: {
  songs: 1,
  startSong: 1,
  currentSong: 1,
  loadAddress: 4096,
  initAddress: 4096,
  playAddress: 4127,
  dataFileLen: 380,
  c64dataLen: 256,
  clockSpeed: 1,
  format: "PlaySID one-file format (PSID)",
  infoStrings: [ "Test Tone C4", "SIDFlow", "2025" ],
  commentStrings: [],
}
 Loaded (44100Hz, 2ch)

Rendering audio...
 Rendered 441000 samples (5.00s)

Zero sample ratio: 0.03%
First non-zero samples: -2042, -2042, -2042, -2042, -2042, -2042, -2042, -2042, -2042, -2042, -2040, -2040, -2040, -2040, -2040, -2040, -2040, -2040, -2040, -2040
TEST 1: Silence Detection

 NO silent periods detected
  Perfect continuity!

TEST 2: Frequency Accuracy

Expected: 261.63 Hz (C4)
Left channel: 259.00 Hz (error: 2.63 Hz)
Right channel: 259.00 Hz (error: 2.63 Hz)
 Frequency error exceeds tolerance

TEST 3: Amplitude Stability

Average RMS: 1994
Std Dev: 63
Coefficient of Variation: 3.2%
Range: 1978 - 2425
 Amplitude is very stable (<10% variation)

TEST 4: Glitch Detection

 NO glitches detected

TEST 5: Duration Check

Duration: 5.00s
 Duration is at least 3 seconds


           FINAL VERDICT                


 ISSUES DETECTED
    Frequency inaccurate

    Pipeline has problems!

(pass) Synthetic C4 Tone Verification > verify C4 tone has perfect continuity [853.69ms]


   BROWSER PIPELINE WITH SYNTHETIC      


Rendered: 5.00s in 412ms
Speed: 12.1x realtime
Converted: 6ms

RESULTS:
  Pipeline time: 418ms
  Audio duration: 5000ms
  Fast enough? 
  Conversion errors?  NO

(pass) Synthetic C4 Tone Verification > verify browser pipeline with synthetic tone [828.58ms]

packages/sidflow-classify/test/tfjs-predictor.test.ts:
(pass) tfjsPredictRatings > predicts ratings from feature vectors [4.28ms]
(pass) tfjsPredictRatings > produces consistent predictions for the same input [2.73ms]
(pass) tfjsPredictRatings > handles missing optional features gracefully [1.10ms]
(pass) tfjsPredictRatings > produces different predictions for different inputs [2.11ms]
(pass) tfjsPredictRatings > handles extreme feature values [1.17ms]

packages/sidflow-classify/test/jsonl.test.ts:
(pass) generateJsonlOutput > generates JSONL file with classification records [3.04ms]
[jsonl-writer] Writing classification records to: /tmp/sidflow-jsonl-test-msnjpJ/classified/classification_2025-12-13_23-47-12-272.jsonl
(pass) generateJsonlOutput > creates valid JSONL format with one record per line [3.06ms]
(pass) generateJsonlOutput > includes features in JSONL output when WAV exists [0.70ms]

packages/sidflow-classify/test/phase-transitions.test.ts:

=== Starting Classification Phase Test ===

[Config] Force rebuild enabled, testing: /workspace/test-workspace-phase/hvsc

[classify] Force rebuild requested - cleaning audio cache...
[classify] Deleted 0 audio files from cache
[Thread 1] tagging - working - test-tone.sid
[Thread 1] building - working - test-tone.sid
[Thread 1] tagging - working - test-tone.sid
[jsonl-writer] Writing classification records to: /workspace/test-workspace-phase/tags/classified/classification_2025-12-13_23-47-12-279.jsonl
[Thread 1] tagging - idle
[wasmRenderPool] Worker exited with code: 0

=== Analyzing Thread History ===

[Analysis] Collected history for 1 thread(s)
[Analysis] Maximum update gap: 1417ms

[Thread 1] Total state transitions: 4
[Thread 1] Phases observed: tagging  building

=== Test Passed: All phases visible, no stale gaps ===

(pass) Classification Phase Transitions > should show all phases without stale thread updates during force rebuild [1560.21ms]

=== Starting Building Phase Test ===

[classify] Force rebuild requested - cleaning audio cache...
[classify] Deleted 0 audio files from cache
[Building] Phase update: working - test-tone.sid
[jsonl-writer] Writing classification records to: /workspace/test-workspace-phase/tags/classified/classification_2025-12-13_23-47-13-838.jsonl
[wasmRenderPool] Worker exited with code: 0

[Analysis] Collected 1 building phase updates
[Analysis] Files in building phase: test-tone.sid

=== Test Passed: Building phase updates emitted ===

(pass) Classification Phase Transitions > should emit building phase updates during WAV rendering [1452.94ms]

packages/sidflow-classify/test/e2e-classification.test.ts:
[E2E Test] Test SID file copied: /tmp/sidflow-e2e-test-s75kJj/test-collection/MUSICIANS/G/Garvalf/Lully_Marche_Ceremonie_Turcs_Wip.sid
[E2E Test] Starting classification...
[classify] Force rebuild requested - cleaning audio cache...
[classify] Deleted 0 audio files from cache
[E2E Test] metadata: 0/1 (0.0%) - Lully_Marche_Ceremonie_Turcs_Wip.sid [1/1]
[E2E Test] tagging: 0/1 (0.0%) - MUSICIANS/G/Garvalf/Lully_Marche_Ceremonie_Turcs_Wip.sid
[jsonl-writer] Writing classification records to: /tmp/sidflow-e2e-test-s75kJj/tags/classified/classification_2025-12-13_23-47-15-295.jsonl
[wasmRenderPool] Worker exited with code: 0
[E2E Test] tagging: 1/1 (100.0%) - 
[E2E Test] Classification result: {
  autoTagged: [ "MUSICIANS/G/Garvalf/Lully_Marche_Ceremonie_Turcs_Wip.sid" ],
  manualEntries: [],
  mixedEntries: [],
  metadataFiles: [ "/tmp/sidflow-e2e-test-s75kJj/tags/MUSICIANS/G/Garvalf/Lully_Marche_Ceremonie_Turcs_Wip.sid.meta.json" ],
  tagFiles: [ "/tmp/sidflow-e2e-test-s75kJj/tags/MUSICIANS/G/Garvalf/auto-tags.json" ],
  jsonlFile: "/tmp/sidflow-e2e-test-s75kJj/tags/classified/classification_2025-12-13_23-47-15-295.jsonl",
  jsonlRecordCount: 1,
  metrics: {
    startTime: 1765669635295,
    endTime: 1765669636717,
    durationMs: 1422,
    totalFiles: 1,
    autoTaggedCount: 1,
    manualOnlyCount: 0,
    mixedCount: 0,
    predictionsGenerated: 1,
    skippedAlreadyClassified: 0,
  },
}
[E2E Test]  WAV directory created: /tmp/sidflow-e2e-test-s75kJj/audio-cache/MUSICIANS/G/Garvalf
[E2E Test]  auto-tags.json created: /tmp/sidflow-e2e-test-s75kJj/tags/MUSICIANS/G/Garvalf/auto-tags.json
[E2E Test] Auto-tags keys: [ "Lully_Marche_Ceremonie_Turcs_Wip.sid" ]
[E2E Test] Auto-tags entry: {
  c: 4,
  e: 5,
  m: 1,
  source: "auto",
}
[E2E Test]  Ratings: e=5, m=1, c=4
[E2E Test]  Full classification pipeline completed successfully
(pass) E2E Classification Pipeline Test > Full pipeline: SID  WAV  Features  Ratings  auto-tags.json [1423.93ms]
[jsonl-writer] Writing classification records to: /tmp/sidflow-e2e-test-s75kJj/tags/classified/classification_2025-12-13_23-47-16-719.jsonl
[E2E Test] Second run took 17ms (with WAV cache)
(pass) E2E Classification Pipeline Test > Pipeline can be run multiple times (idempotent) [17.02ms]

packages/sidflow-classify/test/engine-factory.test.ts:
(pass) Engine Factory > getWasmModule > loads a WASM module [7.46ms]
(pass) Engine Factory > getWasmModule > returns a fresh module on each call (no caching) [20.67ms]
(pass) Engine Factory > createEngine > creates a SidAudioEngine instance [9.30ms]
(pass) Engine Factory > createEngine > creates multiple engines independently [20.90ms]
(pass) Engine Factory > setEngineFactoryOverride > allows custom engine factory [0.13ms]
(pass) Engine Factory > setEngineFactoryOverride > can be cleared by passing null [10.83ms]
(pass) Engine Factory > setEngineFactoryOverride > override takes precedence over default factory [0.15ms]
(pass) Engine Factory > setEngineFactoryOverride > can set and update override multiple times [1.11ms]
(pass) Engine Factory > integration > override can provide a partially implemented mock [4.49ms]

packages/sidflow-classify/test/audio-window.test.ts:
(pass) resolveRepresentativeAnalysisWindow > returns start=0 when audio is shorter than max window [0.87ms]
(pass) resolveRepresentativeAnalysisWindow > prefers a later, higher-energy fragment (skips intro when possible) [1.49ms]
(pass) resolveRepresentativeAnalysisWindow > clamps intro skip when the song is too short [0.43ms]

packages/sidflow-classify/test/render-orchestrator.test.ts:
[render-orchestrator] Invalid render mode: Unsupported render mode combination
[render-orchestrator] Suggested alternatives: client/realtime/wasm/playback-only, client/realtime/ultimate64/playback-only
(pass) RenderOrchestrator render mode validation > rejects invalid render mode combinations [1.82ms]
(pass) RenderOrchestrator render mode validation > accepts valid render mode combinations [5.99ms]
(pass) RenderOrchestrator availability registration > records capture metadata when manifests are enabled [6.18ms]

packages/sidflow-classify/test/feature-cache.test.ts:
(pass) Feature Cache > should cache and retrieve features [1.66ms]
(pass) Feature Cache > should return null for uncached file [0.28ms]
(pass) Feature Cache > should use memory cache for repeated access [0.63ms]
(pass) Feature Cache > should detect WAV content changes [0.54ms]
(pass) Feature Cache > should use getOrExtractFeatures helper [0.69ms]
(pass) Feature Cache > should handle concurrent extraction [13.26ms]
(pass) Feature Cache > should track cache statistics [1.11ms]
(pass) Feature Cache > should clear cache [1.81ms]
(pass) Feature Cache > should evict oldest entry when memory cache is full [0.72ms]
(pass) Feature Cache Cleanup > should have cleanupStaleCache function available [0.31ms]

packages/sidflow-classify/test/auto-tags.test.ts:
[jsonl-writer] Writing classification records to: /tmp/sidflow-classify-auto-tags-Kmrlou/tags/classified/classification_2025-12-13_23-47-16-873.jsonl
[featurePool] Feature worker exited with code: 0
(pass) generateAutoTags > merges manual and auto tags respecting precedence [264.23ms]
[jsonl-writer] Writing classification records to: /tmp/sidflow-classify-auto-tags-9kxNcA/tags/classified/classification_2025-12-13_23-47-17-136.jsonl
[featurePool] Feature worker exited with code: 0
(pass) generateAutoTags > fills missing manual fields using predictions [201.78ms]

packages/sidflow-classify/test/integration.test.ts:
[TEST] Created temp directory: /tmp/sidflow-integration-g6lmQL
[TEST] sidPath: /tmp/sidflow-integration-g6lmQL/hvsc
[TEST] audioCachePath: /tmp/sidflow-integration-g6lmQL/wav
[TEST] tagsPath: /tmp/sidflow-integration-g6lmQL/tags
[TEST] Created directory structure
[TEST] Created SID files: /tmp/sidflow-integration-g6lmQL/hvsc/MUSICIANS/Test/song1.sid, /tmp/sidflow-integration-g6lmQL/hvsc/MUSICIANS/Test/song2.sid
[TEST] Starting buildAudioCache...
[TEST] Plan configuration: {
  "sidPath": "/tmp/sidflow-integration-g6lmQL/hvsc",
  "audioCachePath": "/tmp/sidflow-integration-g6lmQL/wav",
  "tagsPath": "/tmp/sidflow-integration-g6lmQL/tags"
}
[TEST] Rendering WAV: /tmp/sidflow-integration-g6lmQL/wav/MUSICIANS/Test/song1.wav from /tmp/sidflow-integration-g6lmQL/hvsc/MUSICIANS/Test/song1.sid (songIndex: undefined)
[TEST] Rendering WAV: /tmp/sidflow-integration-g6lmQL/wav/MUSICIANS/Test/song2.wav from /tmp/sidflow-integration-g6lmQL/hvsc/MUSICIANS/Test/song2.sid (songIndex: undefined)
[TEST] WAV file written: /tmp/sidflow-integration-g6lmQL/wav/MUSICIANS/Test/song1.wav
[TEST] WAV file written: /tmp/sidflow-integration-g6lmQL/wav/MUSICIANS/Test/song2.wav
[TEST] buildAudioCache completed successfully
[TEST]   rendered.length: 2
[TEST]   rendered: ["/tmp/sidflow-integration-g6lmQL/wav/MUSICIANS/Test/song1.wav","/tmp/sidflow-integration-g6lmQL/wav/MUSICIANS/Test/song2.wav"]
[TEST]   skipped.length: 0
[TEST] Checking for WAV file: /tmp/sidflow-integration-g6lmQL/wav/MUSICIANS/Test/song1.wav
[TEST] WAV file exists, size: 176444 bytes
[TEST] Extracting features from: /tmp/sidflow-integration-g6lmQL/wav/MUSICIANS/Test/song1.wav
[TEST] Features extracted: [
  "energy", "rms", "zeroCrossingRate", "bpm", "confidence", "spectralCentroid", "spectralRolloff",
  "sampleRate", "analysisSampleRate", "duration", "analysisWindowSec", "analysisStartSec", "numSamples",
  "featureSetVersion", "featureVariant", "wavBytes", "sidBytes", "nameSeed"
]
[TEST] Predicting ratings...
Failed to load model from data/model/model/model.json: warn: Weight file /workspace/data/model/model/weights.bin does not exist: loading failed
      at <anonymous> (/workspace/node_modules/@tensorflow/tfjs-node/dist/io/file_system.js:69:23)

[TEST] Ratings predicted: {
  e: 5,
  m: 5,
  c: 5,
}
[TEST] Generating auto-tags...
[jsonl-writer] Writing classification records to: /tmp/sidflow-integration-g6lmQL/tags/classified/classification_2025-12-13_23-47-17-360.jsonl
[TEST] Auto-tags generated:
[TEST]   autoTagged.length: 2
[TEST]   predictionsGenerated: 2
[TEST]   tagFiles.length: 1
[TEST] Test completed successfully
(pass) End-to-End SIDFlow Pipeline > extracts features from WAV files [239.98ms]
(pass) End-to-End SIDFlow Pipeline > fallback behavior when Essentia.js fails [5.63ms]

packages/sidflow-classify/test/index.test.ts:
(pass) planClassification > maps config into plan [1.06ms]
(pass) classification helpers > resolves wav paths mirroring HVSC layout [0.05ms]
(pass) classification helpers > resolves wav paths with song index [0.03ms]
(pass) classification helpers > collects sid files recursively [0.90ms]
(pass) classification helpers > detects when wav cache needs refresh [14.45ms]
(pass) classification helpers > builds wav cache using injected renderer [3.64ms]
(pass) classification helpers > reports progress during WAV cache building [5.62ms]
(pass) classification helpers > handles multi-song SID files [3.49ms]
(pass) classification helpers > passes HVSC song lengths to renderer [2.73ms]
(pass) metadata helpers > parses sidplay output into metadata [0.23ms]
(pass) metadata helpers > falls back to path metadata when extraction fails [0.14ms]
(pass) metadata helpers > prefers metadata parsed directly from the SID header [0.67ms]
(pass) metadata helpers > falls back to SidAudioEngine tune info when header parsing fails [0.71ms]
(pass) metadata helpers > derives metadata from the file path when tune info is unavailable [0.53ms]
[jsonl-writer] Writing classification records to: /tmp/sidflow-classify-33i08e/classified/classification_2025-12-13_23-47-17-623.jsonl
[featurePool] Feature worker exited with code: 0
[featurePool] Feature worker exited with code: 0
[featurePool] Feature worker exited with code: 0
(pass) generateAutoTags > writes metadata and auto-tag files with mixed sources [191.22ms]
[jsonl-writer] Writing classification records to: /tmp/sidflow-classify-B9KOXm/classified/classification_2025-12-13_23-47-17-814.jsonl
(pass) generateJsonlOutput > exports JSONL for songs with and without WAV cache [3.65ms]

packages/sidflow-classify/test/render-cli.test.ts:
(pass) render CLI argument parsing > parses engine, format, and SID flags [0.32ms]
(pass) render CLI argument parsing > parses encoder and ffmpeg.wasm overrides [0.07ms]
(pass) render CLI helpers > prefers user provided format overrides [0.05ms]
(pass) render CLI helpers > falls back to config default formats [0.01ms]
(pass) render CLI helpers > deduplicates engine order and appends wasm fallback [0.08ms]
(pass) resolveAudioEncoderOptions > returns undefined when no config or CLI overrides exist [0.09ms]
(pass) resolveAudioEncoderOptions > uses config defaults when no CLI overrides are provided [0.02ms]
(pass) resolveAudioEncoderOptions > prefers CLI overrides and resolves wasm paths [0.03ms]

packages/sidflow-classify/test/essentia-features.test.ts:
Extracted features: {
  "energy": 0.49996907330318746,
  "rms": 0.7070849123713413,
  "zeroCrossingRate": 0.07977324263038549,
  "bpm": 200,
  "confidence": 0.3,
  "spectralCentroid": 2000,
  "spectralRolloff": 4000,
  "sampleRate": 44100,
  "analysisSampleRate": 11025,
  "duration": 2,
  "analysisWindowSec": 2,
  "analysisStartSec": 0,
  "numSamples": 22050,
  "featureSetVersion": "1.1.0",
  "featureVariant": "heuristic",
  "wavBytes": 176444,
  "sidBytes": 14,
  "nameSeed": 73714
}
(pass) essentiaFeatureExtractor > extracts features from a valid WAV file [8.05ms]
(pass) essentiaFeatureExtractor > handles stereo WAV files [7.25ms]
(pass) essentiaFeatureExtractor > throws error for invalid WAV file [0.80ms]
(pass) essentiaFeatureExtractor > handles 32-bit WAV files [5.68ms]
(pass) essentiaFeatureExtractor > handles 8-bit WAV files [5.42ms]

packages/sidflow-classify/test/metrics.test.ts:
(pass) performance metrics > tracks buildAudioCache metrics accurately [4.19ms]
[jsonl-writer] Writing classification records to: /tmp/sidflow-classify-metrics-hY8A5k/tags/classified/classification_2025-12-13_23-47-17-868.jsonl
[featurePool] Feature worker exited with code: 0
[featurePool] Feature worker exited with code: 0
(pass) performance metrics > tracks generateAutoTags metrics with mixed sources [137.94ms]
[jsonl-writer] Writing classification records to: /tmp/sidflow-classify-metrics-DSYJUQ/tags/classified/classification_2025-12-13_23-47-18-005.jsonl
(pass) performance metrics > tracks zero predictions when all files have complete manual tags [2.26ms]
(pass) performance metrics > records timing even for empty file sets [0.72ms]

packages/sidflow-classify/test/max-classify-sec.test.ts:
(pass) maxRenderSec duration capping (render) > defaults to 10s when maxRenderSec is absent [3.44ms]
[classify] maxRenderSec (5) is below the recommended minimum (20); using 20s.
(pass) maxRenderSec duration capping (render) > caps HVSC duration to maxRenderSec when shorter [5.74ms]
(pass) maxRenderSec duration capping (render) > uses HVSC duration when it is below maxRenderSec [9.23ms]
(pass) maxRenderSec duration capping (render) > supports fractional seconds for fast edge cases [2.05ms]

packages/sidflow-classify/test/fast-e2e.test.ts:
[jsonl-writer] Writing classification records to: /tmp/sidflow-fast-e2e-nER5hQ/classified/classification_2025-12-13_23-47-18-044.jsonl
Classification completed in 0.01s
(pass) Fast Classification Pipeline E2E > classifies pre-rendered WAV files in under 10 seconds [6.53ms]
(pass) Fast Classification Pipeline E2E > JSONL output has valid schema and metadata [0.56ms]
(pass) Fast Classification Pipeline E2E > JSONL records are ordered deterministically [0.22ms]
[jsonl-writer] Writing classification records to: /tmp/sidflow-fast-e2e-nER5hQ/classified2/classification_2025-12-13_23-47-18-051.jsonl
(pass) Fast Classification Pipeline E2E > ratings are consistent for same input [7.42ms]

packages/sidflow-classify/test/essentia-classify-e2e.test.ts:

=== ESSENTIA.JS FEATURES EXTRACTED ===
{
  "energy": 0.49996907330318746,
  "rms": 0.7070849123713413,
  "zeroCrossingRate": 0.07977324263038549,
  "bpm": 200,
  "confidence": 0.3,
  "spectralCentroid": 2000,
  "spectralRolloff": 4000,
  "sampleRate": 44100,
  "analysisSampleRate": 11025,
  "duration": 2,
  "analysisWindowSec": 2,
  "analysisStartSec": 0,
  "numSamples": 22050,
  "featureSetVersion": "1.1.0",
  "featureVariant": "heuristic",
  "wavBytes": 176444,
  "sidBytes": 128,
  "nameSeed": 580359
}

 Essentia.js E2E: Features extracted successfully from classification pipeline!
(pass) Essentia.js Classification E2E > extracts essentia.js features from WAV and produces classification data [9.20ms]

packages/sidflow-classify/test/synthetic-classification-e2e.test.ts:
(pass) Synthetic SID Classification E2E > creates synthetic SID and WAV files [0.12ms]
(pass) Synthetic SID Classification E2E > extracts essentia.js features from synthetic WAVs [2.71ms]
(pass) Synthetic SID Classification E2E > writes classification output to JSONL file [0.06ms]
 E2E_Low: energy=0.500, rms=0.707, zcr=0.0398
 E2E_Mid: energy=0.500, rms=0.707, zcr=0.0797
 E2E_High: energy=0.500, rms=0.707, zcr=0.1595
(pass) Synthetic SID Classification E2E > verifies persisted JSONL contains essentia.js features [0.24ms]
 ZCR increases with frequency: 0.0398 < 0.0797 < 0.1595
(pass) Synthetic SID Classification E2E > verifies zero-crossing rate increases with frequency [0.16ms]

packages/sidflow-classify/test/cli.test.ts:
(pass) parseClassifyArgs > parses recognised options [0.14ms]
(pass) parseClassifyArgs > parses skip-already-classified and delete-wav-after-classification flags [0.03ms]
(pass) parseClassifyArgs > flags unknown options [0.02ms]
[featurePool] Feature worker exited with code: 0
[featurePool] Feature worker exited with code: 0
[featurePool] Feature worker exited with code: 0
[featurePool] Feature worker exited with code: 1
(pass) runClassifyCli > executes workflow and prints summary [48.03ms]
(pass) runClassifyCli > reports failures [0.36ms]
(pass) runClassifyCli > prints help when requested [0.14ms]
(pass) runClassifyCli > reports argument parsing errors [0.11ms]
(pass) runClassifyCli > loads override modules through default runtime [5.19ms]
(pass) runClassifyCli > uses undefined for featureExtractor when --feature-module not specified [0.32ms]
Starting classification (threads: 4)
SID path: /workspace/hvsc
WAV cache path: /workspace/wav

(pass) runClassifyCli > fails when override module does not export a function [1.57ms]

packages/sidflow-classify/test/audio-cache-truncates-oversized-wav-on-cache-hit.test.ts:
(pass) buildAudioCache (cache-hit preserves WAV) > does not truncate an oversized cached WAV when needsWavRefresh is false [6.34ms]

packages/sidflow-classify/test/state-machine.test.ts:
(pass) State Machine Configuration > HEARTBEAT_CONFIG has correct values [0.04ms]
(pass) State Machine Configuration > RETRY_CONFIG has correct values for building phase [0.02ms]
(pass) State Machine Configuration > RETRY_CONFIG has correct values for metadata phase [0.02ms]
(pass) State Machine Configuration > RETRY_CONFIG has correct values for tagging phase [0.02ms]
(pass) Thread Counters > createThreadCounters returns correct initial values [0.05ms]
(pass) Thread Counters > createGlobalCounters returns correct initial values [0.04ms]
(pass) Error Classification > isRecoverableError returns true for ENOENT errors [0.06ms]
(pass) Error Classification > isRecoverableError returns true for timeout errors [0.02ms]
(pass) Error Classification > isRecoverableError returns true for busy errors [0.01ms]
(pass) Error Classification > isRecoverableError returns false for invalid file errors [0.01ms]
(pass) Error Classification > isRecoverableError returns false for corrupt data errors [0.01ms]
(pass) Error Classification > isRecoverableError returns false for malformed errors [0.02ms]
(pass) Error Classification > isRecoverableError returns true for unknown errors (default) [0.01ms]
(pass) Error Classification > isRecoverableError returns true for non-Error objects [0.02ms]
(pass) ClassifyError Creation > createClassifyError creates recoverable error from recoverable exception [0.11ms]
(pass) ClassifyError Creation > createClassifyError creates fatal error from non-recoverable exception [0.03ms]
(pass) ClassifyError Creation > createClassifyError accepts custom error code [0.02ms]
(pass) ClassifyError Creation > createClassifyError handles string errors [0.02ms]
(pass) ClassifyError Creation > createClassifyError handles different phases [0.06ms]
(pass) Type Safety > HEARTBEAT_CONFIG is readonly [0.02ms]
(pass) Type Safety > RETRY_CONFIG is readonly [0.02ms]
(pass) Backoff Delay Calculation > calculateBackoffDelay returns base delay for first attempt [0.03ms]
(pass) Backoff Delay Calculation > calculateBackoffDelay applies exponential backoff for building phase [0.02ms]
(pass) Backoff Delay Calculation > calculateBackoffDelay uses linear backoff for metadata phase [0.01ms]
(pass) Backoff Delay Calculation > calculateBackoffDelay uses linear backoff for tagging phase [0.01ms]
(pass) getMaxRetries > returns correct max retries for each phase [0.02ms]
(pass) withRetry > returns result on first successful attempt [0.09ms]
(pass) withRetry > retries on recoverable error and succeeds [301.26ms]
(pass) withRetry > throws after exhausting all retries [51.55ms]
(pass) withRetry > throws immediately on fatal error without retrying [0.24ms]
(pass) withRetry > calls onRetry callback with correct arguments [301.88ms]
(pass) withRetry > uses correct retry count for different phases [803.76ms]

packages/sidflow-classify/test/essentia-integration.test.ts:
(pass) Essentia.js integration in classification > uses Essentia.js feature extractor as default [0.12ms]
[jsonl-writer] Writing classification records to: /tmp/sidflow-essentia-integration-61oJfY/classified/classification_2025-12-13_23-47-19-624.jsonl
(pass) Essentia.js integration in classification > uses Essentia.js by default and extracts audio features [11.15ms]

packages/sidflow-classify/test/render-orchestrator-cli-limit.test.ts:
(pass) RenderOrchestrator (sidplayfp-cli time limits) > passes a Songlengths-based time limit to sidplayfp-cli [37.36ms]
(pass) RenderOrchestrator (sidplayfp-cli time limits) > applies a fallback render cap when no songlength is provided [24.25ms]
(pass) RenderOrchestrator (sidplayfp-cli time limits) > hard-truncates oversized sidplayfp-cli output to the requested cap [22.87ms]

packages/sidflow-classify/test/render-integration.test.ts:
[render-integration] WASM WAV output: 9828 bytes
(pass) Step 8: Integration tests (render engines) > 8.1 - WASM engine > renders SID to WAV with non-zero output [426.40ms]
[render-integration] WASM 8580 output: 9928 bytes
(pass) Step 8: Integration tests (render engines) > 8.1 - WASM engine > renders SID with 8580r5 chip model [425.16ms]
[render-integration] sidplayfp-cli not available, skipping test
(pass) Step 8: Integration tests (render engines) > 8.2 - sidplayfp-cli engine (conditional) > renders SID to WAV if sidplayfp is available [1.27ms]
[render-integration] sidplayfp-cli not found (expected in CI)
(pass) Step 8: Integration tests (render engines) > 8.2 - sidplayfp-cli engine (conditional) > skips gracefully when sidplayfp is not available [0.83ms]
(pass) Step 8: Integration tests (render engines) > 8.3 - ultimate64 orchestrator (mock) > validates ultimate64 configuration schema [0.07ms]
[render-integration] ultimate64 mock: not available (expected)
(pass) Step 8: Integration tests (render engines) > 8.3 - ultimate64 orchestrator (mock) > simulates ultimate64 availability check (always returns unavailable) [0.04ms]
[render-integration] WASM engine: available 
(pass) Step 9: Verification matrix > 9.1 - Engine verification > verifies WASM engine availability [1.54ms]
[render-integration] sidplayfp-cli: unavailable (expected in CI)
(pass) Step 9: Verification matrix > 9.1 - Engine verification > checks sidplayfp-cli availability [1.49ms]
[render-integration] ultimate64: unavailable (expected) 
(pass) Step 9: Verification matrix > 9.1 - Engine verification > validates ultimate64 is correctly marked as unavailable in test env [0.05ms]
[render-integration] 6581 chip: 9928 bytes 
(pass) Step 9: Verification matrix > 9.2 - Format and chip combinations > renders with 6581 chip model [424.01ms]
[render-integration] 8580r5 chip: 9808 bytes 
(pass) Step 9: Verification matrix > 9.2 - Format and chip combinations > renders with 8580r5 chip model [420.89ms]
[render-integration] Forced engine mode: WASM 
(pass) Step 9: Verification matrix > 9.3 - Selection mode verification > validates forced engine selection (WASM only) [0.13ms]
[render-integration] Preferred list with fallback 
(pass) Step 9: Verification matrix > 9.3 - Selection mode verification > validates preferred engine list with fallback [0.05ms]
[render-integration] Fallback mode: WASM (cli=false, u64=false) 
(pass) Step 9: Verification matrix > 9.3 - Selection mode verification > validates availability-based fallback to WASM [1.21ms]
[render-integration] Engine order logging format 
(pass) Step 9: Verification matrix > 9.4 - Logging and output validation > validates [engine-order] logging structure [0.07ms]
[render-integration] Engine chosen logging format 
(pass) Step 9: Verification matrix > 9.4 - Logging and output validation > validates [engine-chosen] logging structure [0.02ms]
[render-integration] Non-zero output: 9808 bytes (expected >1000) 
(pass) Step 9: Verification matrix > 9.4 - Logging and output validation > validates non-zero WAV output requirement [414.83ms]

packages/sidflow-classify/test/is-already-classified.test.ts:
(pass) isAlreadyClassified > should return false when no auto-tags.json exists [1.31ms]
(pass) isAlreadyClassified > should return true when song has classification in auto-tags.json [1.46ms]
(pass) isAlreadyClassified > should return false when song is not in auto-tags.json [4.97ms]
(pass) isAlreadyClassified > should return true for multi-song SID with correct song index [2.33ms]
[classify] Error reading auto-tags for MUSICIANS/T/Test_Artist/test_song.sid: JSON Parse error: Unexpected identifier "not"
(pass) isAlreadyClassified > should return false for malformed auto-tags.json [1.19ms]
(pass) isAlreadyClassified > should return false when entry has no rating dimensions [0.91ms]

packages/sidflow-classify/test/classify-metrics.test.ts:
(pass) Classification Pipeline Metrics > Counter metrics > increments counter by 1 by default [1.07ms]
(pass) Classification Pipeline Metrics > Counter metrics > increments counter by specified amount [0.04ms]
(pass) Classification Pipeline Metrics > Counter metrics > tracks counters with different labels separately [0.07ms]
(pass) Classification Pipeline Metrics > Timer metrics > records single timer observation [0.09ms]
(pass) Classification Pipeline Metrics > Timer metrics > computes timer statistics correctly [0.04ms]
(pass) Classification Pipeline Metrics > Timer metrics > tracks timers with different labels separately [0.04ms]
(pass) Classification Pipeline Metrics > Gauge metrics > sets gauge value [0.04ms]
(pass) Classification Pipeline Metrics > Gauge metrics > overwrites previous gauge value [0.03ms]
(pass) Classification Pipeline Metrics > Gauge metrics > tracks gauges with different labels separately [0.06ms]
(pass) Classification Pipeline Metrics > Prometheus format > formats empty metrics [0.19ms]
(pass) Classification Pipeline Metrics > Prometheus format > formats counters correctly [0.07ms]
(pass) Classification Pipeline Metrics > Prometheus format > formats timers correctly [0.05ms]
(pass) Classification Pipeline Metrics > Prometheus format > formats gauges correctly [0.04ms]
(pass) Classification Pipeline Metrics > Prometheus format > formats labels correctly [0.04ms]
(pass) Classification Pipeline Metrics > Reset > resetMetrics clears all metrics [0.03ms]
(pass) Classification Pipeline Metrics > Reset > resetMetrics resets startedAt [4.61ms]
(pass) Classification Pipeline Metrics > Snapshot isolation > getMetrics returns a copy [0.04ms]

packages/sidflow-classify/test/wav-representative-slice.test.ts:
(pass) sliceWavBufferToRepresentativeStart > shifts start to a high-energy window (intro-skipping) [0.42ms]
(pass) sliceWavBufferToRepresentativeStart > does nothing when maxWindowSeconds covers the whole file [0.07ms]

packages/sidflow-classify/test/tfjs-predictor-enhanced.test.ts:
(pass) Model lifecycle > creates a new model with correct architecture [1.07ms]
(pass) Model lifecycle > saves and loads model correctly [7.92ms]
(pass) Model lifecycle > creates new model if loading fails [0.92ms]
(pass) Feature statistics > computes feature statistics from samples [0.10ms]
(pass) Feature statistics > saves and loads feature statistics [0.61ms]
(pass) Feature statistics > returns default stats if file doesn't exist [0.11ms]
(pass) Model metadata > saves and loads model metadata [0.48ms]
(pass) Model metadata > returns null if metadata file doesn't exist [0.09ms]
(pass) Training > trains model on sample data [48.84ms]
(pass) Training > throws error on empty sample set [0.13ms]
(pass) Evaluation > evaluates model on test set [4.30ms]
(pass) Evaluation > throws error on empty test set [0.10ms]
Failed to load model from data/model/model/model.json: warn: Weight file /workspace/data/model/model/weights.bin does not exist: loading failed
      at <anonymous> (/workspace/node_modules/@tensorflow/tfjs-node/dist/io/file_system.js:69:23)

(pass) Prediction > predicts ratings from features [3.00ms]
(pass) Prediction > predicts ratings with confidence score [1.06ms]
(pass) Prediction > handles missing features gracefully [0.82ms]

packages/sidflow-classify/test/wav-leading-silence-trim.test.ts:
(pass) trimLeadingSilenceWavBuffer > removes a short leading silent prefix [0.21ms]
(pass) trimLeadingSilenceWavBuffer > does not trim when audio starts immediately [0.05ms]

packages/sidflow-classify/test/wav-header-validation.test.ts:
(pass) WAV Header Validation > validates valid mono 16-bit PCM WAV [0.21ms]
(pass) WAV Header Validation > validates valid stereo 16-bit PCM WAV [0.08ms]
(pass) WAV Header Validation > validates 8-bit PCM WAV [0.06ms]
(pass) WAV Header Validation > validates 32-bit PCM WAV [0.05ms]
(pass) WAV Header Validation > rejects non-PCM format [0.08ms]
(pass) WAV Header Validation > rejects unsupported channel count [0.07ms]
(pass) WAV Header Validation > rejects zero channels [0.06ms]
(pass) WAV Header Validation > warns about unusual sample rate (low) [0.07ms]
(pass) WAV Header Validation > warns about unusual sample rate (high) [0.06ms]
(pass) WAV Header Validation > rejects unsupported bits per sample [0.06ms]
(pass) WAV Header Validation > rejects empty audio data [0.09ms]
(pass) WAV Header Validation > warns about very short audio [0.06ms]
(pass) WAV Header Validation > rejects missing RIFF header [0.04ms]
(pass) WAV Header Validation > rejects missing WAVE format [0.04ms]
(pass) WAV Header Validation > handles standard sample rates [0.33ms]

packages/sidflow-classify/test/heuristics.test.ts:
(pass) classification heuristics > extracts basic file statistics for heuristic features [1.48ms]
(pass) classification heuristics > predicts ratings deterministically using heuristics [0.13ms]
(pass) classification heuristics > parses sidplayfp metadata output [0.06ms]
(pass) classification heuristics > falls back to deriving metadata from path [0.04ms]

packages/sidflow-classify/test/jsonl-writer-queue.test.ts:
(pass) JSONL Writer Queue > writes single record to JSONL [0.77ms]
(pass) JSONL Writer Queue > writes multiple records in order [0.74ms]
(pass) JSONL Writer Queue > handles concurrent writes to same file in order [1.36ms]
(pass) JSONL Writer Queue > handles concurrent writes to different files [1.14ms]
(pass) JSONL Writer Queue > tracks write statistics [1.21ms]
(pass) JSONL Writer Queue > returns null for unknown file path [0.15ms]
(pass) JSONL Writer Queue > getAllWriterQueueStats returns all queues [0.60ms]
(pass) JSONL Writer Queue > flushWriterQueue waits for pending writes [0.75ms]
(pass) JSONL Writer Queue > flushWriterQueue returns immediately for unknown file [0.22ms]
[jsonl-writer] Writing classification records to: /path/to/file.jsonl
[jsonl-writer] Writing classification records to: /path/to/other.jsonl
(pass) JSONL Writer Queue > logJsonlPathOnce only logs once per path [0.14ms]
(pass) JSONL Writer Queue > clearWriterQueues resets all state [0.45ms]
(pass) JSONL Writer Queue > writes batch of records atomically [0.50ms]

packages/sidflow-classify/test/multithread-render.test.ts:
[classify] Force rebuild requested - cleaning audio cache...
[classify] Deleted 0 audio files from cache
[wasmRenderPool] Worker exited with code: 0
[wasmRenderPool] Worker exited with code: 0
(pass) defaultRenderWav with worker pool > renders multiple SID files to WAV using parallel workers [1457.56ms]

packages/sidflow-classify/test/wav-renderer-duration-cap.test.ts:
(pass) renderWavWithEngine duration caps > does not exceed targetDurationMs when provided [2.28ms]
(pass) renderWavWithEngine duration caps > does not exceed maxRenderSeconds when targetDurationMs is longer [0.67ms]
(pass) renderWavWithEngine duration caps > rounds down so sub-second targets never exceed the requested duration [0.57ms]

packages/sidflow-play/test/playback.test.ts:
(pass) PlaybackController > creates playback controller instance [0.23ms]
(pass) PlaybackController > initial state is IDLE [0.04ms]
(pass) PlaybackController > loadQueue loads songs into queue [0.07ms]
(pass) PlaybackController > getCurrentSong returns undefined when queue not started [0.04ms]
(pass) PlaybackController > getQueue returns queue information [0.04ms]
(pass) PlaybackController > throws error when playing empty queue [0.12ms]
(pass) PlaybackController > stop resets state [0.59ms]
(pass) PlaybackController > emits started event when playback begins [0.09ms]
(pass) PlaybackController > respects minDuration setting [0.03ms]
(pass) PlaybackController > skips songs shorter than minDuration [0.13ms]
(pass) PlaybackController > pause emits paused event when playing [0.24ms]
(pass) PlaybackController > resume emits resumed event when paused [0.17ms]
(pass) PlaybackController > play resumes from paused state [0.08ms]
(pass) PlaybackController > skip emits skipped event and advances queue [0.14ms]
(pass) PlaybackController > finished event advances to next song [2.56ms]

packages/sidflow-play/test/filters.test.ts:
(pass) parseFilters > parses empty string [0.16ms]
(pass) parseFilters > parses single >= expression [0.08ms]
(pass) parseFilters > parses single <= expression [0.03ms]
(pass) parseFilters > parses single = expression [0.02ms]
(pass) parseFilters > parses single > expression [0.02ms]
(pass) parseFilters > parses single < expression [0.01ms]
(pass) parseFilters > parses BPM range [0.02ms]
(pass) parseFilters > parses energy range [0.02ms]
(pass) parseFilters > parses mood range [0.01ms]
(pass) parseFilters > parses complexity range [0.01ms]
(pass) parseFilters > parses preference range [0.02ms]
(pass) parseFilters > parses multiple filters [0.02ms]
(pass) parseFilters > parses complex filter expression [0.02ms]
(pass) parseFilters > parses preference filter [0.01ms]
(pass) parseFilters > throws error for invalid expression [0.13ms]
(pass) parseFilters > throws error for unknown dimension [0.02ms]
(pass) parseFilters > handles whitespace [0.02ms]
(pass) formatFilters > formats empty filters [0.10ms]
(pass) formatFilters > formats single range [0.02ms]
(pass) formatFilters > formats exact value [0.01ms]
(pass) formatFilters > formats range expression [0.01ms]
(pass) formatFilters > formats preference range [0.01ms]
(pass) formatFilters > formats preference exact value [0.01ms]
(pass) formatFilters > formats preference with upper bound [0.02ms]
(pass) formatFilters > formats preference bounded range [0.01ms]
(pass) formatFilters > formats multiple filters [0.02ms]
(pass) formatFilters > round-trip formatting [0.04ms]

packages/sidflow-play/test/session.test.ts:
(pass) SessionManager > creates session manager instance [0.07ms]
(pass) SessionManager > getSession returns undefined before starting [0.04ms]
(pass) SessionManager > startSession creates new session [0.16ms]
(pass) SessionManager > recordEvent adds event to history [0.12ms]
(pass) SessionManager > recordEvent updates statistics [0.06ms]
(pass) SessionManager > endSession persists session to disk [0.86ms]
(pass) SessionManager > listSessions returns session IDs [0.47ms]
(pass) SessionManager > loadSession returns undefined for non-existent session [0.14ms]

packages/sidflow-play/test/cli.test.ts:
(pass) CLI argument parsing > parses help flag [0.13ms]
(pass) CLI argument parsing > parses mood option [0.07ms]
(pass) CLI argument parsing > parses filters option [0.03ms]
(pass) CLI argument parsing > parses limit option [0.05ms]
(pass) CLI argument parsing > parses exploration option [0.04ms]
(pass) CLI argument parsing > parses diversity option [0.05ms]
(pass) CLI argument parsing > parses export options [0.07ms]
(pass) CLI argument parsing > parses min-duration option [0.04ms]
(pass) CLI argument parsing > returns error for invalid min-duration [0.05ms]
(pass) CLI argument parsing > parses export-only flag [0.04ms]
(pass) CLI argument parsing > parses play-only flag [0.03ms]
(pass) CLI argument parsing > parses multiple options [0.05ms]
(pass) CLI argument parsing > returns error for missing option value [0.03ms]
(pass) CLI argument parsing > returns error for invalid limit [0.06ms]
(pass) CLI argument parsing > returns error for invalid exploration [0.03ms]
(pass) CLI argument parsing > accepts export format during parsing [0.03ms]
(pass) CLI argument parsing > returns error for unknown option [0.02ms]
(pass) CLI argument parsing > returns error for unexpected argument [0.04ms]
(pass) runPlayCli > runs full playback flow with overrides [2.25ms]
(pass) runPlayCli > handles export-only mode without playback [0.39ms]
(pass) runPlayCli > reports unknown mood presets [0.24ms]
(pass) runPlayCli > reports database missing errors [0.42ms]
(pass) runPlayCli > handles filter parsing errors [0.22ms]
(pass) runPlayCli > prints help when requested [0.09ms]
(pass) runPlayCli > reports argument parsing errors [0.11ms]
(pass) runPlayCli > reports invalid export format at runtime [0.11ms]

packages/sidflow-play/test/export.test.ts:
(pass) exportPlaylistJSON > exports playlist to JSON format [0.85ms]
(pass) exportPlaylistJSON > uses deterministic ordering [0.34ms]
(pass) exportPlaylistM3U > exports playlist to basic M3U format [0.35ms]
(pass) exportPlaylistM3U > exports playlist with extended M3U format [0.27ms]
(pass) exportPlaylistM3U > exports with root path prefix [0.14ms]
(pass) exportPlaylist > exports in JSON format [0.26ms]
(pass) exportPlaylist > exports in M3U format [0.14ms]
(pass) exportPlaylist > exports in extended M3U format [0.15ms]

packages/sidflow-play/test/playlist.test.ts:
(pass) PlaylistBuilder > creates playlist builder instance [0.15ms]
(pass) PlaylistBuilder > getMoodPresets returns available presets [0.06ms]
(pass) PlaylistBuilder > throws when build is called before connect [0.16ms]
(pass) PlaylistBuilder > connects, builds, and disconnects [6.07ms]
(pass) PlaylistBuilder > supports custom seed and filters [4.17ms]

packages/sidflow-performance/test/journey-loader.test.ts:
(pass) journey-loader > loadJourneyFile > loads JSON journey file [1.33ms]
(pass) journey-loader > loadJourneyFile > loads JSON journey file with // comments [0.81ms]
(pass) journey-loader > loadJourneyFile > loads YAML journey file with .yaml extension [9.13ms]
(pass) journey-loader > loadJourneyFile > loads YAML journey file with .yml extension [1.78ms]
(pass) journey-loader > loadJourneyFile > applies default pacing when not specified [0.77ms]
(pass) journey-loader > loadJourneyFile > uses spec pacing when provided [0.39ms]
(pass) journey-loader > loadJourneyFile > uses options pacing when spec pacing not provided [2.38ms]
(pass) journey-loader > loadJourneyFile > prefers spec pacing over options pacing [0.49ms]
(pass) journey-loader > loadJourneyFile > throws error for unsupported file extension [0.62ms]
(pass) journey-loader > loadJourneyFile > throws error for missing id field [0.39ms]
(pass) journey-loader > loadJourneyFile > throws error for non-string id field [0.29ms]
(pass) journey-loader > loadJourneyFile > throws error for missing steps array [0.31ms]
(pass) journey-loader > loadJourneyFile > throws error for empty steps array [0.29ms]
(pass) journey-loader > loadJourneyFile > throws error for invalid JSON [0.26ms]
(pass) journey-loader > loadJourneyFile > throws error for invalid YAML [1.35ms]
(pass) journey-loader > loadJourneysFromDir > loads multiple journey files from directory [1.48ms]
(pass) journey-loader > loadJourneysFromDir > ignores non-journey files [0.70ms]
(pass) journey-loader > loadJourneysFromDir > ignores subdirectories [0.56ms]
(pass) journey-loader > loadJourneysFromDir > returns empty array for empty directory [0.22ms]
(pass) journey-loader > loadJourneysFromDir > applies options pacing to all loaded journeys [0.76ms]

packages/sidflow-performance/test/playwright-executor.test.ts:
(pass) playwright-executor > generatePlaywrightScriptContent > generates script with required imports [1.23ms]
(pass) playwright-executor > generatePlaywrightScriptContent > includes baseUrl constant [0.30ms]
(pass) playwright-executor > generatePlaywrightScriptContent > uses spec pacing when provided [0.27ms]
(pass) playwright-executor > generatePlaywrightScriptContent > uses options pacing when spec pacing not provided [0.35ms]
(pass) playwright-executor > generatePlaywrightScriptContent > uses default pacing when neither spec nor options provide it [0.16ms]
(pass) playwright-executor > generatePlaywrightScriptContent > launches browser in headless mode by default [0.18ms]
(pass) playwright-executor > generatePlaywrightScriptContent > launches browser in headed mode when specified [0.14ms]
(pass) playwright-executor > generatePlaywrightScriptContent > creates multiple user journeys in parallel [0.16ms]
(pass) playwright-executor > generatePlaywrightScriptContent > converts navigate step correctly [0.13ms]
(pass) playwright-executor > generatePlaywrightScriptContent > converts click step with error handling [0.17ms]
(pass) playwright-executor > generatePlaywrightScriptContent > converts type step with error handling [0.14ms]
(pass) playwright-executor > generatePlaywrightScriptContent > converts waitForText step with error handling [0.15ms]
(pass) playwright-executor > generatePlaywrightScriptContent > converts selectTrack step with testId [0.18ms]
(pass) playwright-executor > generatePlaywrightScriptContent > converts startPlayback step without expectStream [0.15ms]
(pass) playwright-executor > generatePlaywrightScriptContent > converts startPlayback step with expectStream [0.15ms]
(pass) playwright-executor > generatePlaywrightScriptContent > converts favoriteToggle step [0.19ms]
(pass) playwright-executor > generatePlaywrightScriptContent > handles unsupported action types [0.18ms]
(pass) playwright-executor > generatePlaywrightScriptContent > adds pacing wait after each step [0.20ms]
(pass) playwright-executor > generatePlaywrightScriptContent > generates complete journey function structure [0.19ms]
(pass) playwright-executor > generatePlaywrightScriptContent > sets browser context with baseURL and viewport [0.15ms]
(pass) playwright-executor > generatePlaywrightScriptContent > includes selector timeout in step error handling [0.14ms]
(pass) playwright-executor > generatePlaywrightScriptContent > handles steps with special characters in selectors [0.16ms]
(pass) playwright-executor > generatePlaywrightScriptContent > handles steps with special characters in values [0.14ms]
(pass) playwright-executor > buildPlaywrightScriptPath > generates correct script path structure [0.17ms]
(pass) playwright-executor > buildPlaywrightScriptPath > pads user count to 3 digits [0.14ms]
(pass) playwright-executor > buildPlaywrightScriptPath > includes journey id in filename [0.13ms]
(pass) playwright-executor > buildPlaywrightScriptPath > creates path under playwright subdirectory [0.12ms]
(pass) playwright-executor > buildPlaywrightScriptPath > uses .spec.ts extension [0.14ms]

packages/sidflow-performance/test/action-map.test.ts:
(pass) action-map > stepToK6Request > converts navigate step to health check request [0.12ms]
(pass) action-map > stepToK6Request > converts navigate step with custom mapping [0.03ms]
(pass) action-map > stepToK6Request > converts click step to UI-only comment [0.02ms]
(pass) action-map > stepToK6Request > converts waitForText step to UI-only comment [0.01ms]
(pass) action-map > stepToK6Request > converts type step to search request [0.02ms]
(pass) action-map > stepToK6Request > handles special characters in type step value [0.01ms]
(pass) action-map > stepToK6Request > converts selectTrack step with trackRef lookup [0.02ms]
(pass) action-map > stepToK6Request > converts selectTrack step without trackRef lookup [0.02ms]
(pass) action-map > stepToK6Request > converts selectTrack step with empty data [0.02ms]
(pass) action-map > stepToK6Request > converts startPlayback step to stream request [0.02ms]
(pass) action-map > stepToK6Request > converts favoriteToggle step with add action [0.02ms]
(pass) action-map > stepToK6Request > converts favoriteToggle step with remove action [0.02ms]
(pass) action-map > stepToK6Request > returns unsupported comment for unknown action
(pass) action-map > defaultK6Mapping > provides expected default endpoints [0.02ms]

packages/sidflow-performance/test/k6-executor.test.ts:
(pass) k6-executor > generateK6ScriptContent > generates basic k6 script with required imports [1.14ms]
(pass) k6-executor > generateK6ScriptContent > sets VUs to specified users [0.79ms]
(pass) k6-executor > generateK6ScriptContent > uses spec pacing when provided [0.26ms]
(pass) k6-executor > generateK6ScriptContent > uses options pacing when spec pacing not provided [0.25ms]
(pass) k6-executor > generateK6ScriptContent > uses default pacing when neither spec nor options provide it [0.17ms]
(pass) k6-executor > generateK6ScriptContent > sets iterations based on options when provided [0.16ms]
(pass) k6-executor > generateK6ScriptContent > defaults iterations to step count when not provided [0.15ms]
(pass) k6-executor > generateK6ScriptContent > includes strict thresholds by default [0.17ms]
(pass) k6-executor > generateK6ScriptContent > disables thresholds when strictThresholds is false [0.13ms]
(pass) k6-executor > generateK6ScriptContent > includes baseUrl constant [0.14ms]
(pass) k6-executor > generateK6ScriptContent > includes trackRefs data when present [0.18ms]
(pass) k6-executor > generateK6ScriptContent > handles empty trackRefs gracefully [0.16ms]
(pass) k6-executor > generateK6ScriptContent > handles missing data field gracefully [0.14ms]
(pass) k6-executor > generateK6ScriptContent > generates complete function body with all step types [0.17ms]
(pass) k6-executor > generateK6ScriptContent > handles empty steps array [0.15ms]
(pass) k6-executor > generateK6ScriptContent > adds sleep after each step [0.24ms]
(pass) k6-executor > buildK6ScriptPath > generates correct script path structure [0.21ms]
(pass) k6-executor > buildK6ScriptPath > pads user count to 3 digits [0.17ms]
(pass) k6-executor > buildK6ScriptPath > includes journey id in filename [0.14ms]
(pass) k6-executor > buildK6ScriptPath > creates path under k6 subdirectory [0.14ms]

packages/sidflow-performance/test/runner.test.ts:
(pass) journey loader > applies default pacing when missing [1.20ms]
(pass) script generation > includes pacing waits in Playwright script [0.13ms]
(pass) script generation > includes k6 dashboard export env in script metadata [0.06ms]
(pass) runner > generates scripts and report with remote guard disabled by default [5.21ms]
(pass) runner > refuses remote runs without enableRemote [0.59ms]
(pass) runner > enforces k6 SLO thresholds when summaries exceed limits [2.14ms]
(pass) runner > retries playwright executions when configured [1.83ms]

packages/sidflow-rate/test/index.test.ts:
(pass) planTagSession > creates tagging plan with defaults [1.88ms]
(pass) tagging workflow helpers > resolves tag file paths relative to HVSC root [0.07ms]
(pass) tagging workflow helpers > finds untagged SIDs and skips tagged ones [1.20ms]
(pass) tagging workflow helpers > writes deterministic manual tag files [0.48ms]
(pass) tagging workflow helpers > interprets keyboard sequences for slider updates and actions [0.11ms]
(pass) tagging workflow helpers > clears pending dimension on invalid key [0.02ms]
(pass) tagging workflow helpers > includes preference rating when present [0.65ms]
(pass) tagging workflow helpers > handles non-directory root path gracefully [0.67ms]
(pass) shuffleInPlace > shuffles array deterministically with seeded random [0.16ms]
(pass) shuffleInPlace > shuffles array with default Math.random [0.03ms]

packages/sidflow-web/tests/unit/remix-radar.test.ts:
(pass) Remix Radar helpers > tokenizeTitle > removes stop words and punctuation [0.12ms]
(pass) Remix Radar helpers > tokenizeTitle > handles empty string [0.01ms]
(pass) Remix Radar helpers > tokenizeTitle > handles only stop words [0.02ms]
(pass) Remix Radar helpers > tokenizeTitle > filters single character tokens [0.01ms]
(pass) Remix Radar helpers > tokenizeTitle > returns sorted tokens [0.02ms]
(pass) Remix Radar helpers > tokenizeTitle > handles numbers [0.03ms]
(pass) Remix Radar helpers > tokenizeTitle > normalizes case [0.01ms]
(pass) Remix Radar helpers > tokenizeTitle > removes remix-related stop words [0.01ms]
(pass) Remix Radar helpers > calculateTitleSimilarity > returns high score for related titles [0.11ms]
(pass) Remix Radar helpers > calculateTitleSimilarity > returns low score for different titles [0.04ms]
(pass) Remix Radar helpers > calculateTitleSimilarity > returns 1.0 for identical titles [0.02ms]
(pass) Remix Radar helpers > calculateTitleSimilarity > returns 0 for empty titles [0.03ms]
(pass) Remix Radar helpers > calculateTitleSimilarity > handles case insensitivity [0.02ms]
(pass) Remix Radar helpers > calculateTitleSimilarity > boosts containment similarity [0.01ms]
(pass) Remix Radar helpers > calculateTitleSimilarity > calculates Jaccard similarity [0.02ms]
(pass) Remix Radar helpers > calculateTitleSimilarity > is symmetric [0.04ms]
(pass) Remix Radar helpers > calculateTitleSimilarity > returns value between 0 and 1 [0.06ms]
(pass) Remix Radar helpers > normalizeComposerName > lowercases and strips punctuation [0.03ms]
(pass) Remix Radar helpers > normalizeComposerName > handles empty/null values [0.01ms]
(pass) Remix Radar helpers > normalizeComposerName > removes special characters [0.01ms]
(pass) Remix Radar helpers > normalizeComposerName > collapses multiple spaces
(pass) Remix Radar helpers > normalizeComposerName > trims whitespace
(pass) Remix Radar helpers > normalizeComposerName > preserves numbers
(pass) Remix Radar helpers > computeRemixScore > weights title similarity more than style match [0.02ms]
(pass) Remix Radar helpers > computeRemixScore > returns value between 0 and 1 [0.01ms]
(pass) Remix Radar helpers > computeRemixScore > gives highest weight to title similarity (70%)
(pass) Remix Radar helpers > computeRemixScore > gives medium weight to style match (25%)
(pass) Remix Radar helpers > computeRemixScore > gives lowest weight to feedback boost (5%)
(pass) Remix Radar helpers > computeRemixScore > handles edge case of all zeros
(pass) Remix Radar helpers > computeRemixScore > handles edge case of all ones [0.01ms]
(pass) Remix Radar helpers > computeRemixScore > is deterministic [0.01ms]

packages/sidflow-web/tests/unit/similarity-search-validation.test.ts:
(pass) Similarity Search Validation > should accept valid minSimilarity values [0.94ms]
(pass) Similarity Search Validation > should accept valid discovery values [0.04ms]
(pass) Similarity Search Validation > should accept valid limit values [0.02ms]
(pass) Similarity Search Validation > should calculate correct minSimilarity based on discovery [0.01ms]
(pass) Similarity Search Validation > should handle edge cases for discovery calculation [0.02ms]

packages/sidflow-web/tests/unit/playback-history.test.ts:
(pass) Playback History > getPlaybackHistory > should return empty array initially [0.12ms]
(pass) Playback History > getPlaybackHistory > should return stored history [0.05ms]
Failed to load playback history: 31 |     const stored = localStorage.getItem(HISTORY_KEY);
32 |     if (!stored) {
33 |       return [];
34 |     }
35 | 
36 |     const parsed = JSON.parse(stored);
                             ^
SyntaxError: JSON Parse error: Unexpected identifier "invalid"
      at getPlaybackHistory (/workspace/packages/sidflow-web/lib/playback-history.ts:36:25)
      at <anonymous> (/workspace/packages/sidflow-web/tests/unit/playback-history.test.ts:73:23)

(pass) Playback History > getPlaybackHistory > should handle corrupted storage gracefully [0.14ms]
(pass) Playback History > addToPlaybackHistory > should add a track to history [0.13ms]
(pass) Playback History > addToPlaybackHistory > should add track with metadata [0.07ms]
(pass) Playback History > addToPlaybackHistory > should add new tracks at the beginning [0.08ms]
(pass) Playback History > addToPlaybackHistory > should remove duplicates and keep most recent [0.09ms]
(pass) Playback History > addToPlaybackHistory > should limit history to 100 entries [11.77ms]
(pass) Playback History > clearPlaybackHistory > should clear all history [0.16ms]
(pass) Playback History > getRecentHistory > should return last 20 tracks by default [0.69ms]
(pass) Playback History > getRecentHistory > should respect custom limit [0.62ms]
(pass) Playback History > removeFromHistory > should remove specific track from history [0.15ms]
(pass) Playback History > removeFromHistory > should handle removing non-existent track [0.04ms]
(pass) Playback History > isInHistory > should return true for tracks in history [0.05ms]
(pass) Playback History > isInHistory > should return false for tracks not in history [0.02ms]
(pass) Playback History > getHistoryCount > should return 0 for empty history [0.02ms]
(pass) Playback History > getHistoryCount > should return correct count [0.03ms]

packages/sidflow-web/tests/unit/preferences-storage.test.ts:
(pass) preferences storage > reads null preferences when nothing stored [2.43ms]
(pass) preferences storage > round trips preferences through indexeddb [0.83ms]
(pass) preferences storage > stores and loads rom bundle files [0.49ms]
(pass) preferences storage > removes rom bundle data by bundle id [1.17ms]

packages/sidflow-web/tests/unit/rate-limiter.test.ts:
(pass) RateLimiter > allows requests under limit [0.16ms]
(pass) RateLimiter > blocks requests over limit [0.05ms]
(pass) RateLimiter > tracks different IPs independently [0.03ms]
(pass) RateLimiter > resets after window expires [111.21ms]
(pass) RateLimiter > implements sliding window correctly [111.57ms]
(pass) RateLimiter > skips rate limiting for whitelisted IPs [0.16ms]
(pass) RateLimiter > reset clears specific client [0.08ms]
(pass) RateLimiter > reset without IP clears all clients [0.05ms]
(pass) RateLimiter > cleanup removes expired logs [110.46ms]
(pass) RateLimiter > getStats returns accurate counts [0.11ms]
(pass) RateLimiter > calculates correct retry-after time [0.08ms]
(pass) RateLimiter > handles concurrent requests correctly [0.05ms]
(pass) getClientIp > extracts IP from x-forwarded-for header [0.07ms]
(pass) getClientIp > extracts IP from x-real-ip header [0.02ms]
(pass) getClientIp > prefers x-forwarded-for over x-real-ip [0.04ms]
(pass) getClientIp > trims whitespace from IP [0.02ms]
(pass) getClientIp > returns localhost when no headers present [0.01ms]
(pass) getClientIp > handles empty x-forwarded-for header [0.02ms]
(pass) Rate limiter configuration > accepts custom maxRequests [0.04ms]
(pass) Rate limiter configuration > accepts custom windowMs [61.23ms]
(pass) Rate limiter configuration > accepts custom skipIps [0.16ms]

packages/sidflow-web/tests/unit/hvsc-browse.test.ts:
(pass) HVSC Browse API > Path validation > validates relative path is within root [0.04ms]
(pass) HVSC Browse API > Path validation > rejects path traversal attempts [0.02ms]
(pass) HVSC Browse API > Path validation > handles empty path (root listing) [0.02ms]
(pass) HVSC Browse API > Path validation > normalizes path separators [0.02ms]
(pass) HVSC Browse API > Parent path calculation > calculates parent for nested path [0.01ms]
(pass) HVSC Browse API > Parent path calculation > calculates parent for single-level path [0.01ms]
(pass) HVSC Browse API > Parent path calculation > returns undefined for root path [0.02ms]
(pass) HVSC Browse API > Parent path calculation > handles parent of dot correctly
(pass) HVSC Browse API > Item sorting > sorts folders before files [0.07ms]
(pass) HVSC Browse API > Item sorting > sorts items alphabetically within type [0.05ms]
(pass) HVSC Browse API > Item sorting > case-insensitive sorting [0.11ms]
(pass) HVSC Browse API > SID file detection > detects .sid extension (lowercase) [0.01ms]
(pass) HVSC Browse API > SID file detection > detects .sid extension (uppercase) [0.01ms]
(pass) HVSC Browse API > SID file detection > detects .sid extension (mixed case) [0.01ms]
(pass) HVSC Browse API > SID file detection > rejects non-SID files [0.07ms]
(pass) HVSC Browse API > SID header parsing > extracts subtune count from header [0.10ms]
(pass) HVSC Browse API > SID header parsing > defaults to 1 if songs count is 0 [0.03ms]
(pass) HVSC Browse API > SID header parsing > handles single-song SID files [0.02ms]
(pass) HVSC Browse API > SID header parsing > handles multi-song SID files [0.02ms]
(pass) HVSC Browse API > SID header parsing > defaults to 1 for truncated/invalid files [0.02ms]
(pass) HVSC Browse API > Response structure > includes success flag [0.02ms]
(pass) HVSC Browse API > Response structure > includes requested path [0.01ms]
(pass) HVSC Browse API > Response structure > includes items array [0.02ms]
(pass) HVSC Browse API > Response structure > includes parent path for nested locations
(pass) HVSC Browse API > Response structure > omits parent for root [0.01ms]
(pass) HVSC Browse API > Response structure > includes error message on failure [0.01ms]

packages/sidflow-web/tests/unit/feedback-runtime.test.ts:
(pass) feedback runtime > does not queue training when disabled [0.76ms]
(pass) feedback runtime > queues training when enabled [0.08ms]
(pass) feedback runtime > manual training respects preference toggle [0.12ms]
(pass) feedback runtime > sync scheduler only fires when uploads allowed [0.09ms]
(pass) feedback runtime > exposes runtime state with defaults when disabled [0.04ms]

packages/sidflow-web/tests/unit/model-api.test.ts:
(pass) Model API - GET /api/model/latest > should return model manifest with metadata [1.30ms]
(pass) Model API - GET /api/model/latest > should include feature stats [1.25ms]
(pass) Model API - GET /api/model/latest > should include model topology [0.54ms]
(pass) Model API - GET /api/model/latest > should include weight specs [0.47ms]
(pass) Model API - GET /api/model/latest > should include base64-encoded weight data [0.29ms]
(pass) Model API - GET /api/model/latest > should set appropriate cache headers [0.25ms]
(pass) Model API - GET /api/model/latest > should handle missing feature stats gracefully [0.47ms]
(pass) Model API - GET /api/model/latest > should handle missing model topology gracefully [0.38ms]
[Model API] Falling back to stub manifest {
  resolvedPath: "/tmp/model-api-test-dd5062ea7cb07d9a/model",
}
(pass) Model API - GET /api/model/latest > should return stub manifest if model metadata is missing [0.37ms]

packages/sidflow-web/tests/unit/classify-progress-store.test.ts:
(pass) classify-progress-store > beginClassifyProgress > initializes progress with correct thread count [1.24ms]
(pass) classify-progress-store > beginClassifyProgress > parses render engine preference correctly [0.03ms]
(pass) classify-progress-store > beginClassifyProgress > initializes counters to zero [0.03ms]
(pass) classify-progress-store > completeClassifyProgress > sets phase to completed and deactivates [0.06ms]
(pass) classify-progress-store > failClassifyProgress > sets phase to error and records message [0.03ms]
(pass) classify-progress-store > pauseClassifyProgress > sets phase to paused [0.03ms]
[engine-stall] Thread 1: no audio (streak: 1)
[engine-stall] Thread 1: no audio (streak: 2)
(pass) classify-progress-store > recordNoAudioEvent > increments noAudioStreak for the thread [0.06ms]
(pass) classify-progress-store > recordNoAudioEvent > ignores invalid thread IDs [0.02ms]
(pass) classify-progress-store > checkGlobalStall > returns false when not active [0.04ms]
(pass) classify-progress-store > checkGlobalStall > returns false when threads are not stale [0.02ms]
(pass) classify-progress-store > ingestClassifyStdout > thread count detection > updates thread count from "threads: N" line [0.36ms]
(pass) classify-progress-store > ingestClassifyStdout > thread status updates > parses old format [Thread X][PHASE][STATUS] [0.17ms]
[classify-engine] [Thread 1] Rendering: /path/to/file.sid
(pass) classify-progress-store > ingestClassifyStdout > thread status updates > parses new format [Thread X] Rendering: file [0.08ms]
(pass) classify-progress-store > ingestClassifyStdout > thread status updates > parses analyzing action [0.02ms]
(pass) classify-progress-store > ingestClassifyStdout > thread status updates > parses reading metadata action [0.02ms]
[classify-engine] [Thread 1] Extracting features: /path/to/file.sid
(pass) classify-progress-store > ingestClassifyStdout > thread status updates > parses extracting features action [0.02ms]
(pass) classify-progress-store > ingestClassifyStdout > thread status updates > handles IDLE status [0.03ms]
(pass) classify-progress-store > ingestClassifyStdout > global progress updates > parses analyzing progress line [0.04ms]
(pass) classify-progress-store > ingestClassifyStdout > global progress updates > parses converting progress line [0.05ms]
(pass) classify-progress-store > ingestClassifyStdout > global progress updates > parses metadata progress line [0.07ms]
[classify-engine] [Extracting Features] 80/100 files (80.0%)
(pass) classify-progress-store > ingestClassifyStdout > global progress updates > parses extracting features progress line [0.04ms]
[classify-engine] [Writing Features] 90/100 files (90.0%)
(pass) classify-progress-store > ingestClassifyStdout > global progress updates > parses writing features progress line [0.02ms]
[classify-essentia] Thread 1: 12 features from test.sid in 150ms (Essentia: true)
(pass) classify-progress-store > ingestClassifyStdout > structured log parsing > parses Essentia extraction log line [0.05ms]
[classify-render] Thread 2: rendered test.sid in 200ms
(pass) classify-progress-store > ingestClassifyStdout > structured log parsing > parses WAV render log line [0.04ms]
[classify-essentia] Thread 1: 12 features from test1.sid in 150ms (Essentia: true)
[classify-essentia] Thread 2: 8 features from test2.sid in 100ms (Essentia: false)
(pass) classify-progress-store > ingestClassifyStdout > structured log parsing > accumulates multiple extractions [0.03ms]
[classify-engine] [Thread 1] Rendering: file1.sid
[classify-engine] [Thread 2] Rendering: file2.sid
(pass) classify-progress-store > ingestClassifyStdout > multiline handling > handles multiple lines in a single chunk [0.03ms]
[classify-engine] [Thread 1] Rendering: longfile.sid
(pass) classify-progress-store > ingestClassifyStdout > multiline handling > buffers incomplete lines across chunks [0.02ms]
(pass) classify-progress-store > getClassifyProgressSnapshot > returns a copy of the current state [0.03ms]
(pass) classify-progress-store > getClassifyProgressSnapshot > includes all required fields [0.04ms]
[classify-engine] [Thread 1] Rendering: file.sid
(pass) classify-progress-store > edge cases > handles carriage returns in stdout [0.05ms]
(pass) classify-progress-store > edge cases > ignores empty lines [0.03ms]
(pass) classify-progress-store > edge cases > completeClassifyProgress sets taggedFiles to total when complete [0.03ms]
[classify-engine] [Thread 1] Rendering: file1.sid
[classify-engine] [Thread 1] Extracting features: file1.sid
(pass) classify-progress-store > edge cases > tracks phase transitions through thread updates [0.08ms]
(pass) classify-progress-store > edge cases > tracks rendered file count when transitioning from building to tagging [0.13ms]
[classify-engine] [Thread 1] Extracting features: /path/to/file.sid
[classify-engine] [Thread 1] Extracting features: /path/to/file.sid
(pass) classify-progress-store > stale threshold for feature extraction > uses 30 second stale threshold to accommodate long feature extractions [0.07ms]
[classify-engine] [Thread 1] Extracting features: /path/to/file1.sid
[classify-engine] [Thread 2] Extracting features: /path/to/file2.sid
(pass) classify-progress-store > stale threshold for feature extraction > marks threads stale only after 30 seconds without update [0.06ms]

packages/sidflow-web/tests/unit/format-error.test.ts:
(pass) formatApiError > returns base error message when no details are present [1.16ms]
(pass) formatApiError > appends details when available [0.07ms]
(pass) formatApiError > handles Error instances gracefully [0.02ms]
(pass) formatApiError > returns string inputs verbatim [0.01ms]
(pass) formatApiError > falls back to summary for arbitrary objects [0.03ms]
(pass) formatApiError > returns generic message for nullish inputs [0.01ms]

packages/sidflow-web/tests/unit/search-index.test.ts:
(pass) SearchIndex > Basic Search > should find tracks by title [2.04ms]
(pass) SearchIndex > Basic Search > should find tracks by artist [0.41ms]
(pass) SearchIndex > Basic Search > should find tracks by partial match [0.24ms]
(pass) SearchIndex > Basic Search > should return empty array for no matches [0.22ms]
(pass) SearchIndex > Basic Search > should respect limit parameter [0.29ms]
(pass) SearchIndex > Year Filters > should filter by minimum year [0.24ms]
(pass) SearchIndex > Year Filters > should filter by maximum year [0.25ms]
(pass) SearchIndex > Year Filters > should filter by year range [0.76ms]
(pass) SearchIndex > Chip Model Filters > should filter by chip model [1.02ms]
(pass) SearchIndex > Chip Model Filters > should return no results for non-matching chip model [0.55ms]
(pass) SearchIndex > Duration Filters > should filter by minimum duration [0.30ms]
(pass) SearchIndex > Duration Filters > should filter by maximum duration [0.28ms]
(pass) SearchIndex > Duration Filters > should filter by duration range [0.28ms]
(pass) SearchIndex > Rating Filters > should filter by minimum rating [0.29ms]
(pass) SearchIndex > Rating Filters > should exclude tracks with low ratings [0.28ms]
(pass) SearchIndex > Combined Filters > should apply multiple filters together [0.76ms]
(pass) SearchIndex > Combined Filters > should return empty array when filters exclude all results [0.65ms]

packages/sidflow-web/tests/unit/anonymize.test.ts:
(pass) anonymizeSessionId > hashes session ID deterministically [1.11ms]
(pass) anonymizeSessionId > produces different hashes for different session IDs [0.05ms]
(pass) anonymizeSessionId > handles empty session ID [0.01ms]
(pass) anonymizeSessionId > hash is hex-encoded string [0.04ms]
(pass) anonymizeFilePath > extracts relative path from MUSICIANS marker [0.07ms]
(pass) anonymizeFilePath > extracts relative path from DEMOS marker [0.01ms]
(pass) anonymizeFilePath > extracts relative path from GAMES marker [0.01ms]
(pass) anonymizeFilePath > hashes path when no marker found [0.03ms]
(pass) anonymizeFilePath > hashes same path consistently [0.02ms]
(pass) anonymizeFilePath > handles empty path
(pass) anonymizeFilePath > preserves directory structure after marker [0.02ms]
(pass) anonymizeUserAgent > extracts Chrome version [0.07ms]
(pass) anonymizeUserAgent > extracts Firefox version [0.01ms]
(pass) anonymizeUserAgent > extracts Safari version
(pass) anonymizeUserAgent > extracts Edge version
(pass) anonymizeUserAgent > handles null user agent
(pass) anonymizeUserAgent > handles unrecognized user agent
(pass) anonymizeUserAgent > removes detailed OS and build information [0.02ms]
(pass) anonymizeTelemetryEvent > anonymizes all PII fields [0.08ms]
(pass) anonymizeTelemetryEvent > preserves non-PII fields [0.11ms]
(pass) anonymizeTelemetryEvent > recursively anonymizes nested metadata [0.07ms]
(pass) anonymizeTelemetryEvent > handles missing optional fields [0.02ms]
(pass) anonymizeTelemetryEvent > handles null and undefined metadata values [0.03ms]
(pass) anonymizeTelemetryEvent > handles arrays in metadata [0.03ms]
(pass) anonymizeTelemetryEvent > anonymizes multiple path fields in metadata [0.03ms]
(pass) Anonymization consistency > same input produces same anonymized output [0.05ms]
(pass) Anonymization consistency > different inputs produce different anonymized outputs [0.04ms]

packages/sidflow-web/tests/unit/sidplayfp-config.test.ts:
(pass) sidplayfp-config helpers > creates config when saving ROM paths [2.35ms]
(pass) sidplayfp-config helpers > removes ROM entry when cleared [1.31ms]

packages/sidflow-web/tests/unit/cache.test.ts:
(pass) LRUCache > should store and retrieve values [0.11ms]
(pass) LRUCache > should return undefined for non-existent keys [0.02ms]
(pass) LRUCache > should expire entries after TTL [61.09ms]
(pass) LRUCache > should evict oldest entry when at capacity [0.11ms]
(pass) LRUCache > should move accessed entries to end (LRU behavior) [0.04ms]
(pass) LRUCache > should check if key exists with has() [0.03ms]
(pass) LRUCache > should return false for expired keys with has() [61.08ms]
(pass) LRUCache > should clear all entries [0.13ms]
(pass) LRUCache > should report correct size [0.03ms]
(pass) LRUCache > should return cache statistics [0.03ms]
(pass) LRUCache > should handle complex object values [0.05ms]
(pass) LRUCache > should handle overwriting existing keys [0.02ms]
(pass) LRUCache > should update position when overwriting keys (LRU semantics) [0.03ms]
(pass) LRUCache > should handle edge case of maxSize=1 [0.02ms]
(pass) createCacheKey > should create key from strings [0.05ms]
(pass) createCacheKey > should create key from numbers [0.03ms]
(pass) createCacheKey > should create key from booleans [0.01ms]
(pass) createCacheKey > should create key from objects [0.02ms]
(pass) createCacheKey > should create key from mixed types [0.03ms]
(pass) createCacheKey > should handle empty array
(pass) createCacheKey > should handle single parameter
[cache] All caches cleared
(pass) clearAllCaches > should clear all exported caches [0.04ms]
(pass) getAllCacheStats > should return stats for all caches [0.04ms]

packages/sidflow-web/tests/unit/similarity-search.test.ts:
(pass) Similarity Search > Request structure > should have correct station-from-song request structure [0.04ms]
(pass) Similarity Search > Request structure > should have valid default parameters [0.01ms]
(pass) Similarity Search > Response structure > should have correct station response structure [0.05ms]
(pass) Similarity Search > Parameter validation > should calculate correct minSimilarity based on discovery [0.03ms]
(pass) Similarity Search > Parameter validation > should calculate correct boost factors based on similarity [0.03ms]
(pass) Similarity Search > Personalization logic > should boost tracks with positive feedback [0.03ms]
(pass) Similarity Search > Personalization logic > should penalize tracks with negative feedback [0.02ms]
(pass) Similarity Search > Personalization logic > should apply skip penalty [0.02ms]
(pass) Similarity Search > Personalization logic > should combine multiple feedback types [0.02ms]
(pass) Similarity Search > Vector similarity > should convert distance to similarity score [0.03ms]
(pass) Similarity Search > Filtering and sorting > should filter by minimum similarity threshold [0.04ms]
(pass) Similarity Search > Filtering and sorting > should sort by similarity score descending [0.03ms]
(pass) Similarity Search > Filtering and sorting > should limit results to requested count [0.06ms]

packages/sidflow-web/tests/unit/personal-ratings.test.ts:
(pass) Personal Ratings > setPersonalRating and getPersonalRating > should store and retrieve a personal rating [1.26ms]
(pass) Personal Ratings > setPersonalRating and getPersonalRating > should store rating with dimensions [0.04ms]
(pass) Personal Ratings > setPersonalRating and getPersonalRating > should return null for non-existent rating [0.01ms]
(pass) Personal Ratings > setPersonalRating and getPersonalRating > should overwrite existing rating [0.02ms]
(pass) Personal Ratings > setPersonalRating and getPersonalRating > should have valid timestamp format [0.03ms]
(pass) Personal Ratings > removePersonalRating > should remove a rating [0.03ms]
(pass) Personal Ratings > removePersonalRating > should not error when removing non-existent rating [0.02ms]
(pass) Personal Ratings > getAllRatedTracks > should return empty array when no ratings exist [0.04ms]
(pass) Personal Ratings > getAllRatedTracks > should return all rated tracks [0.06ms]
(pass) Personal Ratings > getAllRatedTracks > should include rating details for each track [0.03ms]
(pass) Personal Ratings > clearAllRatings > should remove all ratings [0.04ms]
(pass) Personal Ratings > clearAllRatings > should not error when clearing empty storage [0.01ms]
(pass) Personal Ratings > Rating validation > should accept valid rating values (1-5) [0.06ms]
[personal-ratings] Invalid rating value: 0. Must be a number between 1 and 5.
[personal-ratings] Invalid rating value: -1. Must be a number between 1 and 5.
(pass) Personal Ratings > Rating validation > should reject rating below 1 [0.04ms]
[personal-ratings] Invalid rating value: 6. Must be a number between 1 and 5.
[personal-ratings] Invalid rating value: 10. Must be a number between 1 and 5.
(pass) Personal Ratings > Rating validation > should reject rating above 5 [0.02ms]
[personal-ratings] Invalid rating value: NaN. Must be a number between 1 and 5.
[personal-ratings] Invalid rating value: Infinity. Must be a number between 1 and 5.
[personal-ratings] Invalid rating value: -Infinity. Must be a number between 1 and 5.
(pass) Personal Ratings > Rating validation > should reject non-finite numbers [0.02ms]
[personal-ratings] Invalid rating value: 3. Must be a number between 1 and 5.
[personal-ratings] Invalid rating value: null. Must be a number between 1 and 5.
[personal-ratings] Invalid rating value: undefined. Must be a number between 1 and 5.
(pass) Personal Ratings > Rating validation > should reject non-number types [0.05ms]
(pass) Personal Ratings > localStorage persistence > should persist ratings across instances [0.03ms]
(pass) Personal Ratings > localStorage persistence > should handle multiple tracks in localStorage [0.04ms]

packages/sidflow-web/tests/unit/preferences-schema.test.ts:
(pass) BrowserPreferences schema > parses default preferences [0.20ms]
(pass) BrowserPreferences schema > migrates empty object to defaults [0.18ms]
(pass) BrowserPreferences schema > migrates v0 legacy fields [0.03ms]
(pass) BrowserPreferences schema > migrates v1 payload and clamps invalid values [0.04ms]
(pass) BrowserPreferences schema > keeps rom bundle identifier when provided [0.48ms]
(pass) BrowserPreferences schema > maps legacy stream-mp3 engine to stream-m4a [0.02ms]

packages/sidflow-web/tests/unit/explain-recommendation.test.ts:
(pass) Live ML Explanations > euclidean distance calculation for identical vectors [0.05ms]
(pass) Live ML Explanations > euclidean distance calculation for different vectors [0.03ms]
(pass) Live ML Explanations > similarity from distance conversion [0.02ms]
(pass) Live ML Explanations > feature explanation format [0.03ms]

packages/sidflow-web/tests/unit/engine-order.test.ts:
(pass) resolveEngineOrder > should use forced engine first, then append wasm [0.11ms]
(pass) resolveEngineOrder > should respect preferred engines and append wasm [0.02ms]
(pass) resolveEngineOrder > should use config preferred when no request preferred [0.02ms]
(pass) resolveEngineOrder > should merge request preferred and config preferred without duplicates [0.01ms]
(pass) resolveEngineOrder > should prioritize forced engine over all preferences [0.01ms]
(pass) resolveEngineOrder > should handle auto mode as no forced engine [0.01ms]
(pass) resolveEngineOrder > should always append wasm even if already in preferences
(pass) resolveEngineOrder > should handle empty preferences gracefully [0.01ms]
(pass) resolveEngineOrder > should deduplicate engines across all sources [0.01ms]

packages/sidflow-web/tests/unit/health-api.test.ts:
[Health Check] Starting health check at 2025-12-13T23:47:24.380Z
[Health Check] Process CWD: /workspace
[Health Check] SIDFLOW_CONFIG: (not set)
[Health Check] SIDFLOW_ROOT: (not set)
[Health Check] NODE_ENV: test
[Health Check] Validating workspace paths and permissions...
[Health Check] Using config {
  configPath: "/workspace/.sidflow.json",
  configDir: "/workspace",
  sidPath: "workspace/hvsc",
  audioCachePath: "workspace/audio-cache",
  tagsPath: "workspace/tags",
}
[Health Check] Optional path not accessible (will create on-demand): HVSC at /workspace/workspace/hvsc (ENOENT: no such file or directory, access '/workspace/workspace/hvsc')
[Health Check] Optional path not accessible (will create on-demand): WAV cache at /workspace/workspace/audio-cache (ENOENT: no such file or directory, access '/workspace/workspace/audio-cache')
[Health Check] Optional path not accessible (will create on-demand): Renders data at /workspace/data/renders (ENOENT: no such file or directory, access '/workspace/data/renders')
[Health Check] Checking WASM at: /workspace/public/wasm/libsidplayfp.wasm
[Health Check] WASM file not found (will be generated on first use): ENOENT: no such file or directory, access '/workspace/public/wasm/libsidplayfp.wasm'
    path: "/workspace/public/wasm/libsidplayfp.wasm",
 syscall: "access",
   errno: -2,
    code: "ENOENT"


[Health Check] Loading config for sidplayfp CLI check...
[Health Check] sidplayPath from config: /usr/bin/sidplayfp
[Health Check] sidplayfp binary not executable: ENOENT: no such file or directory, access '/usr/bin/sidplayfp'
    path: "/usr/bin/sidplayfp",
 syscall: "access",
   errno: -2,
    code: "ENOENT"


[Health Check] Checking ffmpeg availability...
[Health Check] ffmpeg version: 6.1.1-3ubuntu5
[Health Check] Loading config for streaming assets check...
[Health Check] Config loaded, checking manifest...
[Health Check] Looking for manifest at: /workspace/data/sidflow.lance.manifest.json
[Health Check] Availability manifest not found: TypeError: undefined is not an object (evaluating 'manifest.assets.map')
      at normalizeManifest (/workspace/packages/sidflow-common/dist/availability-manifest.js:97:26)
      at async checkStreamingAssets (/workspace/packages/sidflow-web/app/api/health/route.ts:337:30)
      at async GET (/workspace/packages/sidflow-web/app/api/health/route.ts:64:28)
      at async <anonymous> (/workspace/packages/sidflow-web/tests/unit/health-api.test.ts:20:28)

[Health Check] Attempting to load config for Ultimate 64 check...
[Health Check] Config loaded successfully
[Health Check] Ultimate 64 configured, checking connectivity...
[Health Check] Overall status: unhealthy - HTTP 503
[Health Check] Check results: {
  "workspace": {
    "status": "healthy",
    "details": {
      "hvsc": "workspace/hvsc",
      "audioCache": "workspace/audio-cache",
      "tags": "workspace/tags",
      "available": [
        "Tags",
        "Classified data",
        "Availability data"
      ],
      "notes": [
        "HVSC will be created on-demand",
        "WAV cache will be created on-demand",
        "Renders data will be created on-demand"
      ]
    }
  },
  "ui": {
    "status": "unhealthy",
    "message": "UI routes not rendering",
    "details": {
      "failures": [
        "/ fetch failed: Unable to connect. Is the computer able to access the url?"
      ]
    }
  },
  "wasm": {
    "status": "degraded",
    "message": "WASM file not found (will be generated on first use)"
  },
  "sidplayfpCli": {
    "status": "degraded",
    "message": "sidplayfp binary not executable",
    "details": {
      "path": "/usr/bin/sidplayfp"
    }
  },
  "ffmpeg": {
    "status": "healthy",
    "details": {
      "version": "6.1.1-3ubuntu5"
    }
  },
  "streamingAssets": {
    "status": "degraded",
    "message": "Availability manifest not found (no assets rendered yet)"
  },
  "ultimate64": {
    "status": "degraded",
    "message": "Cannot connect to Ultimate 64 at c64u:80",
    "details": {
      "host": "c64u",
      "port": 80,
      "error": "Unable to connect. Is the computer able to access the url?"
    }
  }
}
(pass) Health Check API > returns health status with all checks [73.04ms]
[Health Check] Starting health check at 2025-12-13T23:47:24.453Z
[Health Check] Process CWD: /workspace
[Health Check] SIDFLOW_CONFIG: (not set)
[Health Check] SIDFLOW_ROOT: (not set)
[Health Check] NODE_ENV: test
[Health Check] Validating workspace paths and permissions...
[Health Check] Using config {
  configPath: "/workspace/.sidflow.json",
  configDir: "/workspace",
  sidPath: "workspace/hvsc",
  audioCachePath: "workspace/audio-cache",
  tagsPath: "workspace/tags",
}
[Health Check] Optional path not accessible (will create on-demand): HVSC at /workspace/workspace/hvsc (ENOENT: no such file or directory, access '/workspace/workspace/hvsc')
[Health Check] Optional path not accessible (will create on-demand): WAV cache at /workspace/workspace/audio-cache (ENOENT: no such file or directory, access '/workspace/workspace/audio-cache')
[Health Check] Optional path not accessible (will create on-demand): Renders data at /workspace/data/renders (ENOENT: no such file or directory, access '/workspace/data/renders')
[Health Check] Checking WASM at: /workspace/public/wasm/libsidplayfp.wasm
[Health Check] WASM file not found (will be generated on first use): ENOENT: no such file or directory, access '/workspace/public/wasm/libsidplayfp.wasm'
    path: "/workspace/public/wasm/libsidplayfp.wasm",
 syscall: "access",
   errno: -2,
    code: "ENOENT"


[Health Check] Loading config for sidplayfp CLI check...
[Health Check] sidplayPath from config: /usr/bin/sidplayfp
[Health Check] sidplayfp binary not executable: ENOENT: no such file or directory, access '/usr/bin/sidplayfp'
    path: "/usr/bin/sidplayfp",
 syscall: "access",
   errno: -2,
    code: "ENOENT"


[Health Check] Checking ffmpeg availability...
[Health Check] ffmpeg version: 6.1.1-3ubuntu5
[Health Check] Loading config for streaming assets check...
[Health Check] Config loaded, checking manifest...
[Health Check] Looking for manifest at: /workspace/data/sidflow.lance.manifest.json
[Health Check] Availability manifest not found: TypeError: undefined is not an object (evaluating 'manifest.assets.map')
      at normalizeManifest (/workspace/packages/sidflow-common/dist/availability-manifest.js:97:26)
      at async checkStreamingAssets (/workspace/packages/sidflow-web/app/api/health/route.ts:337:30)
      at async GET (/workspace/packages/sidflow-web/app/api/health/route.ts:64:28)
      at async <anonymous> (/workspace/packages/sidflow-web/tests/unit/health-api.test.ts:44:28)

[Health Check] Attempting to load config for Ultimate 64 check...
[Health Check] Config loaded successfully
[Health Check] Ultimate 64 configured, checking connectivity...
[Health Check] Overall status: unhealthy - HTTP 503
[Health Check] Check results: {
  "workspace": {
    "status": "healthy",
    "details": {
      "hvsc": "workspace/hvsc",
      "audioCache": "workspace/audio-cache",
      "tags": "workspace/tags",
      "available": [
        "Tags",
        "Classified data",
        "Availability data"
      ],
      "notes": [
        "HVSC will be created on-demand",
        "WAV cache will be created on-demand",
        "Renders data will be created on-demand"
      ]
    }
  },
  "ui": {
    "status": "unhealthy",
    "message": "UI routes not rendering",
    "details": {
      "failures": [
        "/ fetch failed: Unable to connect. Is the computer able to access the url?"
      ]
    }
  },
  "wasm": {
    "status": "degraded",
    "message": "WASM file not found (will be generated on first use)"
  },
  "sidplayfpCli": {
    "status": "degraded",
    "message": "sidplayfp binary not executable",
    "details": {
      "path": "/usr/bin/sidplayfp"
    }
  },
  "ffmpeg": {
    "status": "healthy",
    "details": {
      "version": "6.1.1-3ubuntu5"
    }
  },
  "streamingAssets": {
    "status": "degraded",
    "message": "Availability manifest not found (no assets rendered yet)"
  },
  "ultimate64": {
    "status": "degraded",
    "message": "Cannot connect to Ultimate 64 at c64u:80",
    "details": {
      "host": "c64u",
      "port": 80,
      "error": "Was there a typo in the url or port?"
    }
  }
}
(pass) Health Check API > returns proper status code based on overall health [42.89ms]
[Health Check] Starting health check at 2025-12-13T23:47:24.495Z
[Health Check] Process CWD: /workspace
[Health Check] SIDFLOW_CONFIG: (not set)
[Health Check] SIDFLOW_ROOT: (not set)
[Health Check] NODE_ENV: test
[Health Check] Validating workspace paths and permissions...
[Health Check] Using config {
  configPath: "/workspace/.sidflow.json",
  configDir: "/workspace",
  sidPath: "workspace/hvsc",
  audioCachePath: "workspace/audio-cache",
  tagsPath: "workspace/tags",
}
[Health Check] Optional path not accessible (will create on-demand): HVSC at /workspace/workspace/hvsc (ENOENT: no such file or directory, access '/workspace/workspace/hvsc')
[Health Check] Optional path not accessible (will create on-demand): WAV cache at /workspace/workspace/audio-cache (ENOENT: no such file or directory, access '/workspace/workspace/audio-cache')
[Health Check] Optional path not accessible (will create on-demand): Renders data at /workspace/data/renders (ENOENT: no such file or directory, access '/workspace/data/renders')
[Health Check] Checking WASM at: /workspace/public/wasm/libsidplayfp.wasm
[Health Check] WASM file not found (will be generated on first use): ENOENT: no such file or directory, access '/workspace/public/wasm/libsidplayfp.wasm'
    path: "/workspace/public/wasm/libsidplayfp.wasm",
 syscall: "access",
   errno: -2,
    code: "ENOENT"


[Health Check] Loading config for sidplayfp CLI check...
[Health Check] sidplayPath from config: /usr/bin/sidplayfp
[Health Check] sidplayfp binary not executable: ENOENT: no such file or directory, access '/usr/bin/sidplayfp'
    path: "/usr/bin/sidplayfp",
 syscall: "access",
   errno: -2,
    code: "ENOENT"


[Health Check] Checking ffmpeg availability...
[Health Check] ffmpeg version: 6.1.1-3ubuntu5
[Health Check] Loading config for streaming assets check...
[Health Check] Config loaded, checking manifest...
[Health Check] Looking for manifest at: /workspace/data/sidflow.lance.manifest.json
[Health Check] Availability manifest not found: TypeError: undefined is not an object (evaluating 'manifest.assets.map')
      at normalizeManifest (/workspace/packages/sidflow-common/dist/availability-manifest.js:97:26)
      at async checkStreamingAssets (/workspace/packages/sidflow-web/app/api/health/route.ts:337:30)
      at async GET (/workspace/packages/sidflow-web/app/api/health/route.ts:64:28)
      at async <anonymous> (/workspace/packages/sidflow-web/tests/unit/health-api.test.ts:55:28)

[Health Check] Attempting to load config for Ultimate 64 check...
[Health Check] Config loaded successfully
[Health Check] Ultimate 64 configured, checking connectivity...
[Health Check] Overall status: unhealthy - HTTP 503
[Health Check] Check results: {
  "workspace": {
    "status": "healthy",
    "details": {
      "hvsc": "workspace/hvsc",
      "audioCache": "workspace/audio-cache",
      "tags": "workspace/tags",
      "available": [
        "Tags",
        "Classified data",
        "Availability data"
      ],
      "notes": [
        "HVSC will be created on-demand",
        "WAV cache will be created on-demand",
        "Renders data will be created on-demand"
      ]
    }
  },
  "ui": {
    "status": "unhealthy",
    "message": "UI routes not rendering",
    "details": {
      "failures": [
        "/ fetch failed: Unable to connect. Is the computer able to access the url?"
      ]
    }
  },
  "wasm": {
    "status": "degraded",
    "message": "WASM file not found (will be generated on first use)"
  },
  "sidplayfpCli": {
    "status": "degraded",
    "message": "sidplayfp binary not executable",
    "details": {
      "path": "/usr/bin/sidplayfp"
    }
  },
  "ffmpeg": {
    "status": "healthy",
    "details": {
      "version": "6.1.1-3ubuntu5"
    }
  },
  "streamingAssets": {
    "status": "degraded",
    "message": "Availability manifest not found (no assets rendered yet)"
  },
  "ultimate64": {
    "status": "degraded",
    "message": "Cannot connect to Ultimate 64 at c64u:80",
    "details": {
      "host": "c64u",
      "port": 80,
      "error": "Unable to connect. Is the computer able to access the url?"
    }
  }
}
(pass) Health Check API > includes cache-control headers [52.74ms]
[Health Check] Starting health check at 2025-12-13T23:47:24.548Z
[Health Check] Process CWD: /workspace
[Health Check] SIDFLOW_CONFIG: (not set)
[Health Check] SIDFLOW_ROOT: (not set)
[Health Check] NODE_ENV: test
[Health Check] Validating workspace paths and permissions...
[Health Check] Using config {
  configPath: "/workspace/.sidflow.json",
  configDir: "/workspace",
  sidPath: "workspace/hvsc",
  audioCachePath: "workspace/audio-cache",
  tagsPath: "workspace/tags",
}
[Health Check] Optional path not accessible (will create on-demand): HVSC at /workspace/workspace/hvsc (ENOENT: no such file or directory, access '/workspace/workspace/hvsc')
[Health Check] Optional path not accessible (will create on-demand): WAV cache at /workspace/workspace/audio-cache (ENOENT: no such file or directory, access '/workspace/workspace/audio-cache')
[Health Check] Optional path not accessible (will create on-demand): Renders data at /workspace/data/renders (ENOENT: no such file or directory, access '/workspace/data/renders')
[Health Check] Checking WASM at: /workspace/public/wasm/libsidplayfp.wasm
[Health Check] WASM file not found (will be generated on first use): ENOENT: no such file or directory, access '/workspace/public/wasm/libsidplayfp.wasm'
    path: "/workspace/public/wasm/libsidplayfp.wasm",
 syscall: "access",
   errno: -2,
    code: "ENOENT"


[Health Check] Loading config for sidplayfp CLI check...
[Health Check] sidplayPath from config: /usr/bin/sidplayfp
[Health Check] sidplayfp binary not executable: ENOENT: no such file or directory, access '/usr/bin/sidplayfp'
    path: "/usr/bin/sidplayfp",
 syscall: "access",
   errno: -2,
    code: "ENOENT"


[Health Check] Checking ffmpeg availability...
[Health Check] ffmpeg version: 6.1.1-3ubuntu5
[Health Check] Loading config for streaming assets check...
[Health Check] Config loaded, checking manifest...
[Health Check] Looking for manifest at: /workspace/data/sidflow.lance.manifest.json
[Health Check] Availability manifest not found: TypeError: undefined is not an object (evaluating 'manifest.assets.map')
      at normalizeManifest (/workspace/packages/sidflow-common/dist/availability-manifest.js:97:26)
      at async checkStreamingAssets (/workspace/packages/sidflow-web/app/api/health/route.ts:337:30)
      at async GET (/workspace/packages/sidflow-web/app/api/health/route.ts:64:28)
      at async <anonymous> (/workspace/packages/sidflow-web/tests/unit/health-api.test.ts:63:28)

[Health Check] Attempting to load config for Ultimate 64 check...
[Health Check] Config loaded successfully
[Health Check] Ultimate 64 configured, checking connectivity...
[Health Check] Overall status: unhealthy - HTTP 503
[Health Check] Check results: {
  "workspace": {
    "status": "healthy",
    "details": {
      "hvsc": "workspace/hvsc",
      "audioCache": "workspace/audio-cache",
      "tags": "workspace/tags",
      "available": [
        "Tags",
        "Classified data",
        "Availability data"
      ],
      "notes": [
        "HVSC will be created on-demand",
        "WAV cache will be created on-demand",
        "Renders data will be created on-demand"
      ]
    }
  },
  "ui": {
    "status": "unhealthy",
    "message": "UI routes not rendering",
    "details": {
      "failures": [
        "/ fetch failed: Unable to connect. Is the computer able to access the url?"
      ]
    }
  },
  "wasm": {
    "status": "degraded",
    "message": "WASM file not found (will be generated on first use)"
  },
  "sidplayfpCli": {
    "status": "degraded",
    "message": "sidplayfp binary not executable",
    "details": {
      "path": "/usr/bin/sidplayfp"
    }
  },
  "ffmpeg": {
    "status": "healthy",
    "details": {
      "version": "6.1.1-3ubuntu5"
    }
  },
  "streamingAssets": {
    "status": "degraded",
    "message": "Availability manifest not found (no assets rendered yet)"
  },
  "ultimate64": {
    "status": "degraded",
    "message": "Cannot connect to Ultimate 64 at c64u:80",
    "details": {
      "host": "c64u",
      "port": 80,
      "error": "Was there a typo in the url or port?"
    }
  }
}
(pass) Health Check API > checks include status and optional message/details [34.62ms]
[Health Check] Starting health check at 2025-12-13T23:47:24.583Z
[Health Check] Process CWD: /workspace
[Health Check] SIDFLOW_CONFIG: (not set)
[Health Check] SIDFLOW_ROOT: (not set)
[Health Check] NODE_ENV: test
[Health Check] Validating workspace paths and permissions...
[Health Check] Using config {
  configPath: "/workspace/.sidflow.json",
  configDir: "/workspace",
  sidPath: "workspace/hvsc",
  audioCachePath: "workspace/audio-cache",
  tagsPath: "workspace/tags",
}
[Health Check] Optional path not accessible (will create on-demand): HVSC at /workspace/workspace/hvsc (ENOENT: no such file or directory, access '/workspace/workspace/hvsc')
[Health Check] Optional path not accessible (will create on-demand): WAV cache at /workspace/workspace/audio-cache (ENOENT: no such file or directory, access '/workspace/workspace/audio-cache')
[Health Check] Optional path not accessible (will create on-demand): Renders data at /workspace/data/renders (ENOENT: no such file or directory, access '/workspace/data/renders')
[Health Check] Checking WASM at: /workspace/public/wasm/libsidplayfp.wasm
[Health Check] WASM file not found (will be generated on first use): ENOENT: no such file or directory, access '/workspace/public/wasm/libsidplayfp.wasm'
    path: "/workspace/public/wasm/libsidplayfp.wasm",
 syscall: "access",
   errno: -2,
    code: "ENOENT"


[Health Check] Loading config for sidplayfp CLI check...
[Health Check] sidplayPath from config: /usr/bin/sidplayfp
[Health Check] sidplayfp binary not executable: ENOENT: no such file or directory, access '/usr/bin/sidplayfp'
    path: "/usr/bin/sidplayfp",
 syscall: "access",
   errno: -2,
    code: "ENOENT"


[Health Check] Checking ffmpeg availability...
[Health Check] ffmpeg version: 6.1.1-3ubuntu5
[Health Check] Loading config for streaming assets check...
[Health Check] Config loaded, checking manifest...
[Health Check] Looking for manifest at: /workspace/data/sidflow.lance.manifest.json
[Health Check] Availability manifest not found: TypeError: undefined is not an object (evaluating 'manifest.assets.map')
      at normalizeManifest (/workspace/packages/sidflow-common/dist/availability-manifest.js:97:26)
      at async checkStreamingAssets (/workspace/packages/sidflow-web/app/api/health/route.ts:337:30)
      at async GET (/workspace/packages/sidflow-web/app/api/health/route.ts:64:28)
      at async <anonymous> (/workspace/packages/sidflow-web/tests/unit/health-api.test.ts:78:28)

[Health Check] Attempting to load config for Ultimate 64 check...
[Health Check] Config loaded successfully
[Health Check] Ultimate 64 configured, checking connectivity...
[Health Check] Overall status: unhealthy - HTTP 503
[Health Check] Check results: {
  "workspace": {
    "status": "healthy",
    "details": {
      "hvsc": "workspace/hvsc",
      "audioCache": "workspace/audio-cache",
      "tags": "workspace/tags",
      "available": [
        "Tags",
        "Classified data",
        "Availability data"
      ],
      "notes": [
        "HVSC will be created on-demand",
        "WAV cache will be created on-demand",
        "Renders data will be created on-demand"
      ]
    }
  },
  "ui": {
    "status": "unhealthy",
    "message": "UI routes not rendering",
    "details": {
      "failures": [
        "/ fetch failed: Unable to connect. Is the computer able to access the url?"
      ]
    }
  },
  "wasm": {
    "status": "degraded",
    "message": "WASM file not found (will be generated on first use)"
  },
  "sidplayfpCli": {
    "status": "degraded",
    "message": "sidplayfp binary not executable",
    "details": {
      "path": "/usr/bin/sidplayfp"
    }
  },
  "ffmpeg": {
    "status": "healthy",
    "details": {
      "version": "6.1.1-3ubuntu5"
    }
  },
  "streamingAssets": {
    "status": "degraded",
    "message": "Availability manifest not found (no assets rendered yet)"
  },
  "ultimate64": {
    "status": "degraded",
    "message": "Cannot connect to Ultimate 64 at c64u:80",
    "details": {
      "host": "c64u",
      "port": 80,
      "error": "Unable to connect. Is the computer able to access the url?"
    }
  }
}
(pass) Health Check API > returns timestamp within reasonable range [53.46ms]
[Health Check] Starting health check at 2025-12-13T23:47:24.636Z
[Health Check] Process CWD: /workspace
[Health Check] SIDFLOW_CONFIG: (not set)
[Health Check] SIDFLOW_ROOT: (not set)
[Health Check] NODE_ENV: test
[Health Check] Validating workspace paths and permissions...
[Health Check] Using config {
  configPath: "/workspace/.sidflow.json",
  configDir: "/workspace",
  sidPath: "workspace/hvsc",
  audioCachePath: "workspace/audio-cache",
  tagsPath: "workspace/tags",
}
[Health Check] Optional path not accessible (will create on-demand): HVSC at /workspace/workspace/hvsc (ENOENT: no such file or directory, access '/workspace/workspace/hvsc')
[Health Check] Optional path not accessible (will create on-demand): WAV cache at /workspace/workspace/audio-cache (ENOENT: no such file or directory, access '/workspace/workspace/audio-cache')
[Health Check] Optional path not accessible (will create on-demand): Renders data at /workspace/data/renders (ENOENT: no such file or directory, access '/workspace/data/renders')
[Health Check] Checking WASM at: /workspace/public/wasm/libsidplayfp.wasm
[Health Check] WASM file not found (will be generated on first use): ENOENT: no such file or directory, access '/workspace/public/wasm/libsidplayfp.wasm'
    path: "/workspace/public/wasm/libsidplayfp.wasm",
 syscall: "access",
   errno: -2,
    code: "ENOENT"


[Health Check] Loading config for sidplayfp CLI check...
[Health Check] sidplayPath from config: /usr/bin/sidplayfp
[Health Check] sidplayfp binary not executable: ENOENT: no such file or directory, access '/usr/bin/sidplayfp'
    path: "/usr/bin/sidplayfp",
 syscall: "access",
   errno: -2,
    code: "ENOENT"


[Health Check] Checking ffmpeg availability...
[Health Check] ffmpeg version: 6.1.1-3ubuntu5
[Health Check] Loading config for streaming assets check...
[Health Check] Config loaded, checking manifest...
[Health Check] Looking for manifest at: /workspace/data/sidflow.lance.manifest.json
[Health Check] Availability manifest not found: TypeError: undefined is not an object (evaluating 'manifest.assets.map')
      at normalizeManifest (/workspace/packages/sidflow-common/dist/availability-manifest.js:97:26)
      at async checkStreamingAssets (/workspace/packages/sidflow-web/app/api/health/route.ts:337:30)
      at async GET (/workspace/packages/sidflow-web/app/api/health/route.ts:64:28)
      at async <anonymous> (/workspace/packages/sidflow-web/tests/unit/health-api.test.ts:87:28)

[Health Check] Attempting to load config for Ultimate 64 check...
[Health Check] Config loaded successfully
[Health Check] Ultimate 64 configured, checking connectivity...
[Health Check] Overall status: unhealthy - HTTP 503
[Health Check] Check results: {
  "workspace": {
    "status": "healthy",
    "details": {
      "hvsc": "workspace/hvsc",
      "audioCache": "workspace/audio-cache",
      "tags": "workspace/tags",
      "available": [
        "Tags",
        "Classified data",
        "Availability data"
      ],
      "notes": [
        "HVSC will be created on-demand",
        "WAV cache will be created on-demand",
        "Renders data will be created on-demand"
      ]
    }
  },
  "ui": {
    "status": "unhealthy",
    "message": "UI routes not rendering",
    "details": {
      "failures": [
        "/ fetch failed: Unable to connect. Is the computer able to access the url?"
      ]
    }
  },
  "wasm": {
    "status": "degraded",
    "message": "WASM file not found (will be generated on first use)"
  },
  "sidplayfpCli": {
    "status": "degraded",
    "message": "sidplayfp binary not executable",
    "details": {
      "path": "/usr/bin/sidplayfp"
    }
  },
  "ffmpeg": {
    "status": "healthy",
    "details": {
      "version": "6.1.1-3ubuntu5"
    }
  },
  "streamingAssets": {
    "status": "degraded",
    "message": "Availability manifest not found (no assets rendered yet)"
  },
  "ultimate64": {
    "status": "degraded",
    "message": "Cannot connect to Ultimate 64 at c64u:80",
    "details": {
      "host": "c64u",
      "port": 80,
      "error": "Was there a typo in the url or port?"
    }
  }
}
(pass) Health Check API > does not affect overall health when optional checks (ultimate64, streamingAssets) are degraded [35.64ms]

packages/sidflow-web/tests/unit/collaborative-filter.test.ts:
(pass) Collaborative Discovery > feedback filtering logic for positive signals [0.07ms]
(pass) Collaborative Discovery > like boost calculation [0.03ms]
(pass) Collaborative Discovery > dislike penalty calculation [0.02ms]

packages/sidflow-web/tests/unit/api-client.test.ts:
(pass) api-client POST helpers > playTrack posts JSON payload to /api/play [0.34ms]
(pass) api-client POST helpers > playManualTrack posts JSON payload to /api/play/manual [0.06ms]
(pass) api-client POST helpers > rateTrack posts JSON payload to /api/rate [0.04ms]
(pass) api-client POST helpers > classifyPath posts JSON payload to /api/classify [0.06ms]
(pass) api-client POST helpers > updatePreferences posts JSON payload to /api/prefs [0.05ms]
(pass) api-client POST helpers > fetchHvsc posts JSON payload to /api/fetch [0.04ms]
(pass) api-client POST helpers > trainModel posts JSON payload to /api/train [0.03ms]
(pass) api-client POST helpers > controlRatePlayback posts JSON payload to /api/rate/control [0.03ms]
(pass) api-client POST helpers > controlClassification posts JSON payload to /api/classify/control [0.04ms]
(pass) api-client fetch wrappers > getPreferences performs a GET request [0.11ms]
(pass) api-client fetch wrappers > listHvscFolders includes a relative query parameter when provided [0.13ms]
(pass) api-client fetch wrappers > listHvscFolders defaults to an empty query string [0.05ms]
(pass) api-client fetch wrappers > fetchHvscProgress requests current fetch status [0.08ms]
(pass) api-client fetch wrappers > getSidCollectionPaths retrieves configured SID collection paths [0.08ms]
(pass) api-client fetch wrappers > getClassifyProgress fetches classify progress snapshots [0.07ms]
(pass) api-client fetch wrappers > getRatePlaybackStatus retrieves pause/playback state [0.08ms]
(pass) api-client fetch wrappers > requestRandomPlayTrack posts optional preset and preview flags [0.14ms]
(pass) api-client fetch wrappers > requestRandomPlayTrack omits optional fields when not provided [0.06ms]
(pass) api-client fetch wrappers > requestRandomRateTrack posts an empty body [0.08ms]
(pass) api-client fetch wrappers > getRatingHistory serializes query parameters when provided [0.13ms]

packages/sidflow-web/tests/unit/playback-facade.test.ts:
(pass) PlaybackFacade > registers adapters and sets preferred adapter automatically [0.25ms]
(pass) PlaybackFacade > chooses preferred adapter when available [0.53ms]
(pass) PlaybackFacade > falls back to next adapter when preferred is unavailable [0.14ms]
(pass) PlaybackFacade > throws when no adapters are available [0.12ms]
(pass) PlaybackFacade > tears down active controller when changing preferred adapter [0.10ms]

packages/sidflow-web/tests/unit/telemetry-helpers.test.ts:
(pass) Telemetry Helpers > should validate telemetry event structure [0.05ms]
(pass) Telemetry Helpers > should validate timestamp formats [0.04ms]
(pass) Telemetry Helpers > should validate event types [0.04ms]
(pass) Telemetry Helpers > should handle telemetry event data structures [0.02ms]
(pass) Telemetry Helpers > should handle telemetry batching logic [0.06ms]

packages/sidflow-web/tests/unit/validation.test.ts:
(pass) PlayRequestSchema > validates valid play request [1.42ms]
(pass) PlayRequestSchema > validates play request without preset [0.05ms]
(pass) PlayRequestSchema > rejects empty sid_path [0.19ms]
(pass) PlayRequestSchema > rejects invalid preset [0.26ms]
(pass) PlayRequestSchema > accepts all valid presets [0.08ms]
(pass) RateRequestSchema > validates valid rate request [0.07ms]
(pass) RateRequestSchema > rejects ratings outside 1-5 range [0.05ms]
(pass) RateRequestSchema > rejects ratings above 5 [0.06ms]
(pass) RateRequestSchema > rejects non-integer ratings [0.05ms]
(pass) RateRequestSchema > rejects missing rating dimensions [0.05ms]
(pass) ClassifyRequestSchema > validates valid classify request [0.05ms]
(pass) ClassifyRequestSchema > rejects empty path [0.04ms]
(pass) ClassifyRequestSchema > allows missing path for auto-detection [0.02ms]
(pass) FetchRequestSchema > validates empty fetch request [0.02ms]
(pass) FetchRequestSchema > validates fetch request with all options [0.12ms]
(pass) FetchRequestSchema > rejects invalid URL [0.39ms]
(pass) FetchRequestSchema > validates partial fetch request [0.06ms]
(pass) TrainRequestSchema > validates empty train request [0.03ms]
(pass) TrainRequestSchema > validates train request with all options [0.06ms]
(pass) TrainRequestSchema > rejects negative epochs [0.04ms]
(pass) TrainRequestSchema > rejects zero batch size [0.04ms]
(pass) TrainRequestSchema > rejects negative learning rate [0.02ms]
(pass) TrainRequestSchema > rejects non-integer epochs [0.02ms]
(pass) TrainRequestSchema > validates partial train request [0.04ms]

packages/sidflow-web/tests/unit/cache-validation.test.ts:
(pass) Cache Validation > should validate cache key formats [0.06ms]
(pass) Cache Validation > should validate cache TTL values [0.02ms]
(pass) Cache Validation > should handle cache expiration logic [0.02ms]
(pass) Cache Validation > should validate cache entry structure [0.03ms]
(pass) Cache Validation > should check if cache entry is expired [0.02ms]

packages/sidflow-web/tests/unit/adaptive-station.test.ts:
(pass) Adaptive Station > calculateAdaptiveSimilarity increases with skips [0.09ms]
(pass) Adaptive Station > calculateAdaptiveSimilarity decreases with many likes [0.05ms]
(pass) Adaptive Station > calculateAdaptiveDiscovery increases with engagement [0.05ms]
(pass) Adaptive Station > calculateAdaptiveDiscovery decreases with skips [0.03ms]
(pass) Adaptive Station > adaptation clamping prevents extreme values [0.03ms]

packages/sidflow-web/tests/unit/play-tab-helpers.test.ts:
(pass) PlayTab helpers > formats seconds into mm:ss [1.16ms]
(pass) PlayTab helpers > parses mixed length strings safely [0.13ms]
(pass) PlayTab helpers > deduplicates playlist entries by sidPath while preserving first occurrences [0.16ms]

packages/sidflow-web/tests/unit/telemetry-api.test.ts:
(pass) Telemetry API > POST /api/telemetry > accepts valid telemetry event [1.23ms]
(pass) Telemetry API > POST /api/telemetry > accepts event with metadata [0.19ms]
(pass) Telemetry API > POST /api/telemetry > accepts empty body without failing [0.09ms]
(pass) Telemetry API > POST /api/telemetry > handles invalid JSON gracefully [0.10ms]
(pass) Telemetry API > POST /api/telemetry > handles malformed request gracefully [0.05ms]
(pass) Telemetry API > POST /api/telemetry > anonymizes session ID in received event [0.08ms]
(pass) Telemetry API > POST /api/telemetry > anonymizes file paths in received event [0.08ms]
(pass) Telemetry API > POST /api/telemetry > extracts and anonymizes user agent [0.08ms]
(pass) Telemetry API > POST /api/telemetry > handles batch of events (sent separately) [0.18ms]
(pass) Telemetry API > POST /api/telemetry > processes events with nested PII in metadata [0.19ms]
(pass) Telemetry API > POST /api/telemetry > never returns error status to client [0.39ms]
(pass) Telemetry API > GET /api/telemetry > returns 200 for health check [0.14ms]
(pass) Telemetry API > Telemetry fire-and-forget behavior > completes quickly regardless of payload size [0.65ms]
(pass) Telemetry API > Telemetry fire-and-forget behavior > does not throw on concurrent requests [0.38ms]

packages/sidflow-web/tests/unit/songlengths.test.ts:
(pass) loadSonglengthsData > should load valid Songlengths.md5 from DOCUMENTS folder [0.57ms]
(pass) loadSonglengthsData > should try C64Music/DOCUMENTS path [0.51ms]
(pass) loadSonglengthsData > should try update/DOCUMENTS path [0.46ms]
(pass) loadSonglengthsData > should return empty data when no file found [0.55ms]
(pass) loadSonglengthsData > should cache loaded data [0.34ms]
(pass) loadSonglengthsData > should skip empty lines and comments [0.37ms]
(pass) loadSonglengthsData > should handle paths with leading slash [0.31ms]
(pass) loadSonglengthsData > should only process .sid files in comments [0.42ms]
(pass) loadSonglengthsData > should normalize MD5 hashes to lowercase [0.45ms]
(pass) lookupSongLength > should return cached value on second lookup [0.47ms]
(pass) lookupSongLength > should return undefined when map is empty [0.35ms]
[songlengths] Failed to compute MD5 for /nonexistent/file.sid ENOENT: no such file or directory, open '/nonexistent/file.sid'
    path: "/nonexistent/file.sid",
 syscall: "open",
   errno: -2,
    code: "ENOENT"


(pass) lookupSongLength > should handle missing file gracefully [1.07ms]
(pass) clearSonglengthCaches > should clear all caches [0.54ms]

packages/sidflow-web/tests/unit/sidflow-player-support.test.ts:
(pass) detectWorkletSupport > returns supported when required features exist [0.15ms]
(pass) detectWorkletSupport > flags missing SharedArrayBuffer [0.03ms]
(pass) detectWorkletSupport > flags missing cross-origin isolation [0.02ms]
(pass) detectWorkletSupport > flags missing audio worklet support [0.02ms]

packages/sidflow-web/tests/unit/offline-storage.test.ts:
(pass) playback cache > stores and lists cached tracks in most-recent order [1.78ms]
(pass) playback cache > prunes cached tracks beyond max entries [0.98ms]
[PlaybackQueue] Pending count computed {"total":2,"pending":[{"id":1,"kind":"rebuild-playlist","status":"pending","attempts":0,"lastError":null},{"id":2,"kind":"play-next","status":"pending","attempts":0,"lastError":null}]}
(pass) playback queue > deduplicates rebuild requests and tracks counts [1.29ms]
[PlaybackQueue] Flushing queued actions [
  {
    kind: "rebuild-playlist",
    payload: {
      preset: "dark",
      kind: "rebuild-playlist",
    },
    status: "pending",
    enqueuedAt: 1765669644820,
    attempts: 0,
    lastError: undefined,
    lastAttemptAt: undefined,
    id: 1,
  }, {
    kind: "play-next",
    payload: {
      kind: "play-next",
    },
    status: "pending",
    enqueuedAt: 1765669644821,
    attempts: 0,
    lastError: undefined,
    lastAttemptAt: undefined,
    id: 2,
  }, {
    kind: "play-next",
    payload: {
      kind: "play-next",
    },
    status: "pending",
    enqueuedAt: 1765669644821,
    attempts: 0,
    lastError: undefined,
    lastAttemptAt: undefined,
    id: 3,
  }
]
[PlaybackQueue] Removing processed action {
  kind: "rebuild-playlist",
  payload: {
    preset: "dark",
    kind: "rebuild-playlist",
  },
  status: "pending",
  enqueuedAt: 1765669644820,
  attempts: 0,
  lastError: undefined,
  lastAttemptAt: undefined,
  id: 1,
}
[PlaybackQueue] Action failed during flush {
  record: {
    kind: "play-next",
    payload: {
      kind: "play-next",
    },
    status: "failed",
    enqueuedAt: 1765669644821,
    attempts: 1,
    lastError: "still offline",
    lastAttemptAt: 1765669644822,
    id: 2,
  },
  error: "still offline",
}
[PlaybackQueue] Action failed during flush {
  record: {
    kind: "play-next",
    payload: {
      kind: "play-next",
    },
    status: "failed",
    enqueuedAt: 1765669644821,
    attempts: 1,
    lastError: "still offline",
    lastAttemptAt: 1765669644822,
    id: 3,
  },
  error: "still offline",
}
[PlaybackQueue] Flushing queued actions [
  {
    kind: "play-next",
    payload: {
      kind: "play-next",
    },
    status: "failed",
    enqueuedAt: 1765669644821,
    attempts: 1,
    lastError: "still offline",
    lastAttemptAt: 1765669644822,
    id: 2,
  }, {
    kind: "play-next",
    payload: {
      kind: "play-next",
    },
    status: "failed",
    enqueuedAt: 1765669644821,
    attempts: 1,
    lastError: "still offline",
    lastAttemptAt: 1765669644822,
    id: 3,
  }
]
[PlaybackQueue] Removing processed action {
  kind: "play-next",
  payload: {
    kind: "play-next",
  },
  status: "pending",
  enqueuedAt: 1765669644821,
  attempts: 1,
  lastError: "still offline",
  lastAttemptAt: 1765669644822,
  id: 2,
}
[PlaybackQueue] Removing processed action {
  kind: "play-next",
  payload: {
    kind: "play-next",
  },
  status: "pending",
  enqueuedAt: 1765669644821,
  attempts: 1,
  lastError: "still offline",
  lastAttemptAt: 1765669644822,
  id: 3,
}
(pass) playback queue > flushes queue entries and keeps failures for retry [1.56ms]

packages/sidflow-web/tests/unit/sab-ring-buffer.test.ts:
(pass) SAB Ring Buffer > creates buffer with correct alignment [0.18ms]
(pass) SAB Ring Buffer > producer and consumer can write and read [0.45ms]
(pass) SAB Ring Buffer > handles wrap-around correctly [0.25ms]
(pass) SAB Ring Buffer > enforces block alignment [0.13ms]
(pass) SAB Ring Buffer > handles backpressure when full [0.03ms]
(pass) SAB Ring Buffer > handles underrun when empty [0.03ms]
(pass) SAB Ring Buffer > concurrent operations maintain consistency [0.09ms]
(pass) SAB Ring Buffer > mono channel support [0.09ms]

packages/sidflow-web/tests/unit/player-pause-resume.test.ts:
(pass) Pause/resume position preservation > fix is implemented: getPositionSeconds returns pausedPosition when not playing [0.02ms]
(pass) Pause/resume position preservation > fix is implemented: pausedPosition is saved during pause()
(pass) Pause/resume position preservation > fix is implemented: startTime accounts for pausedPosition during play()
(pass) Pause/resume position preservation > fix is implemented: legacy player updates in correct order

packages/sidflow-web/tests/unit/rating-aggregator.test.ts:
(pass) Rating Aggregator > Rating calculation > should calculate average rating from feedback [0.06ms]
(pass) Rating Aggregator > Rating calculation > should return default rating when no feedback [0.02ms]
(pass) Rating Aggregator > Rating calculation > should weight likes higher than skips and dislikes [0.03ms]
(pass) Rating Aggregator > Trending calculation > should calculate trending score based on recent plays [0.02ms]
(pass) Rating Aggregator > Trending calculation > should mark as trending when score > 0.7 [0.02ms]
(pass) Rating Aggregator > Trending calculation > should not be trending with low recent activity [0.02ms]
(pass) Rating Aggregator > Trending calculation > should cap trending score at 1.0 [0.02ms]
(pass) Rating Aggregator > Trending calculation > should penalize negative feedback in trending score [0.02ms]
(pass) Rating Aggregator > Aggregate response structure > should have correct aggregate rating structure [0.04ms]
(pass) Rating Aggregator > Aggregate response structure > should handle track with no ratings [0.02ms]
(pass) Rating Aggregator > Aggregate response structure > should include personal rating when available [0.03ms]
(pass) Rating Aggregator > Star rating display > should display correct number of filled stars [0.05ms]
(pass) Rating Aggregator > Dimension estimates > should return neutral values for dimensions when not available [0.02ms]
(pass) Rating Aggregator > Dimension estimates > should have valid dimension ranges [0.02ms]
(pass) Rating Aggregator > Caching behavior > should have cache TTL of 5 minutes
(pass) Rating Aggregator > Caching behavior > should cache aggregates to avoid re-reading files [0.02ms]
(pass) Rating Aggregator > Caching behavior > should invalidate cache after TTL expires [0.01ms]
(pass) Rating Aggregator > Caching behavior > should keep cache valid within TTL [0.01ms]

packages/sidflow-web/tests/unit/api-routes.test.ts:
(pass) Play API Route > should have correct request structure [0.04ms]
(pass) Rate API Route > should validate rating request schema [0.05ms]
(pass) Classify API Route > should validate classify request schema [0.02ms]
(pass) Fetch API Route > should validate fetch request schema [0.02ms]
(pass) Train API Route > should validate train request schema [0.02ms]

packages/sidflow-web/tests/unit/favorites-api.test.ts:
(pass) Favorites API > GET /api/favorites > should return empty favorites array initially [1.17ms]
(pass) Favorites API > GET /api/favorites > should return existing favorites [0.60ms]
(pass) Favorites API > POST /api/favorites > should add a new favorite [1.72ms]
(pass) Favorites API > POST /api/favorites > should not add duplicate favorites [0.61ms]
(pass) Favorites API > POST /api/favorites > should return error for invalid request (missing sid_path) [0.15ms]
(pass) Favorites API > POST /api/favorites > should return error for invalid sid_path type [0.14ms]
(pass) Favorites API > POST /api/favorites > should handle multiple favorites [0.66ms]
(pass) Favorites API > DELETE /api/favorites > should remove an existing favorite [0.68ms]
(pass) Favorites API > DELETE /api/favorites > should handle removing non-existent favorite [0.35ms]
(pass) Favorites API > DELETE /api/favorites > should return error for invalid request (missing sid_path) [0.13ms]
(pass) Favorites API > DELETE /api/favorites > should clear all favorites when removing last one [0.51ms]

packages/sidflow-web/tests/unit/server-env.test.ts:
(pass) server-env config resolution > resolves default config relative to repo root when env var unset [0.10ms]
(pass) server-env config resolution > uses absolute SIDFLOW_CONFIG path without joining repo root [0.03ms]
(pass) server-env config resolution > trims whitespace from SIDFLOW_CONFIG before resolving [0.03ms]
(pass) server-env config resolution > resolves relative SIDFLOW_CONFIG paths under repo root [0.02ms]
(pass) server-env config resolution > loads config from an explicit path argument [0.55ms]

packages/sidflow-web/tests/unit/middleware.test.ts:
(pass) proxy security headers > applies COOP/COEP for HTML responses [0.73ms]
(pass) proxy security headers > applies resource policy for WASM assets [0.21ms]
(pass) proxy security headers > does not add isolation headers for non-HTML without extensions [0.14ms]

packages/sidflow-web/tests/unit/volume-control.test.ts:
[SidflowPlayer] AudioWorklet pipeline disabled; falling back to legacy playback {
  reasons: [ "cross-origin-isolation-disabled", "missing-audio-context" ],
}
(pass) Volume Control - Real Player Integration > SidflowPlayer volume methods > initializes with default volume of 1.0 [0.59ms]
[SidflowPlayer] AudioWorklet pipeline disabled; falling back to legacy playback {
  reasons: [ "cross-origin-isolation-disabled", "missing-audio-context" ],
}
(pass) Volume Control - Real Player Integration > SidflowPlayer volume methods > setVolume updates volume and getVolume returns it [0.12ms]
[SidflowPlayer] AudioWorklet pipeline disabled; falling back to legacy playback {
  reasons: [ "cross-origin-isolation-disabled", "missing-audio-context" ],
}
(pass) Volume Control - Real Player Integration > SidflowPlayer volume methods > setVolume clamps values below 0 to 0 [0.04ms]
[SidflowPlayer] AudioWorklet pipeline disabled; falling back to legacy playback {
  reasons: [ "cross-origin-isolation-disabled", "missing-audio-context" ],
}
(pass) Volume Control - Real Player Integration > SidflowPlayer volume methods > setVolume clamps values above 1 to 1 [0.03ms]
[SidflowPlayer] AudioWorklet pipeline disabled; falling back to legacy playback {
  reasons: [ "cross-origin-isolation-disabled", "missing-audio-context" ],
}
(pass) Volume Control - Real Player Integration > SidflowPlayer volume methods > setVolume accepts values in valid range [0.05ms]
[SidflowPlayer] AudioWorklet pipeline disabled; falling back to legacy playback {
  reasons: [ "cross-origin-isolation-disabled", "missing-audio-context" ],
}
(pass) Volume Control - Real Player Integration > SidflowPlayer volume methods > volume can be set to 0 (muted) [0.04ms]
[SidflowPlayer] AudioWorklet pipeline disabled; falling back to legacy playback {
  reasons: [ "cross-origin-isolation-disabled", "missing-audio-context" ],
}
(pass) Volume Control - Real Player Integration > SidflowPlayer volume methods > volume changes are granular with 0.01 precision [0.04ms]
[SidflowPlayer] AudioWorklet pipeline disabled; falling back to legacy playback {
  reasons: [ "cross-origin-isolation-disabled", "missing-audio-context" ],
}
(pass) Volume Control - Real Player Integration > SidflowPlayer volume methods > crossfade duration defaults to 0 [0.03ms]
[SidflowPlayer] AudioWorklet pipeline disabled; falling back to legacy playback {
  reasons: [ "cross-origin-isolation-disabled", "missing-audio-context" ],
}
(pass) Volume Control - Real Player Integration > SidflowPlayer volume methods > setCrossfadeDuration accepts positive values [0.04ms]
[SidflowPlayer] AudioWorklet pipeline disabled; falling back to legacy playback {
  reasons: [ "cross-origin-isolation-disabled", "missing-audio-context" ],
}
(pass) Volume Control - Real Player Integration > SidflowPlayer volume methods > setCrossfadeDuration clamps negative values to 0 [0.02ms]
(pass) Volume Control - Real Player Integration > WorkletPlayer volume methods > initializes with default volume of 1.0 [0.35ms]
(pass) Volume Control - Real Player Integration > WorkletPlayer volume methods > setVolume updates volume and getVolume returns it [0.06ms]
(pass) Volume Control - Real Player Integration > WorkletPlayer volume methods > setVolume clamps values correctly [0.03ms]
(pass) Volume Control - Real Player Integration > HlsPlayer volume methods > initializes with default volume of 1.0 [0.44ms]
(pass) Volume Control - Real Player Integration > HlsPlayer volume methods > setVolume updates volume and getVolume returns it [0.06ms]
(pass) Volume Control - Real Player Integration > HlsPlayer volume methods > setVolume clamps values correctly [0.03ms]
(pass) Volume Control - Real Player Integration > HlsPlayer volume methods > handles volume operations when audio element exists [0.03ms]
(pass) Volume Control - Real Player Integration > Volume UI behavior > volume slider range is 0 to 1 [0.02ms]
(pass) Volume Control - Real Player Integration > Volume UI behavior > volume percentage calculation [0.03ms]
(pass) Volume Control - Real Player Integration > Volume UI behavior > volume icon changes based on volume level [0.05ms]
(pass) Volume Control - Real Player Integration > Volume UI behavior > volume control has minimum width for usability [0.01ms]
(pass) Volume Control - Real Player Integration > Volume control helpers > clamp function behavior [0.03ms]
(pass) Volume Control - Real Player Integration > Volume control helpers > handles floating-point precision in volume calculations [0.01ms]
(pass) Volume Control - Real Player Integration > Volume control helpers > boundary value clamping [0.03ms]

packages/sidflow-web/tests/unit/playlist-storage.test.ts:
(pass) Playlist Storage > listPlaylists > returns empty array when no playlists exist [0.55ms]
(pass) Playlist Storage > listPlaylists > lists all playlists sorted by updatedAt descending [12.89ms]
(pass) Playlist Storage > createPlaylist > creates a playlist with required fields [0.26ms]
(pass) Playlist Storage > createPlaylist > creates a playlist with description [0.25ms]
(pass) Playlist Storage > createPlaylist > calculates total duration when track lengths provided [0.31ms]
(pass) Playlist Storage > getPlaylist > retrieves an existing playlist by ID [0.58ms]
(pass) Playlist Storage > getPlaylist > returns null for non-existent playlist [0.58ms]
(pass) Playlist Storage > updatePlaylist > updates playlist name [3.21ms]
(pass) Playlist Storage > updatePlaylist > updates playlist tracks [1.44ms]
(pass) Playlist Storage > updatePlaylist > returns null for non-existent playlist [0.19ms]
(pass) Playlist Storage > deletePlaylist > deletes an existing playlist [0.78ms]
(pass) Playlist Storage > deletePlaylist > returns false for non-existent playlist [0.15ms]
(pass) Playlist Storage > reorderPlaylistTracks > reorders tracks based on sidPath array [1.79ms]
(pass) Playlist Storage > reorderPlaylistTracks > returns null for non-existent playlist [0.14ms]

packages/sidflow-web/tests/unit/feedback-storage.test.ts:
(pass) feedback IndexedDB storage > stores and retrieves rating events by status [15.48ms]
(pass) feedback IndexedDB storage > updates rating event status and increments attempts [1.00ms]
(pass) feedback IndexedDB storage > lists rating events for training ordered by recency [0.87ms]
(pass) feedback IndexedDB storage > counts rating events grouped by status [0.98ms]
(pass) feedback IndexedDB storage > stores and updates implicit feedback events [1.12ms]
(pass) feedback IndexedDB storage > stores and reads latest model snapshot [0.66ms]

packages/sidflow-web/tests/unit/security-headers.test.ts:
(pass) Security headers > Content Security Policy > sets CSP header on all responses [0.22ms]
(pass) Security headers > Content Security Policy > CSP allows same-origin scripts [0.18ms]
(pass) Security headers > Content Security Policy > CSP allows unsafe-eval for WASM [0.19ms]
(pass) Security headers > Content Security Policy > CSP allows inline styles for Tailwind [0.19ms]
(pass) Security headers > Content Security Policy > CSP allows inline scripts by default for Next.js streaming [0.13ms]
(pass) Security headers > Content Security Policy > CSP allows blob URLs for media and workers [0.07ms]
(pass) Security headers > Content Security Policy > CSP prevents clickjacking with frame-ancestors [0.05ms]
(pass) Security headers > Content Security Policy > CSP restricts base and form actions [0.05ms]
(pass) Security headers > Content Security Policy > CSP connect-src allows data URLs for SID fixtures (default mode) [0.09ms]
(pass) Security headers > Content Security Policy > CSP connect-src allows WebSockets when SIDFLOW_RELAXED_CSP=1 [0.19ms]
(pass) Security headers > Content Security Policy > CSP strict mode disables inline scripts [0.15ms]
(pass) Security headers > X-Frame-Options > sets X-Frame-Options to DENY [0.07ms]
(pass) Security headers > X-Frame-Options > applies to API routes [0.08ms]
(pass) Security headers > X-Frame-Options > applies to static assets [0.06ms]
(pass) Security headers > X-Content-Type-Options > sets X-Content-Type-Options to nosniff [0.05ms]
(pass) Security headers > X-Content-Type-Options > prevents MIME type sniffing on scripts [0.05ms]
(pass) Security headers > X-Content-Type-Options > applies to all content types [0.19ms]
(pass) Security headers > Referrer-Policy > sets Referrer-Policy to strict-origin-when-cross-origin [0.08ms]
(pass) Security headers > Referrer-Policy > applies to all routes [0.05ms]
(pass) Security headers > Permissions-Policy > sets Permissions-Policy header [0.06ms]
(pass) Security headers > Permissions-Policy > disables camera access [0.05ms]
(pass) Security headers > Permissions-Policy > disables microphone access [0.04ms]
(pass) Security headers > Permissions-Policy > disables geolocation access [0.04ms]
(pass) Security headers > Permissions-Policy > disables payment and USB access [0.04ms]
(pass) Security headers > Strict-Transport-Security > HSTS header format is correct when present [0.07ms]
(pass) Security headers > Strict-Transport-Security > HSTS includes one-year max-age [0.04ms]
(pass) Security headers > Cross-Origin headers for SharedArrayBuffer > sets COOP for HTML documents [0.13ms]
(pass) Security headers > Cross-Origin headers for SharedArrayBuffer > sets COEP for HTML documents [0.08ms]
(pass) Security headers > Cross-Origin headers for SharedArrayBuffer > sets COEP for JS modules [0.13ms]
(pass) Security headers > Cross-Origin headers for SharedArrayBuffer > sets CORP for JS modules [0.17ms]
(pass) Security headers > Cross-Origin headers for SharedArrayBuffer > sets COEP and CORP for WASM files [0.12ms]
(pass) Security headers > Cache control for immutable assets > sets long cache for WASM files [0.08ms]
(pass) Security headers > Cache control for immutable assets > does not set long cache for non-WASM files [0.07ms]
(pass) Security headers > Security headers on different routes > applies security headers to root path [0.08ms]
(pass) Security headers > Security headers on different routes > applies security headers to API routes [0.06ms]
[admin-auth] SIDFLOW_ADMIN_PASSWORD is not set. Using insecure default "password". Set SIDFLOW_ADMIN_PASSWORD in production.
(pass) Security headers > Security headers on different routes > applies security headers to admin routes [1.91ms]
(pass) Security headers > Security headers on different routes > applies security headers to static assets [0.13ms]
(pass) Security headers > Security headers on different routes > applies security headers even on 404 responses [0.08ms]
(pass) Security headers > Security headers integration with other middleware > security headers applied after rate limiting [0.10ms]
(pass) Security headers > Security headers integration with other middleware > security headers applied to rate limit error responses [5.20ms]
(pass) Security headers > Security headers integration with other middleware > security headers applied to authentication responses [0.25ms]

packages/sidflow-web/tests/unit/auth.test.ts:
(pass) User Storage > createUser > should create a new user with valid credentials [52.80ms]
(pass) User Storage > createUser > should normalize username to lowercase [52.21ms]
(pass) User Storage > createUser > should reject username with invalid characters [0.78ms]
(pass) User Storage > createUser > should reject username that is too short [0.44ms]
(pass) User Storage > createUser > should reject username that is too long [0.19ms]
(pass) User Storage > createUser > should reject password that is too short [0.13ms]
(pass) User Storage > createUser > should reject duplicate username [51.17ms]
(pass) User Storage > authenticateUser > should authenticate user with correct password [101.62ms]
(pass) User Storage > authenticateUser > should return null for wrong password [102.43ms]
(pass) User Storage > authenticateUser > should return null for non-existent user [1.47ms]
(pass) User Storage > authenticateUser > should be case-insensitive for username [102.59ms]
(pass) User Storage > getUserById > should retrieve user by ID [52.62ms]
(pass) User Storage > getUserById > should return null for non-existent ID [0.92ms]
(pass) User Storage > getUserByUsername > should retrieve user by username [51.71ms]
(pass) User Storage > getUserByUsername > should return null for non-existent username [0.57ms]
(pass) JWT Utilities > should generate and verify valid token [3.05ms]
(pass) JWT Utilities > should return null for invalid token [0.13ms]
(pass) JWT Utilities > should return null for tampered token [0.20ms]

packages/sidflow-web/tests/unit/admin-auth.test.ts:
(pass) admin auth > rejects unauthorized credentials [0.23ms]
(pass) admin auth > blocks role escalation attempts via tampered session tokens [0.80ms]
(pass) admin auth > expires sessions when past the configured TTL [0.23ms]
(pass) admin auth > generates config defaults and memoizes across calls [0.06ms]
[admin-auth] SIDFLOW_ADMIN_PASSWORD is not set. Using insecure default "password". Set SIDFLOW_ADMIN_PASSWORD in production.
(pass) admin auth > defaults to insecure password when admin password is not configured (dev only) [0.03ms]
(pass) admin auth > parses valid credentials and rejects malformed headers [0.11ms]
(pass) admin auth > round-trips and validates session payloads [1.28ms]
(pass) admin auth > identifies sessions that require renewal [0.37ms]
(pass) admin auth > validates missing tokens and builds unauthorized responses [0.08ms]

packages/sidflow-web/tests/unit/admin-metrics-api.test.ts:
(pass) Admin Metrics API > returns metrics with all required fields [3.38ms]
(pass) Admin Metrics API > includes job metrics [0.38ms]
(pass) Admin Metrics API > includes cache metrics [0.32ms]
(pass) Admin Metrics API > includes sync metrics [1.10ms]
(pass) Admin Metrics API > returns cache-control headers [0.64ms]
(pass) Admin Metrics API > returns timestamp within reasonable range [0.27ms]
(pass) Admin Metrics API > handles missing directories gracefully [0.33ms]

packages/sidflow-web/tests/unit/hls-route.test.ts:
(pass) HLS route > streams manifest assets with cache headers [3.21ms]
(pass) HLS route > returns 404 for unknown assets [0.34ms]

packages/sidflow-web/tests/unit/cli-executor.test.ts:
(pass) executeCli > executes successful command and captures stdout [2.08ms]
(pass) executeCli > captures stderr from command [1.23ms]
(pass) executeCli > handles command failure with non-zero exit code [0.99ms]
(pass) executeCli > handles timeout for long-running command [101.95ms]
(pass) executeCli > handles non-existent command [0.76ms]
(pass) executeCli > passes arguments correctly [1.06ms]
(pass) executeCli > respects custom timeout [501.02ms]
(pass) executeCli > captures multiline output [1.42ms]
(pass) executeCli > falls back to SIDFLOW_CLI_DIR when command is not in PATH [4.11ms]
(pass) executeCli > throttles concurrent CLI executions to 4 by default [205.36ms]
(pass) executeCli > bypassQueue option skips throttling [9.30ms]
(pass) executeCli > queue releases slot even on command failure [1.22ms]
(pass) executeCli > queue releases slot on timeout [50.69ms]

packages/sidflow-web/tests/unit/search-route.test.ts:
(pass) parseSidPath > should parse HVSC-style path with artist and title [0.08ms]
(pass) parseSidPath > should handle underscores in artist name [0.04ms]
(pass) parseSidPath > should handle underscores in filename [0.02ms]
(pass) parseSidPath > should return Unknown for single-level path [0.02ms]
(pass) parseSidPath > should handle path without .sid extension [0.01ms]
(pass) parseSidPath > should handle nested directory structure [0.02ms]
(pass) parseSidPath > should handle path with multiple directory levels [0.02ms]
(pass) parseSidPath > should handle empty path parts [0.02ms]
(pass) parseSidPath > should handle multiple consecutive underscores [0.01ms]
(pass) parseSidPath > should handle special characters after underscore replacement [0.02ms]

packages/sidflow-web/tests/unit/game-soundtrack.test.ts:
(pass) Game Soundtrack helpers > normalizeGameTitle removes punctuation and lowercases [1.09ms]
(pass) Game Soundtrack helpers > extractGameTitle from metadata title [0.11ms]
(pass) Game Soundtrack helpers > extractGameTitle from path when no metadata title [0.04ms]
(pass) Game Soundtrack helpers > extractGameTitle handles edge cases [0.02ms]
(pass) Game Soundtrack helpers > normalizeGameTitle handles null and undefined [0.02ms]
(pass) Game Soundtrack helpers > normalizeGameTitle removes brackets and parentheses [0.02ms]
(pass) Game Soundtrack helpers > normalizeGameTitle normalizes spaces [0.02ms]
(pass) Game Soundtrack helpers > extractGameTitle handles deep paths [0.02ms]
(pass) Game Soundtrack helpers > extractGameTitle handles special characters in folders [0.02ms]

packages/sidflow-web/tests/unit/telemetry.test.ts:
(pass) TelemetryService > should have default mode [0.51ms]
(pass) TelemetryService > should allow setting mode [0.04ms]
(pass) TelemetryService > should track events in test mode [0.12ms]
(pass) TelemetryService > should not track events in disabled mode [0.04ms]
(pass) TelemetryService > should track playback state changes [0.06ms]
(pass) TelemetryService > should track audio metrics [0.08ms]
(pass) TelemetryService > should track performance metrics [0.06ms]
(pass) TelemetryService > should track errors [0.10ms]
(pass) TelemetryService > sends beacons in production mode when available [0.38ms]
[Telemetry] playback.load.success {
  type: "playback.load.success",
  timestamp: 1765669646454,
  sessionId: "dev-warn",
  sidPath: "warn.sid",
  metadata: {
    error: undefined,
    metrics: undefined,
  },
}
(pass) TelemetryService > warns in development when sendBeacon throws [0.18ms]

packages/sidflow-web/tests/unit/cli-executor.integration.test.ts:
(pass) executeCli > captures stdout/stderr for successful commands [20.57ms]
(pass) executeCli > returns timeout result when command exceeds limit [51.74ms]

packages/sidflow-web/tests/unit/playlist-builder.test.ts:
(pass) Playlist Builder > buildSongPlaylist > builds playlist for single song [0.14ms]
(pass) Playlist Builder > buildSongPlaylist > extracts display name from path [0.05ms]
(pass) Playlist Builder > buildSongPlaylist > handles root-level files [0.03ms]
(pass) Playlist Builder > buildFolderPlaylist - non-recursive > fetches files from single folder [0.32ms]
(pass) Playlist Builder > buildFolderPlaylist - non-recursive > returns empty array for folder with no files [0.08ms]
(pass) Playlist Builder > buildFolderPlaylist - recursive > collects files from folder tree [0.32ms]
(pass) Playlist Builder > buildFolderPlaylist - recursive > respects maxFiles limit [0.19ms]
Failed to fetch folder Root/BadFolder: 30 |   if (path) {
31 |     params.set('path', path);
32 |   }
33 |   const response = await fetch(`/api/hvsc/browse?${params.toString()}`);
34 |   if (!response.ok) {
35 |     throw new Error(`Failed to fetch folder: ${response.statusText}`);
               ^
error: Failed to fetch folder: Not Found
      at fetchFolderContents (/workspace/packages/sidflow-web/lib/playlist-builder.ts:35:11)
      at async collectFilesRecursive (/workspace/packages/sidflow-web/lib/playlist-builder.ts:78:26)
      at async buildFolderPlaylist (/workspace/packages/sidflow-web/lib/playlist-builder.ts:146:19)
      at async <anonymous> (/workspace/packages/sidflow-web/tests/unit/playlist-builder.test.ts:211:30)

(pass) Playlist Builder > buildFolderPlaylist - recursive > handles errors gracefully during recursive scan [0.29ms]
(pass) Playlist Builder > buildFolderPlaylist - recursive > prevents infinite loops with duplicate paths [0.15ms]
(pass) Playlist Builder > buildFolderPlaylist - shuffle > shuffles playlist when shuffle option is true [0.19ms]
(pass) Playlist Builder > getPlaylistModeDescription > returns shuffle description [0.04ms]
(pass) Playlist Builder > getPlaylistModeDescription > returns recursive description [0.02ms]
(pass) Playlist Builder > getPlaylistModeDescription > returns non-recursive description [0.01ms]
(pass) Playlist Builder > getPlaylistModeDescription > handles root path [0.01ms]
(pass) Playlist Builder > getPlaylistModeDescription > extracts folder name from path [0.01ms]

packages/sidflow-web/tests/unit/prefs-route-config-limits.test.ts:
(pass) /api/prefs config limits > GET includes config maxRenderSec/maxClassifySec snapshot [1.85ms]
(pass) /api/prefs config limits > POST updates config limits and persists to .sidflow.json [3.68ms]
(pass) /api/prefs config limits > POST rejects maxRenderSec that is too small for representative-window intro skipping [1.14ms]
(pass) /api/prefs config limits > POST accepts null to reset (removes keys) [1.58ms]
(pass) /api/prefs config limits > POST rejects non-positive values [0.74ms]
(pass) /api/prefs config limits > POST rejects wrong types [0.47ms]

packages/sidflow-web/tests/unit/worklet-guard.test.ts:
(pass) WorkletGuard > emits warnings when average frame duration exceeds budget [1.59ms]
(pass) WorkletGuard > records summary stats on stop [0.07ms]

packages/sidflow-web/tests/unit/feedback-worker.test.ts:
(pass) feedback worker > persists rating feedback via background flush [2.11ms]
(pass) feedback worker > persists implicit feedback via background flush [0.72ms]
(pass) feedback worker > assigns uuids when not provided [0.67ms]

packages/sidflow-web/tests/unit/preferences-store.test.ts:
(pass) WebPreferences Schema > should have default preferredEngines as null [0.02ms]
(pass) WebPreferences Schema > should accept valid renderEngine values [0.04ms]
(pass) WebPreferences Schema > should accept valid preferredEngines array [0.01ms]
(pass) WebPreferences Schema > should accept null preferredEngines
(pass) WebPreferences Schema > should allow empty preferredEngines array [0.01ms]
(pass) WebPreferences Schema > should allow deduplication of preferred engines [0.03ms]
(pass) Preference Merging Logic > should merge user preferences over config preferences [0.05ms]
(pass) Preference Merging Logic > should always append wasm if not present [0.02ms]

packages/sidflow-web/tests/unit/playlists-api.test.ts:
(pass) Playlists API > GET /api/playlists > returns empty playlists array [0.40ms]
(pass) Playlists API > GET /api/playlists > returns list of playlists [1.38ms]
(pass) Playlists API > POST /api/playlists > creates a new playlist [0.88ms]
(pass) Playlists API > POST /api/playlists > validates required name field [0.22ms]
(pass) Playlists API > POST /api/playlists > validates tracks array [0.11ms]
(pass) Playlists API > POST /api/playlists > validates track sidPath [0.10ms]
(pass) Playlists API > GET /api/playlists/[id] > retrieves a playlist by ID [0.58ms]
(pass) Playlists API > GET /api/playlists/[id] > returns 404 for non-existent playlist [0.20ms]
(pass) Playlists API > PUT /api/playlists/[id] > updates a playlist [0.98ms]
(pass) Playlists API > PUT /api/playlists/[id] > returns 404 for non-existent playlist [0.57ms]
(pass) Playlists API > DELETE /api/playlists/[id] > deletes a playlist [0.99ms]
(pass) Playlists API > DELETE /api/playlists/[id] > returns 404 for non-existent playlist [0.30ms]
(pass) Playlists API > POST /api/playlists/[id]/reorder > reorders playlist tracks [0.74ms]
(pass) Playlists API > POST /api/playlists/[id]/reorder > validates trackOrder array [0.15ms]

packages/sidflow-web/tests/unit/proxy-rate-limit.test.ts:
(pass) Proxy rate limiting > rate limits API routes [4.49ms]
[admin-auth] SIDFLOW_ADMIN_PASSWORD is not set. Using insecure default "password". Set SIDFLOW_ADMIN_PASSWORD in production.
(pass) Proxy rate limiting > applies stricter rate limit to admin routes [4.83ms]
(pass) Proxy rate limiting > does not rate limit non-API routes [1.80ms]
(pass) Proxy rate limiting > includes rate limit headers in 429 response [3.52ms]
(pass) Proxy rate limiting > tracks different IPs independently [3.74ms]
(pass) Proxy rate limiting > does not rate limit localhost [1.67ms]
(pass) Proxy rate limiting > rate limit response includes security headers [3.73ms]
(pass) Proxy rate limiting > admin route rate limit is enforced before authentication [0.86ms]
(pass) Proxy middleware integration > applies rate limiting, then auth, then security headers in order [0.15ms]
(pass) Proxy middleware integration > short-circuits on rate limit failure [4.38ms]

packages/sidflow-web/tests/unit/rate-playback-utils.test.ts:
(pass) parseDurationSeconds > should return 180 for undefined/null [0.14ms]
(pass) parseDurationSeconds > should parse MM:SS format correctly [0.05ms]
(pass) parseDurationSeconds > should enforce minimum 15 seconds for MM:SS format [0.02ms]
(pass) parseDurationSeconds > should parse numeric string as seconds [0.02ms]
(pass) parseDurationSeconds > should enforce minimum 15 seconds for numeric format [0.03ms]
(pass) parseDurationSeconds > should return 180 for invalid MM:SS format [0.02ms]
(pass) parseDurationSeconds > should return 180 for invalid numeric string [0.01ms]
(pass) parseDurationSeconds > should handle negative numbers [0.01ms]
(pass) parseDurationSeconds > should return 180 for zero [0.01ms]
(pass) parseDurationSeconds > should return 180 for empty string [0.01ms]
(pass) parseDurationSeconds > should handle large durations [0.01ms]
(pass) parseDurationSeconds > should handle decimal seconds in MM:SS and numeric formats [0.02ms]
(pass) parseDurationSeconds > should trim whitespace (implicitly through Number parsing)

packages/sidflow-web/tests/unit/image-comparison.test.ts:
(pass) Image Comparison > should detect identical images as same [2.93ms]
(pass) Image Comparison > should ignore metadata differences [0.79ms]
(pass) Image Comparison > should detect different pixels [0.88ms]
(pass) Image Comparison > should handle non-existent files [0.29ms]
(pass) Image Comparison > saveScreenshotIfDifferent should save new file if target does not exist [0.59ms]
[image-comparison] Screenshot unchanged, skipping save: /workspace/test-workspace/image-comparison-test/target.png
(pass) Image Comparison > saveScreenshotIfDifferent should not save if images are identical [12.91ms]
[image-comparison] Screenshot unchanged, skipping save: /workspace/test-workspace/image-comparison-test/target-plain.png
(pass) Image Comparison > saveScreenshotIfDifferent should not save if only metadata differs [11.31ms]
[image-comparison] Screenshot changed (4/4 = 100.00% pixels differ), updating: /workspace/test-workspace/image-comparison-test/red-target.png
(pass) Image Comparison > saveScreenshotIfDifferent should save if pixels differ [2.94ms]
(pass) Image Comparison > should detect single pixel difference [2.08ms]

packages/sidflow-web/tests/unit/api/scheduler.test.ts:
[scheduler-init] Scheduler is disabled
(pass) /api/scheduler > GET /api/scheduler > should return complete scheduler configuration and status [1.37ms]
[scheduler-init] Reinitializing scheduler...
[scheduler] Scheduler stopped
[scheduler-init] Starting scheduler with config: {
  enabled: true,
  time: "06:00",
  timezone: "UTC",
}
[scheduler] Next run scheduled for 2025-12-14T06:00:00.000Z (in 373 minutes)
[scheduler-init] Reinitializing scheduler...
[scheduler] Scheduler stopped
[scheduler-init] Scheduler is disabled
(pass) /api/scheduler > POST /api/scheduler > should update scheduler enabled state [1.79ms]
[scheduler-init] Reinitializing scheduler...
[scheduler] Scheduler stopped
[scheduler-init] Scheduler is disabled
[scheduler-init] Reinitializing scheduler...
[scheduler] Scheduler stopped
[scheduler-init] Scheduler is disabled
[scheduler-init] Reinitializing scheduler...
[scheduler] Scheduler stopped
[scheduler-init] Scheduler is disabled
(pass) /api/scheduler > POST /api/scheduler > should update scheduler time and normalize format [0.74ms]
(pass) /api/scheduler > POST /api/scheduler > should update renderPrefs [0.88ms]
(pass) /api/scheduler > POST /api/scheduler > should return 400 for invalid inputs [0.66ms]
[scheduler-init] Reinitializing scheduler...
[scheduler] Scheduler stopped
[scheduler-init] Starting scheduler with config: {
  enabled: true,
  time: "08:00",
  timezone: "UTC",
}
[scheduler] Next run scheduled for 2025-12-14T08:00:00.000Z (in 493 minutes)
[scheduler-init] Reinitializing scheduler...
[scheduler] Scheduler stopped
[scheduler-init] Starting scheduler with config: {
  enabled: true,
  time: "10:00",
  timezone: "UTC",
}
[scheduler] Next run scheduled for 2025-12-14T10:00:00.000Z (in 613 minutes)
[scheduler-init] Reinitializing scheduler...
[scheduler] Scheduler stopped
[scheduler-init] Scheduler is disabled
(pass) /api/scheduler > POST /api/scheduler > should allow partial scheduler updates [1.20ms]
(pass) /api/scheduler > request validation > should validate scheduler and renderPrefs data types [0.16ms]

packages/sidflow-web/tests/unit/api/classify-route-temp-config.test.ts:
[engine-order] Preferred engine order: wasm
[engine-order] Classification starting
[engine-order] Effective engine order: wasm
(pass) /api/classify temp config > writes preferredEngines and defaultFormats into temp config [4.16ms]

packages/sidflow-web/tests/unit/api/search.test.ts:
(pass) /api/search parseSidPath helper > should parse HVSC path with artist and title [0.08ms]
(pass) /api/search parseSidPath helper > should parse path with underscores in filename [0.02ms]
(pass) /api/search parseSidPath helper > should handle single-level path [0.01ms]
(pass) /api/search parseSidPath helper > should handle nested paths [0.01ms]
(pass) /api/search parseSidPath helper > should handle paths without .sid extension [0.01ms]
(pass) /api/search query parameter validation > should require "q" query parameter [1.00ms]
(pass) /api/search query parameter validation > should reject empty query string [0.11ms]
(pass) /api/search query parameter validation > should reject whitespace-only query [0.07ms]
(pass) /api/search limit parameter > should default to 50 results when no limit specified [0.86ms]
(pass) /api/search limit parameter > should enforce maximum limit of 100 [0.20ms]
(pass) /api/search limit parameter > should accept custom limit within range [0.10ms]
(pass) /api/search response format > should return success response with proper structure [0.11ms]
(pass) /api/search response format > should include matchedIn field for results [0.12ms]
(pass) /api/search response format > should normalize query to lowercase for matching [0.09ms]

packages/sidflow-web/tests/unit/api/charts.test.ts:
(pass) /api/charts parseSidPath helper > should parse HVSC path with artist and title [0.07ms]
(pass) /api/charts parseSidPath helper > should parse path with underscores in filename [0.02ms]
(pass) /api/charts parseSidPath helper > should handle single-level path [0.01ms]
(pass) /api/charts parseSidPath helper > should handle nested paths [0.01ms]
Error reading feedback directory: ENOENT: no such file or directory, scandir '/workspace/data/feedback'
    path: "/workspace/data/feedback",
 syscall: "scandir",
   errno: -2,
    code: "ENOENT"


(pass) /api/charts range parameter validation > should default to "week" when no range specified [1.99ms]
(pass) /api/charts range parameter validation > should accept valid range: week [0.16ms]
Error reading feedback directory: ENOENT: no such file or directory, scandir '/workspace/data/feedback'
    path: "/workspace/data/feedback",
 syscall: "scandir",
   errno: -2,
    code: "ENOENT"


(pass) /api/charts range parameter validation > should accept valid range: month [0.20ms]
Error reading feedback directory: ENOENT: no such file or directory, scandir '/workspace/data/feedback'
    path: "/workspace/data/feedback",
 syscall: "scandir",
   errno: -2,
    code: "ENOENT"


(pass) /api/charts range parameter validation > should accept valid range: all [0.33ms]
(pass) /api/charts range parameter validation > should reject invalid range [0.10ms]
(pass) /api/charts limit parameter > should default to 20 results when no limit specified [0.08ms]
Error reading feedback directory: ENOENT: no such file or directory, scandir '/workspace/data/feedback'
    path: "/workspace/data/feedback",
 syscall: "scandir",
   errno: -2,
    code: "ENOENT"


(pass) /api/charts limit parameter > should enforce maximum limit of 100 [0.12ms]
Error reading feedback directory: ENOENT: no such file or directory, scandir '/workspace/data/feedback'
    path: "/workspace/data/feedback",
 syscall: "scandir",
   errno: -2,
    code: "ENOENT"


(pass) /api/charts limit parameter > should accept custom limit within range [0.11ms]
(pass) /api/charts response format > should return success response with proper structure [0.10ms]
(pass) /api/charts response format > should include required fields in chart entries [0.09ms]
(pass) /api/charts response format > should return charts sorted by play count descending [0.09ms]
(pass) /api/charts response format > should handle empty feedback gracefully [0.07ms]

packages/sidflow-web/tests/unit/api/activity.test.ts:
(pass) /api/activity > should return recent activity events [2.23ms]
(pass) /api/activity > should return events in reverse chronological order [2.48ms]
(pass) /api/activity > should limit results to requested amount [0.64ms]
(pass) /api/activity > should enforce maximum limit of 100 [0.49ms]
(pass) /api/activity > should handle missing feedback directory gracefully [0.44ms]
(pass) /api/activity > should skip invalid JSON lines [0.75ms]
(pass) /api/activity > should handle default values for missing fields [0.95ms]

packages/sidflow-web/tests/unit/api/users.test.ts:
(pass) /api/users/[username] > should return user profile with stats [53.55ms]
(pass) /api/users/[username] > should return 404 for non-existent user [53.39ms]
(pass) /api/users/[username] > should calculate stats from feedback events correctly [53.48ms]
(pass) /api/users/[username] > should handle user with no activity [103.74ms]
(pass) /api/users/[username] > should handle missing feedback directory [52.74ms]
(pass) /api/users/[username] > should skip invalid JSON lines in feedback [52.41ms]

packages/sidflow-web/tests/unit/api/classify-export.test.ts:
[export] Collecting classifications from workspace/tags
[export] Exporting 1 classification entries
(pass) classification export/import API > GET /api/classify/export > should return 404 when no classifications exist or 200 with proper structure [2.56ms]
[import] Error importing classifications: 133 |   try {
134 |     const body = await request.json() as ExportData;
135 | 
136 |     // Validate the import data
137 |     if (!body.version || body.version !== '1.0') {
138 |       throw new Error(`Invalid or unsupported export version: ${body.version}. Expected version 1.0`);
                  ^
error: Invalid or unsupported export version: 2.0. Expected version 1.0
      at POST (/workspace/packages/sidflow-web/app/api/classify/export/route.ts:138:13)
      at async <anonymous> (/workspace/packages/sidflow-web/tests/unit/api/classify-export.test.ts:69:30)

(pass) classification export/import API > POST /api/classify/export (import) > should reject invalid version with expected version message [1.16ms]
[import] Error importing classifications: 137 |     if (!body.version || body.version !== '1.0') {
138 |       throw new Error(`Invalid or unsupported export version: ${body.version}. Expected version 1.0`);
139 |     }
140 | 
141 |     if (!body.classifications || typeof body.classifications !== 'object') {
142 |       throw new Error('Missing or invalid classifications data');
                  ^
error: Missing or invalid classifications data
      at POST (/workspace/packages/sidflow-web/app/api/classify/export/route.ts:142:13)
      at async <anonymous> (/workspace/packages/sidflow-web/tests/unit/api/classify-export.test.ts:90:30)

(pass) classification export/import API > POST /api/classify/export (import) > should reject missing classifications [0.20ms]
[import] Importing 1 classification entries
[import] Wrote 1 entries to 1 auto-tags.json files
[import] Importing 0 classification entries
[import] Wrote 0 entries to 0 auto-tags.json files
(pass) classification export/import API > POST /api/classify/export (import) > should accept valid import data and handle empty classifications [0.49ms]
(pass) classification export/import data structures > should have correct export data format and structure [0.07ms]
(pass) classification export/import data structures > should handle file collection, paths, and merging [2.05ms]
(pass) classification export/import data structures > should validate import data correctly [0.07ms]

packages/sidflow-web/tests/unit/lib/scheduler.test.ts:
(pass) scheduler > calculateNextRunTime > should calculate next run time for same day if time has not passed [0.08ms]
(pass) scheduler > calculateNextRunTime > should calculate next run time for next day if time has passed [0.02ms]
[scheduler] Invalid time format: invalid, using default 06:00
(pass) scheduler > calculateNextRunTime > should handle invalid time format gracefully [0.03ms]
(pass) scheduler > calculateNextRunTime > should handle edge case of exact time [0.01ms]
(pass) scheduler > calculateNextRunTime > should handle single-digit hour format [0.02ms]
(pass) scheduler > calculateNextRunTime > should handle midnight correctly [0.02ms]
(pass) scheduler > getMillisUntilNextRun > should return positive milliseconds until next run [0.02ms]
(pass) scheduler > getMillisUntilNextRun > should never return negative milliseconds [0.02ms]
(pass) scheduler > getMillisUntilNextRun > should calculate correct delay for next day run [0.01ms]

packages/sidflow-web/tests/unit/hooks/useKeyboardShortcuts.test.ts:
(pass) useKeyboardShortcuts hook logic > should export SHORTCUTS_MAP with correct key mappings [1.25ms]
(pass) useKeyboardShortcuts hook logic > should have case-insensitive shortcuts for m, f, s [0.07ms]
(pass) useKeyboardShortcuts hook logic > should define input suppression logic
(pass) getShortcutDescriptions > should return array of shortcut descriptions [0.02ms]
(pass) getShortcutDescriptions > should include all required fields [0.05ms]
(pass) getShortcutDescriptions > should include Space for play/pause [0.02ms]
(pass) getShortcutDescriptions > should include arrow keys for navigation and volume [0.02ms]
(pass) getShortcutDescriptions > should include M for mute [0.02ms]
(pass) getShortcutDescriptions > should include F for favorite [0.02ms]
(pass) getShortcutDescriptions > should include S for search [0.05ms]
(pass) getShortcutDescriptions > should include ? for help [0.02ms]
--------------------------------------------------------------|---------|---------|-------------------
File                                                          | % Funcs | % Lines | Uncovered Line #s
--------------------------------------------------------------|---------|---------|-------------------
All files                                                     |   75.64 |   72.37 |
 ../tmp/sidflow-classify-cli-invalid-yZRu65/invalid.mjs       |  100.00 |  100.00 | 
 ../tmp/sidflow-classify-cli-nr4Gyl/feature.mjs               |  100.00 |  100.00 | 
 ../tmp/sidflow-classify-cli-nr4Gyl/metadata.mjs              |  100.00 |  100.00 | 
 ../tmp/sidflow-classify-cli-nr4Gyl/predictor.mjs             |  100.00 |  100.00 | 
 ../tmp/sidflow-classify-cli-nr4Gyl/render.mjs                |  100.00 |  100.00 | 
 packages/libsidplayfp-wasm/dist/index.js                     |    0.00 |   52.38 | 11-20
 packages/libsidplayfp-wasm/dist/libsidplayfp.js              |   45.68 |  100.00 | 
 packages/libsidplayfp-wasm/dist/player.js                    |    0.00 |   10.83 | 13-14,17-22,25-27,30,59-95,98-101,104-133,138-218,221-224,227-230,233-236,239-242,245-324,327-371,374-409,412-419,422-423,426-496,499-501,508-510
 packages/libsidplayfp-wasm/src/index.ts                      |  100.00 |   95.45 | 
 packages/libsidplayfp-wasm/src/player.ts                     |   73.17 |   56.40 | 26-31,35-37,199-252,299-302,420-455,459-494,514-588,592-595
 packages/sidflow-classify/src/audio-window.ts                |   75.00 |   74.59 | 19-32,39-45,47,58,106-113
 packages/sidflow-classify/src/classify-metrics.ts            |   92.86 |   81.22 | 268-304
 packages/sidflow-classify/src/cli.ts                         |   75.00 |   80.46 | 102-106,109,128,226,236,241-259,267,285-287,299-320,330-339,384,386,483
 packages/sidflow-classify/src/essentia-features.ts           |   83.33 |   86.91 | 30,42-52,60,74,94,100-101,173-174,242,244,248,250-251,275,302,305,397-404
 packages/sidflow-classify/src/feature-cache.ts               |   92.31 |   61.18 | 81-82,89-92,95-96,98,100-105,107-110,129,140-143,176-210
 packages/sidflow-classify/src/feature-extraction-pool.ts     |   90.00 |   95.12 | 130-137
 packages/sidflow-classify/src/index.ts                       |   86.25 |   79.90 | 91,93-94,97-103,105,306-310,315,328,416-428,430-431,467,469,488-584,662-665,799-808,834-836,861-863,866-868,874-877,972,997,1067,1074,1079,1132,1134-1137,1335-1337,1339,1381-1421,1428,1430-1433,1492-1500,1525,1530,1575-1584,1605,1646-1655,1747-1757,1813,1816-1817,1819-1829,1833,1835-1836
 packages/sidflow-classify/src/jsonl-writer-queue.ts          |  100.00 |   95.88 | 76-79
 packages/sidflow-classify/src/render/cli.ts                  |   62.96 |   36.39 | 102-104,122-123,127-128,132,136,146,157-158,166-171,173-175,180-181,186,191-197,199-215,229,234,241-246,248,276-277,284-288,291-309,313-467,479-480,591-608,612-662,666-670,674-698,702-719,723-775,780-781,783-785
 packages/sidflow-classify/src/render/engine-factory.ts       |  100.00 |  100.00 | 
 packages/sidflow-classify/src/render/render-orchestrator.ts  |   75.86 |   65.59 | 486-509,556-559,563,567,584-585,588-799
 packages/sidflow-classify/src/render/wasm-render-pool.ts     |   82.35 |   88.89 | 116-123,143-152
 packages/sidflow-classify/src/render/wav-postprocess.ts      |   85.71 |   77.65 | 8-14,27,34,39,44,50,70-74,98,138,145,150,155,161,166,191,196,221-234
 packages/sidflow-classify/src/render/wav-renderer.ts         |  100.00 |   86.44 | 40-43,112-116,180-185,201-207,212
 packages/sidflow-classify/src/render/wav-truncate.ts         |  100.00 |   93.33 | 28,53,57,90,100,109
 packages/sidflow-classify/src/tfjs-predictor.ts              |  100.00 |   91.01 | 39-42,48-50,53-56,59,65-66,69-75,82-85,87,216-218,469-474,648-649,654,750,789-790
 packages/sidflow-classify/src/types/state-machine.ts         |  100.00 |  100.00 | 
 packages/sidflow-common/dist/archive.js                      |    0.00 |   16.00 | 5-8,12-15,18-43,47-50,53-54,58-59
 packages/sidflow-common/dist/audio-encoding.js               |   16.13 |   12.98 | 24-30,36-42,61,66-67,70-80,91-99,106-126,129,132-140,143-153,156-195,199-234,240-243,246-250,253-268,271-283,287-314,317-330,333-345,348-363,366-378,381-393,399,405,412-425,428-442,449-460,463-475,481-523
 packages/sidflow-common/dist/audio-types.js                  |  100.00 |  100.00 | 
 packages/sidflow-common/dist/audit-trail.js                  |    0.00 |   15.38 | 12-61,69-73
 packages/sidflow-common/dist/availability-manifest.js        |   20.00 |   21.43 | 7-17,22,25,31-52,55-66,69-71,74-83,86-90,100-105,108,111,114-125,128,131-132
 packages/sidflow-common/dist/canonical-writer.js             |    0.00 |   15.79 | 13-14,17-29,33-36,39-46,49-67,70
 packages/sidflow-common/dist/chip-model.js                   |  100.00 |   53.33 | 6,10,14-18
 packages/sidflow-common/dist/cli-parser.js                   |    0.00 |    1.42 | 7-27,30-70,74-87,90-94,105-168,180-230,242-253
 packages/sidflow-common/dist/config-cache.js                 |   83.33 |   57.61 | 27,35,37-39,42-44,46-47,49-50,79-82,101-117,129-134
 packages/sidflow-common/dist/config.js                       |   90.91 |   64.91 | 12-16,45-46,55,62,68-69,81-84,89,95,102,105,115,125,128,154,160,166,171,178,183,191,199,208,214,220,229,235,244,254,262-268,279,284,290-293,296-299,305,310-313,327,333,339,344-347,354-427
 packages/sidflow-common/dist/feedback.js                     |    0.00 |    6.45 | 18-44,54-62,70,79-157
 packages/sidflow-common/dist/fs.js                           |   80.00 |   80.00 | 10,24-25
 packages/sidflow-common/dist/index.js                        |  100.00 |  100.00 | 
 packages/sidflow-common/dist/job-orchestrator.js             |    0.00 |    8.28 | 16-74,80,86-168,174-176,182-190
 packages/sidflow-common/dist/job-queue.js                    |    0.00 |   13.33 | 11-16,19-63
 packages/sidflow-common/dist/job-runner.js                   |    0.00 |    3.91 | 7-53,56-60,63-70,73-108,115-287
 packages/sidflow-common/dist/job-types.js                    |  100.00 |  100.00 | 
 packages/sidflow-common/dist/json.js                         |  100.00 |  100.00 | 
 packages/sidflow-common/dist/jsonl-schema.js                 |  100.00 |  100.00 | 
 packages/sidflow-common/dist/lancedb-builder.js              |    0.00 |    5.82 | 23-55,61-92,98-124,130-154,160-189,195-225
 packages/sidflow-common/dist/logger.js                       |  100.00 |   76.09 | 10-12,18,22-27
 packages/sidflow-common/dist/metadata-cache.js               |    0.00 |   14.89 | 27-66,72-91,98-124,130-142,149-152,158-167,171-172,175-178
 packages/sidflow-common/dist/perf-utils.js                   |    0.00 |   19.90 | 17-22,28-32,38-60,66,72,78-93,99-122,130,136-143,149-156,168-169,175-183,189-192,198,204,211,221,227,233-239,245-265,271-283,289-290
 packages/sidflow-common/dist/playback-harness.js             |    0.00 |   10.92 | 14-25,32-40,46-50,53-54,80-85,88-98,101-111,114,117-211,214-322
 packages/sidflow-common/dist/playback-lock.js                |    0.00 |   14.89 | 6-8,11-23,26-34,38-39,42-46,51-96,100-101
 packages/sidflow-common/dist/ratings.js                      |    0.00 |    0.00 | 1-13
 packages/sidflow-common/dist/recommender.js                  |    0.00 |   12.56 | 35-73,79-97,103-135,142-186,192-208,214-217,224-228,235-238,244-259,265-276
 packages/sidflow-common/dist/render-matrix.js                |    0.00 |   55.36 | 73-95,101-115,121-126,132,138,144-147
 packages/sidflow-common/dist/retry.js                        |    0.00 |    0.00 | 1-21
 packages/sidflow-common/dist/sid-parser.js                   |    0.00 |    2.61 | 9,16-25,31-42,49-59,67-70,76-77,83-163,169-196
 packages/sidflow-common/dist/songlengths.js                  |   80.00 |   78.13 | 32,35,154,163,177-181,199-218,221-233,236-242
 packages/sidflow-common/dist/tags.js                         |   20.00 |   30.00 | 8,14-18,21-25,28-32,35-36,39-42,45,48-54,57-61
 packages/sidflow-common/dist/ultimate64-capture.js           |    0.00 |    6.28 | 31-79,85-123,129-178,184-187,193-199,205-229,235-239,245-247,253,259-268
 packages/sidflow-common/dist/ultimate64-client.js            |    0.00 |    3.31 | 10-155
 packages/sidflow-common/dist/wasm-build.js                   |    0.00 |   16.19 | 7-8,16-26,29-35,38-51,54-88,91-93,96-100,103-104,107-115
 packages/sidflow-common/src/archive.ts                       |   91.67 |   88.68 | 14-17,26-27
 packages/sidflow-common/src/audio-encoding.ts                |   62.96 |   38.85 | 74,78-79,83-95,109-110,112,114,116-121,132-161,193-202,206-221,251,281-323,330-333,337-342,346-365,369-384,399-437,441-456,460-475,479-500,504-517,529-532,534-537,539,582-596,627-639,682
 packages/sidflow-common/src/audio-types.ts                   |  100.00 |  100.00 | 
 packages/sidflow-common/src/audit-trail.ts                   |  100.00 |  100.00 | 
 packages/sidflow-common/src/availability-manifest.ts         |  100.00 |   93.24 | 74,161,164,214,218-223
 packages/sidflow-common/src/canonical-writer.ts              |  100.00 |   92.05 | 66,99,114-118
 packages/sidflow-common/src/chip-model.ts                    |  100.00 |  100.00 | 
 packages/sidflow-common/src/cli-parser.ts                    |  100.00 |   98.13 | 104,126,145
 packages/sidflow-common/src/config-cache.ts                  |  100.00 |   97.00 | 42,68-69
 packages/sidflow-common/src/config.ts                        |  100.00 |   60.20 | 129-130,159-160,187-189,207-209,225-227,238-240,243-245,275-277,285-287,301-303,311-313,329-331,341-344,355-358,365-367,375-377,387-389,397-399,409-411,423-426,435-443,457-459,475-477,484-486,496-499,506-508,529-531,539-541,548-550,556-561,570,572-576,578-579,581-588,590-597,599-613,615-620,622-623,625-636,638-645,647-654,656-667,669-680,682-683
 packages/sidflow-common/src/feedback.ts                      |  100.00 |   98.26 | 209
 packages/sidflow-common/src/fs.ts                            |  100.00 |  100.00 | 
 packages/sidflow-common/src/index.ts                         |  100.00 |  100.00 | 
 packages/sidflow-common/src/job-orchestrator.ts              |  100.00 |  100.00 | 
 packages/sidflow-common/src/job-queue.ts                     |  100.00 |  100.00 | 
 packages/sidflow-common/src/job-runner.ts                    |   95.45 |   99.30 | 159-160
 packages/sidflow-common/src/job-types.ts                     |  100.00 |  100.00 | 
 packages/sidflow-common/src/json.ts                          |  100.00 |  100.00 | 
 packages/sidflow-common/src/jsonl-schema.ts                  |  100.00 |  100.00 | 
 packages/sidflow-common/src/lancedb-builder.ts               |  100.00 |   97.75 | 199-200,283
 packages/sidflow-common/src/logger.ts                        |  100.00 |   78.26 | 15-17,25,30-35
 packages/sidflow-common/src/metadata-cache.ts                |  100.00 |   89.05 | 61-66,106-112,151
 packages/sidflow-common/src/perf-utils.ts                    |  100.00 |  100.00 | 
 packages/sidflow-common/src/playback-harness.ts              |    0.00 |   10.03 | 93-104,111-119,127-131,135-136,165-172,179-189,196-206,210,214-325,329-453
 packages/sidflow-common/src/playback-lock.ts                 |   96.00 |   86.36 | 27-38
 packages/sidflow-common/src/ratings.ts                       |  100.00 |  100.00 | 
 packages/sidflow-common/src/recommender.ts                   |  100.00 |  100.00 | 
 packages/sidflow-common/src/render-matrix.ts                 |  100.00 |  100.00 | 
 packages/sidflow-common/src/retry.ts                         |  100.00 |   95.00 | 
 packages/sidflow-common/src/sid-parser.ts                    |  100.00 |   93.71 | 100,118,128,177,193,266,270,274
 packages/sidflow-common/src/songlengths.ts                   |  100.00 |   94.69 | 190-191,195-200,212-213,236-238
 packages/sidflow-common/src/tags.ts                          |  100.00 |   98.36 | 
 packages/sidflow-common/src/ultimate64-capture.ts            |   78.95 |   94.30 | 104-106,307-311,318-320
 packages/sidflow-common/src/ultimate64-client.ts             |  100.00 |  100.00 | 
 packages/sidflow-common/src/wasm-build.ts                    |  100.00 |   93.81 | 64-69
 packages/sidflow-fetch/src/cli.ts                            |   75.00 |   92.98 | 75-76,82
 packages/sidflow-fetch/src/manifest.ts                       |  100.00 |  100.00 | 
 packages/sidflow-fetch/src/sync.ts                           |   87.50 |   83.80 | 89,209,262-266,291,297-298,325,338-363,367-375
 packages/sidflow-fetch/src/version.ts                        |  100.00 |  100.00 | 
 packages/sidflow-performance/src/action-map.ts               |  100.00 |  100.00 | 
 packages/sidflow-performance/src/constants.ts                |  100.00 |  100.00 | 
 packages/sidflow-performance/src/journey-loader.ts           |  100.00 |   94.37 | 31-32,35-36
 packages/sidflow-performance/src/k6-executor.ts              |  100.00 |  100.00 | 
 packages/sidflow-performance/src/playwright-executor.ts      |  100.00 |   99.21 | 
 packages/sidflow-performance/src/runner.ts                   |   93.94 |   90.31 | 63,304,307,310-328,385-390
 packages/sidflow-play/src/cli.ts                             |   50.00 |   92.47 | 194,197,200,207,237-238,326-330,357,362-363,377,379-380
 packages/sidflow-play/src/export.ts                          |  100.00 |  100.00 | 
 packages/sidflow-play/src/filters.ts                         |  100.00 |   88.98 | 101-102,132,135-137,145,147,150,160,162,184,186
 packages/sidflow-play/src/index.ts                           |  100.00 |  100.00 | 
 packages/sidflow-play/src/playback.ts                        |   93.94 |   94.42 | 63-72,346-349
 packages/sidflow-play/src/playlist.ts                        |  100.00 |  100.00 | 
 packages/sidflow-play/src/session.ts                         |  100.00 |  100.00 | 
 packages/sidflow-rate/src/index.ts                           |   93.75 |   97.87 | 121-122
 packages/sidflow-train/src/cli.ts                            |   75.00 |   92.86 | 124-128,134
 packages/sidflow-train/src/index.ts                          |  100.00 |   97.94 | 124,126-127,222-223
 packages/sidflow-web/app/api/activity/route.ts               |  100.00 |   89.66 | 89-94
 packages/sidflow-web/app/api/admin/metrics/route.ts          |  100.00 |   68.32 | 70-78,95-97,99-102,104-119,121,155-157,159-161,163-164,166-169,221,235-239
 packages/sidflow-web/app/api/charts/route.ts                 |   57.14 |   57.14 | 28-38,69,71-72,74-75,77-78,80-81,83,85-87,89-90,92-93,96,99-100,103-105,107,109-110,112,114-115,165-171,194-200
 packages/sidflow-web/app/api/classify/export/route.ts        |  100.00 |   86.84 | 39,60,86-91,115-121,217,219-222
 packages/sidflow-web/app/api/classify/route.ts               |   28.57 |   54.24 | 31,41-42,46,53,59,68-70,75-77,104-108,113-114,119-120,125-126,142-151,154-155,157,159-166,172-180,195-205,207-215,217-224
 packages/sidflow-web/app/api/favorites/route.ts              |  100.00 |   70.30 | 9-10,30-38,75-83,119-128
 packages/sidflow-web/app/api/health/route.ts                 |  100.00 |   62.60 | 75,78,90-91,126-131,133-136,145-150,162-166,181,183-187,189-190,192-199,202-204,214-219,239-244,246-251,284,315-321,341-346,348-354,363-368,382-387,390-392,395-398,401-403,406-409,429,431-434,446,453-457,484-493,507-511
 packages/sidflow-web/app/api/model/latest/route.ts           |  100.00 |   93.94 | 82-84,128-130
 packages/sidflow-web/app/api/playlists/[id]/reorder/route.ts |  100.00 |   63.33 | 38-41,49-55
 packages/sidflow-web/app/api/playlists/[id]/route.ts         |  100.00 |   56.47 | 45-50,66-69,73-78,81-88,105-110,132-138
 packages/sidflow-web/app/api/playlists/route.ts              |  100.00 |   75.00 | 33-38,83-89
 packages/sidflow-web/app/api/prefs/route.ts                  |   85.00 |   62.82 | 76,122-126,148-165,175-192,204-205,207-215,224-244,246-249,256-266,298-318,320-323,325-328,345-346,351,354,357,360,363,366,369,372,379-382
 packages/sidflow-web/app/api/scheduler/route.ts              |  100.00 |   89.55 | 45-50,82,86,97-99,128,131
 packages/sidflow-web/app/api/search/route.ts                 |  100.00 |   82.80 | 101,111,117,128,140-151
 packages/sidflow-web/app/api/telemetry/route.ts              |  100.00 |   67.74 | 30-34,47,50,52-54
 packages/sidflow-web/app/api/users/[username]/route.ts       |  100.00 |   87.80 | 78-81,105-110
 packages/sidflow-web/app/hls/[...path]/route.ts              |  100.00 |   73.21 | 20,28-37,52,65-67
 packages/sidflow-web/components/play-tab-helpers.ts          |  100.00 |   96.67 | 
 packages/sidflow-web/hooks/useKeyboardShortcuts.ts           |   50.00 |   42.42 | 34-71
 packages/sidflow-web/lib/api-client.ts                       |   69.09 |   48.64 | 208-217,264-271,358-364,368-376,380-388,420-444,464-475,483-489,493-499,503-510,514-521,525-528,532-539,570-574,578-586,608-616,620-625
 packages/sidflow-web/lib/audio/fetch-rom-assets.ts           |    0.00 |    2.33 | 9-22,26-53
 packages/sidflow-web/lib/audio/hls-player.ts                 |   28.13 |   30.91 | 59-61,65-74,78,82-84,103-111,115,119,123,127,131,135-138,142-145,149,157-214,219-222,285-410
 packages/sidflow-web/lib/audio/shared/sab-ring-buffer.ts     |  100.00 |  100.00 | 
 packages/sidflow-web/lib/audio/worklet-player.ts             |   18.92 |   22.95 | 129-133,138,142,146,150,154,158,162-166,170,183-193,197-228,232-237,241-257,266-268,276-277,285-475,479-500,504-510,522-638,642-675,679-723,728-750,836-849,853-855
 packages/sidflow-web/lib/classify-progress-store.ts          |   94.74 |   93.08 | 70,95,124-127,192,209-210,231,242-245,365,368,371,451-457
 packages/sidflow-web/lib/cli-executor.ts                     |  100.00 |  100.00 | 
 packages/sidflow-web/lib/cli-logs.ts                         |   66.67 |   71.43 | 15-20
 packages/sidflow-web/lib/feedback/events.ts                  |  100.00 |   93.33 | 
 packages/sidflow-web/lib/feedback/features.ts                |    0.00 |   26.56 | 5-17,21,25-28,32-60
 packages/sidflow-web/lib/feedback/recorder.ts                |    0.00 |    7.41 | 25-40,44-61,65-80
 packages/sidflow-web/lib/feedback/runtime.ts                 |   75.76 |   76.19 | 37-45,50,102-105,175-190,216-221,244-252
 packages/sidflow-web/lib/feedback/storage.ts                 |   75.29 |   16.60 | 7-400,423-424,450-453,455
 packages/sidflow-web/lib/feedback/worker.ts                  |   91.30 |   98.15 | 76-77
 packages/sidflow-web/lib/fetch-progress-store.ts             |   11.76 |    4.68 | 3-48,52,56,60-68,72-129,133-170,174-190,194-201,205-212,216-224,228-237,241-250,254-258,262-265
 packages/sidflow-web/lib/format-error.ts                     |  100.00 |  100.00 | 
 packages/sidflow-web/lib/offline/playback-cache.ts           |  100.00 |   91.11 | 25,50,62-63
 packages/sidflow-web/lib/offline/playback-queue.ts           |  100.00 |  100.00 | 
 packages/sidflow-web/lib/personal-ratings.ts                 |  100.00 |   88.33 | 23,32-34,43,48
 packages/sidflow-web/lib/playback-history.ts                 |  100.00 |   88.71 | 27,50,73,83,88,106
 packages/sidflow-web/lib/player/playback-facade.ts           |   72.22 |   81.95 | 119-133,212-220
 packages/sidflow-web/lib/player/sidflow-player.ts            |   23.81 |   24.70 | 176-177,180,183,191,195,199,203,207,211,215,219-229,233-247,255-257,264-277,284-591,596-602,606-672,676-691,695-709,713-732,790-804,822-833,837-851,857-879,915-929,933-935
 packages/sidflow-web/lib/player/worklet-guard.ts             |   72.73 |  100.00 | 
 packages/sidflow-web/lib/playlist-builder.ts                 |  100.00 |   98.99 | 
 packages/sidflow-web/lib/preferences-store.ts                |  100.00 |   96.97 | 97-98
 packages/sidflow-web/lib/preferences/schema.ts               |  100.00 |   93.65 | 96-97,103,116,126-129
 packages/sidflow-web/lib/preferences/storage.ts              |   76.54 |    2.56 | 3-381,383-384
 packages/sidflow-web/lib/rate-playback.ts                    |   25.00 |   25.00 | 20-32,58-82,86-119
 packages/sidflow-web/lib/scheduler.ts                        |   76.92 |   65.18 | 31-32,48-49,52,98-101,111,114,124-146,176-180
 packages/sidflow-web/lib/server-env.ts                       |  100.00 |   73.85 | 24-30,32-39,41
 packages/sidflow-web/lib/server/admin-auth-core.ts           |   96.77 |   90.87 | 44,76-80,86-90,134-135,215,232,243,249,282
 packages/sidflow-web/lib/server/admin-auth.ts                |  100.00 |  100.00 | 
 packages/sidflow-web/lib/server/anonymize.ts                 |  100.00 |   98.70 | 
 packages/sidflow-web/lib/server/cache.ts                     |   91.67 |   86.92 | 186-199
 packages/sidflow-web/lib/server/favorites-cache.ts           |  100.00 |   96.08 | 42-43
 packages/sidflow-web/lib/server/game-soundtrack.ts           |   66.67 |   20.39 | 47,55-135
 packages/sidflow-web/lib/server/jwt.ts                       |  100.00 |  100.00 | 
 packages/sidflow-web/lib/server/playlist-storage.ts          |  100.00 |   94.40 | 51,58-61,79
 packages/sidflow-web/lib/server/rate-limiter.ts              |   88.89 |   97.80 | 191-192
 packages/sidflow-web/lib/server/remix-radar.ts               |   62.50 |   42.07 | 112,116-119,127-216
 packages/sidflow-web/lib/server/scheduler-init.ts            |   57.14 |   27.63 | 16-58,66-73,83,97-98
 packages/sidflow-web/lib/server/search-index.ts              |  100.00 |  100.00 | 
 packages/sidflow-web/lib/server/similarity-search.ts         |    0.00 |    2.49 | 43-78,86-102,110-161,169-195,205-268
 packages/sidflow-web/lib/server/user-storage.ts              |  100.00 |   98.72 | 
 packages/sidflow-web/lib/sid-collection.ts                   |  100.00 |   98.04 | 
 packages/sidflow-web/lib/sidplayfp-config.ts                 |  100.00 |   96.98 | 57,147-148,173,181
 packages/sidflow-web/lib/telemetry.ts                        |  100.00 |  100.00 | 
 packages/sidflow-web/lib/validation.ts                       |  100.00 |  100.00 | 
 packages/sidflow-web/proxy.ts                                |  100.00 |   83.94 | 126,131,138-145,154-167,192-197
 packages/sidflow-web/tests/e2e/utils/image-comparison.ts     |  100.00 |   71.15 | 48-51,56-60,83-87,113-116,150-157,170-173
--------------------------------------------------------------|---------|---------|-------------------

 1659 pass
 0 fail
 6017 expect() calls
Ran 1659 tests across 163 files. [35.07s]
